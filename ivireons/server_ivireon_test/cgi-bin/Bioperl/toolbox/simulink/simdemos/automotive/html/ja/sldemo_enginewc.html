
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>閉ループ制御を使ったエンジン タイミング モデル</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="sldemo_enginewc.m"><link rel="stylesheet" type="text/css" href="../../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left">sldemo_enginewc.mdl</div><div class="right"><a href="matlab:sldemo_enginewc">このモデルを開く</a></div></div><div class="content"><h1>閉ループ制御を使ったエンジン タイミング モデル</h1><!--introduction--><p>このモデル (<tt>sldemo_enginewc.mdl</tt>) は、開ループ エンジン モデル (「Triggered Subsystem を使ったエンジン タイミングのモデル化」デモで説明されている <tt>sldemo_engine.mdl</tt>) の拡張バージョンです。このモデル <tt>sldemo_enginewc.mdl</tt> は閉ループを含んでおり、Simulink&reg; モデルの柔軟性と拡張性を実証します。この拡張モデルでは、コントローラーの目的は、負荷トルクの変化の影響が最小限に抑えられるように、高速スロットル アクチュエータでエンジン速度を調節することです。これは、エンジン モデルに離散時間 PI コントローラーを追加することによって、Simulink で簡単に実装できます。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">閉ループ モデル</a></li><li><a href="#3">シミュレーションを開いて実行</a></li><li><a href="#7">結果</a></li><li><a href="#9">モデルを閉じる</a></li><li><a href="#10">まとめ</a></li><li><a href="#11">参照</a></li></ul></div><h2>閉ループ モデル<a name="1"></a></h2><p>比例積分 (PI) 制御を使用する制御則を選択しました。動作点が変化したときに定常状態スロットルを調整するために積分器が必要であり、比例項が、積分器によって生じた位相遅れを補償します。</p><div><ul><li>メモ:<a href="matlab:open_system('sldemo_engine')">開ループ エンジン モデル</a>を参照してください (このモデルは、開ループ モデルの拡張バージョンです)。</li></ul></div><p><b>方程式 1</b></p><p><img src="../sldemo_enginewc_eq52992.png" alt="$$ \theta = K_{\rho}(N_{set}-N) + K_I \int (N_{set}-N) dt $$"></p><p><img src="../sldemo_enginewc_eq23847.png" alt="$$ N_{set} = \mbox{ speed set point (rpm) } $$"></p><p><img src="../sldemo_enginewc_eq88964.png" alt="$$ K_{\rho} = \mbox{ proportional gain } $$"></p><p><img src="../sldemo_enginewc_eq40458.png" alt="$$ K_I = \mbox{ integral gain } $$"></p><h2>シミュレーションを開いて実行<a name="3"></a></h2><p><a href="matlab:open_system('sldemo_enginewc')">このモデルを開く</a>には、MATLAB&reg; 端末に <tt>sldemo_enginewc</tt> と入力します (MATLAB ヘルプを使用している場合は、ハイパーリンクをクリックします)。モデル ツール バーの [再生] ボタンを押してシミュレーションを実行してください。</p><div><ul><li>メモ:このモデルは、MATLAB ワークスペースの <tt>sldemo_enginewc_output</tt> という構造体に関連データのログを作成します。ログを作成する信号は青色のインジケーターを持ちます (<a href="matlab:open_system('sldemo_enginewc')">モデルを参照</a>)。信号ログの詳細は、Simulink ヘルプを参照してください。</li></ul></div><img vspace="5" hspace="5" src="../sldemo_enginewc_01.png" alt=""> <img vspace="5" hspace="5" src="../sldemo_enginewc_02.png" alt=""> <img vspace="5" hspace="5" src="../sldemo_enginewc_03.png" alt=""> <p><b>図 1:</b> 閉ループ エンジン モデルとシミュレーション結果</p><p>このモデルでは、マイクロプロセッサー実装に適した離散時間コントローラーを使用します。方程式 1 の積分項は、離散時間近似で実装されなければなりません。業界で一般的であるように、コントローラーの実行は、エンジンのクランクシャフトの回転と同期化されます。コントローラーは、上述のバルブ タイミング信号によってトリガーされる Triggered Subsystem に組み込まれます。</p><p>Controller サブシステムの詳細な構造を図 2 に示します。注目すべき点は、Discrete-Time Integrator ブロックを、そのサンプル時間パラメーターを (内部的に) <tt>-1</tt> に設定して使用することです。これは、ブロックがそのサンプル時間を継承することを示しています。この場合、サブシステムがトリガーされるたびに実行されます。これを Triggered Subsystem にする重要なコンポーネントは、図 2 の下部に示す Trigger ブロックです。任意のサブシステムを Triggered Subsystem に変換するには、Simulink Connections ライブラリからサブシステム ブロック線図にこのブロックのコピーをドラッグします。</p><img vspace="5" hspace="5" src="../sldemo_enginewc_04.png" alt=""> <p><b>図 2:</b> 速度コントローラー サブシステム</p><h2>結果<a name="7"></a></h2><p>一般的なシミュレーション結果を図 3 に示します。速度設定点は、<tt>t = 5 秒</tt>で <tt>2000 rpm</tt> から <tt>3000 rpm</tt> に進みます。トルクの外乱は、<tt>sldemo_engine.mdl</tt> 開ループ モデルで使用されるものと同じです (他のエンジン モデルを<a href="matlab:open_system('sldemo_engine')">開く</a>)。定常偏差が 0 の、迅速な過渡応答に注目してください。代替コントローラー調整 (<tt>Ki</tt> および <tt>Kp</tt>) が示されています。ユーザーは MATLAB コマンド ラインでこれらを調整できます。これにより、エンジニアはパラメーター変動の相対的影響を理解できます。</p><img vspace="5" hspace="5" src="../sldemo_enginewc_05.png" alt=""> <p><b>図 3:</b> 一般的なシミュレーション結果</p><h2>モデルを閉じる<a name="9"></a></h2><p>モデルを閉じます。ログが作成されたデータをクリアします。</p><h2>まとめ<a name="10"></a></h2><p>ここで説明したエンジン モデルなど、非線形の複雑なシステムをモデル化する機能は、Simulink の重要な機能の 1 つです。シミュレーション能力は、前述のモデルの提示において明白です。Simulink は、正確なタイミングのシリンダー吸気イベントも含めて、このタイプのモデルを作成する上で重要である、モデルの忠実性を保ちます。完全な速度制御システムが Simulink の柔軟性を実証しています。特に、Simulink モデル化方法では、割り込み駆動エンジン速度コントローラーのラピッド プロトタイピングが可能です。</p><div><ul><li>メモ:<a href="matlab:open_system('sldemo_engine')">開ループ エンジン モデル</a>を参照してください (このモデルは、開ループ モデルの拡張バージョンです)。</li></ul></div><h2>参照<a name="11"></a></h2><p>[1] P.R. Crossley and J.A. Cook, IEEE&reg; International Conference &lsquo;Control 91&rsquo;, Conference Publication 332, vol. 2, pp.921-925, 25-28 March, 1991, Edinburgh, U.K.</p><p>[2] The Simulink Model.Developed by Ken Butts, Ford Motor Company&reg;.Modified by Paul Barnard, Ted Liefeld and Stan Quinn, MathWorks&reg;, 1994-7.</p><p>[3] J. J. Moskwa and J. K. Hedrick, &quot;Automotive Engine Modeling for Real Time Control Application,&quot; Proc.1987 ACC, pp.341-346.</p><p>[4] B. K. Powell and J. A. Cook, &quot;Nonlinear Low Frequency Phenomenological Engine Modeling and Analysis,&quot; Proc.1987 ACC, pp.332-340.</p><p>[5] R. W. Weeks and J. J. Moskwa, &quot;Automotive Engine Modeling for Real-Time Control Using Matlab/Simulink,&quot; 1995 SAE Intl. Cong. paper 950417.</p><p class="footer">Copyright 2006-2009 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Engine Timing Model with Closed Loop Control % % This model (|sldemo_enginewc.mdl|) is an enhanced version of the % open-loop engine model (|sldemo_engine.mdl| -  % described in "Modeling Engine Timing Using Triggered Subsystems" demo). % This model, |sldemo_enginewc.mdl|, contains a closed-loop and % demonstrates the flexibility and extensibility of Simulink(R) % models.  % In this enhanced model, the objective of the controller is to regulate % engine speed with a fast throttle actuator, such that changes in load % torque have minimal effect. This is easily accomplished in Simulink by % adding a discrete-time PI controller to the engine model.   % Copyright 2006-2009 The MathWorks, Inc.  %% Closed-Loop Model % % We chose a control law which uses proportional plus integral (PI) % control. The integrator is needed to adjust the steady-state throttle as % the operating point changes, and the proportional term compensates for % phase lag introduced by the integrator.  % % * Note: See the % <matlab:open_system('sldemo_engine') open-loop engine model> % (this model is an enhanced version of the open-loop model).     %%  % *Equation 1* % % $$ \theta = K_{\rho}(N_{set}-N) + K_I \int (N_{set}-N) dt $$ % % $$ N_{set} = \mbox{ speed set point (rpm) } $$ % % $$ K_{\rho} = \mbox{ proportional gain } $$ % % $$ K_I = \mbox{ integral gain } $$   %% Opening and Running the Simulation % % To <matlab:open_system('sldemo_enginewc') open this model> type % |sldemo_enginewc| at MATLAB(R) terminal (click on the hyperlink if you are % using MATLAB Help). Press the "Play" button on the model toolbar to run % the simulation.  % % * Note: The model logs relevant data to MATLAB workspace in a structure % called |sldemo_enginewc_output|. Logged signals have a blue indicator % (<matlab:open_system('sldemo_enginewc') see  % the model>). Read more about Signal Logging in Simulink Help.      open_system('sldemo_enginewc');   % hidden code, not displayed in HTML demo page evalc('sim(''sldemo_enginewc'')');  % run simulation, don't display output  %% % *Figure 1:* Closed-loop engine model and simulation results  %% %  % In this model we employ a discrete-time controller, which is suitable for % microprocessor implementation. The integral term in Equation 1 must thus % be realized with a discrete-time approximation. As is typical in the % industry, the controller execution is synchronized with the engine's % crankshaft rotation. The controller is embedded in a triggered subsystem % that is triggered by the valve timing signal described above.  % % The detailed construction of the 'Controller' subsystem is illustrated in % Figure 2. Of note is the use of the 'Discrete-Time Integrator' block with % its sample time parameter set (internally) at |-1|. This indicates that the % block inherits its sample time, in this case executing each time % the subsystem is triggered. The key component that makes this a triggered % subsystem is the 'Trigger' block shown at the bottom of Figure 2. Any % subsystem can be converted to a triggered subsystem by dragging a copy of % this block into the subsystem diagram from the Simulink Connections % library.       open_system('sldemo_enginewc/Controller');  %% % *Figure 2:* Speed controller subsystem  %% Results  % % Typical simulation results are shown in Figure 3. The speed set point % steps from |2000 rpm| to |3000 rpm| at |t = 5 sec|. The torque disturbances are % identical to those used in |sldemo_engine.mdl|, the open-loop model % (<matlab:open_system('sldemo_engine') open> the other engine model). Note % the quick transient   % response, with zero steady-state error. Several alternative controller % tunings (|Ki| and |Kp|) are shown. These can be adjusted by the user at MATLAB % command line. This allows the engineer to understand the relative effects % of parameter variations.    % close the scopes before running 3 simulations in a row % this prevents unwanted scope images from showing up in the HTML  close_system('sldemo_enginewc/EngineSpeed'); close_system('sldemo_enginewc/SimulationInputs'); clear Kp Ki; % 3 different sets of Ki and Kp parameters Param.Kp = [0.05 0.033 0.061]; Param.Ki = [0.10 0.064 0.072]; % run the simulation three times with these different parameters  % save the EngineSpeed data every time  for i=1:3     Kp = Param.Kp(i);     Ki = Param.Ki(i);     evalc('sim(''sldemo_enginewc'')');     x{i} = sldemo_enginewc_output.EngineSpeed.Time; % x-axis data     y{i} = sldemo_enginewc_output.EngineSpeed.Data; % y-axis data end   PlotHandle = plot(x{1}, y{1}, 'y-',  ...                   x{2}, y{2}, 'y:', ...                   x{3}, y{3}, 'y-.');                title('Closed-Loop Simulation Results: Engine Speed (rpm)'); xlabel('Time (sec)'); ylabel('Engine Speed (rpm)'); set(gca,'Color','k','XGrid','On','XColor',[0.3 0.3 0.3],...                     'YGrid','On','YColor',[0.3 0.3 0.3]); axis([0 10 1950 3150]); h = legend( ['Kp = ' num2str(Param.Kp(1)) ', Ki = ' num2str(Param.Ki(1))], ...             ['Kp = ' num2str(Param.Kp(2)) ', Ki = ' num2str(Param.Ki(2))], ...             ['Kp = ' num2str(Param.Kp(3)) ', Ki = ' num2str(Param.Ki(3))], ...             'Location','SouthEast');          set(h,'TextColor','w','Color','none');   %% % % *Figure 3:* Typical simulation results  %% Closing Model %  % Close the model. Clear logged data.  close_system('sldemo_enginewc', 0); clear sldemo_enginewc_output Ki Kp h PlotHandle Param x y i; %clear unnecessary variables %% Conclusions  % % The ability to model nonlinear, complex systems, such as the engine model % described here, is one of Simulink's key features. The power of the % simulation is evident in the presentation of the models above. Simulink % retains model fidelity, including precisely timed cylinder intake events, % which is critical in creating a model of this type. The complete speed % control system demonstrates the flexibility of Simulink. In particular, % the Simulink modeling approaches allow rapid prototyping of an % interrupt-driven engine speed controller.  % % * Note: See the % <matlab:open_system('sldemo_engine') open-loop engine model> % (this model is an enhanced version of the open-loop model).    %% References % % [1] P.R. Crossley and J.A. Cook, IEEE(R) International Conference ‘Control % 91’, Conference Publication 332, vol. 2, pp. 921-925, 25-28 March, 1991, % Edinburgh, U.K.  % % [2] The Simulink Model. Developed by Ken Butts, Ford Motor Company(R). % Modified by Paul Barnard, Ted Liefeld and Stan Quinn, MathWorks(R), 1994-7.  % % [3] J. J. Moskwa and J. K. Hedrick, "Automotive Engine % Modeling for Real Time Control Application," Proc.1987 ACC, pp. 341-346. %  % [4] B. K. Powell and J. A. Cook, "Nonlinear Low Frequency % Phenomenological Engine Modeling and Analysis," Proc. 1987 ACC, pp. % 332-340.  % % [5] R. W. Weeks and J. J. Moskwa, "Automotive Engine Modeling for % Real-Time Control Using Matlab/Simulink," 1995 SAE Intl. Cong. paper % 950417.    ##### SOURCE END ##### --></body></html>