
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Assessing Gain and Phase Margins</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-06-29"><meta name="DC.source" content="margindemo.m"><link rel="stylesheet" type="text/css" href="../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit margindemo">Open margindemo.m in the Editor</a></div><div class="right"><a href="matlab:echodemo margindemo">Run in the Command Window</a></div></div><div class="content"><h1>Assessing Gain and Phase Margins</h1><!--introduction--><p>This demo illustrates the concept of stability margins and its connection with closed-loop response characteristics.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Stability of a Feedback Loop</a></li><li><a href="#6">How Stable is Stable?</a></li><li><a href="#8">Gain and Phase Margins</a></li><li><a href="#13">Systems with Multiple Gain or Phase Crossings</a></li><li><a href="#21">Interactive GUI</a></li></ul></div><h2>Stability of a Feedback Loop<a name="1"></a></h2><p>Stability generally means that all internal signals remain bounded. This is a standard requirement for control systems to avoid loss of control and damage to equipment. For linear feedback systems, stability can be assessed by looking at the poles of the closed-loop transfer function. Consider for example the SISO feedback loop:</p><p><img vspace="5" hspace="5" src="../Figures/margin_01.png" alt=""> </p><p><b>Figure 1</b>: SISO Feedback Loop.</p><p>For a unit loop gain <tt>k</tt>, you can compute the closed-loop transfer function <tt>T</tt> using:</p><pre class="codeinput">G = tf([.5 1.3],[1 1.2  1.6 0]);
T = feedback(G,1);
</pre><p>To obtain the poles of <tt>T</tt>, type</p><pre class="codeinput">pole(T)
</pre><pre class="codeoutput">
ans =

  -0.2305 + 1.3062i
  -0.2305 - 1.3062i
  -0.7389          

</pre><p>The feedback loop for <tt>k=1</tt> is stable since all poles have negative real parts.</p><h2>How Stable is Stable?<a name="6"></a></h2><p>Checking the closed-loop poles gives us a binary assessment of stability. In practice, it is more useful to know how robust (or fragile) stability is. One indication of robustness is  how much the loop gain can change before stability is lost. You can use the root locus plot to estimate the range of <tt>k</tt> values for which the loop is stable:</p><pre class="codeinput">rlocus(G)
</pre><img vspace="5" hspace="5" src="margindemo_01.png" alt=""> <p>Clicking on the point where the locus intersects the y axis reveals that this feedback loop is stable for</p><p><img src="margindemo_eq23356.png" alt="$$ 0 < k < 2.7 $$"></p><p>This range shows that with <tt>k=1</tt>, the loop gain can increase 270% before you lose stability.</p><h2>Gain and Phase Margins<a name="8"></a></h2><p>Changes in the loop gain are only one aspect of robust stability. In general, imperfect plant modeling means that both  gain and phase are not known exactly. Because modeling errors are most damaging near the gain crossover frequency (frequency where open-loop gain is 0dB), it also matters how much phase variation can be tolerated at this frequency.</p><p>The phase margin measures how much phase variation is needed at the gain crossover frequency to lose stability. Similarly, the gain margin measures what relative gain variation is needed at the gain crossover frequency to lose stability. Together, these two numbers give an estimate of the "safety margin" for closed-loop stability. The smaller the stability margins, the more fragile stability is.</p><p>You can display the gain and phase margins on a Bode plot as follows. First create the plot:</p><pre class="codeinput">bode(G), grid
</pre><img vspace="5" hspace="5" src="margindemo_02.png" alt=""> <p>Then, right-click on the plot and select the <b>Characteristics -&gt; Minimum Stability Margins</b> submenu. Finally, click on the blue dot markers. The resulting plot is shown below:</p><p><img vspace="5" hspace="5" src="../Figures/margin_03.png" alt=""> </p><p>This indicates a gain margin of about 9 dB and a phase margin of about 45 degrees. The corresponding closed-loop step response exhibits about 20% overshoot and some oscillations.</p><pre class="codeinput">step(T), title(<span class="string">'Closed-loop response for k=1'</span>)
</pre><img vspace="5" hspace="5" src="margindemo_03.png" alt=""> <p>If we increase the gain to <tt>k=2</tt>, the stability margins are reduced to</p><pre class="codeinput">[Gm,Pm] = margin(2*G);
GmdB = 20*log10(Gm)   <span class="comment">% gain margin in dB</span>
Pm  <span class="comment">% phase margin in degrees</span>
</pre><pre class="codeoutput">
GmdB =

    2.7471


Pm =

    8.6328

</pre><p>and the closed-loop response has poorly damped oscillations, a sign of near instability.</p><pre class="codeinput">step(feedback(2*G,1)), title(<span class="string">'Closed-loop response for k=2'</span>)
</pre><img vspace="5" hspace="5" src="margindemo_04.png" alt=""> <h2>Systems with Multiple Gain or Phase Crossings<a name="13"></a></h2><p>Some systems have multiple gain crossover or phase crossover frequencies, which leads to multiple gain or phase margin values. For example, consider the feedback loop</p><p><img vspace="5" hspace="5" src="../Figures/margin_02.png" alt=""> </p><p><b>Figure 2</b>: Feedback Loop with Multiple Phase Crossovers</p><p>The closed-loop response for <tt>k=1</tt> is stable:</p><pre class="codeinput">G = tf(20,[1 7]) * tf([1 3.2 7.2],[1 -1.2 0.8]) * tf([1 -8 400],[1 33 700]);
T = feedback(G,1);
step(T), title(<span class="string">'Closed-loop response for k=1'</span>)
</pre><img vspace="5" hspace="5" src="margindemo_05.png" alt=""> <p>To assess how robustly stable this loop is, plot its Bode response:</p><pre class="codeinput">bode(G), grid
</pre><img vspace="5" hspace="5" src="margindemo_06.png" alt=""> <p>Then, right-click on the plot and select the <b>Characteristics -&gt; All Stability Margins</b> submenu to show all the crossover frequencies and associated stability margins. The resulting plot is shown below.</p><p><img vspace="5" hspace="5" src="../Figures/margin_04.png" alt=""> </p><p>Note that there are two 180 deg phase crossings with corresponding gain margins of -9.35dB and +10.6dB. Negative gain margins indicate that stability is lost by decreasing the gain, while positive gain margins indicate that stability is lost by increasing the gain. This is confirmed by plotting the closed-loop step response for a plus/minus 6dB gain variation about <tt>k=1</tt>:</p><pre class="codeinput">k1 = 2;     T1 = feedback(G*k1,1);
k2 = 1/2;   T2 = feedback(G*k2,1);
step(T,<span class="string">'b'</span>,T1,<span class="string">'r'</span>,T2,<span class="string">'g'</span>,12),
legend(<span class="string">'k = 1'</span>,<span class="string">'k = 2'</span>,<span class="string">'k = 0.5'</span>)
</pre><img vspace="5" hspace="5" src="margindemo_07.png" alt=""> <p>The plot shows increased oscillations for both smaller and larger gain values.</p><p>You can use the command <tt>allmargin</tt> to compute all stability margins. Note that gain margins are expressed as gain ratios, not dB. Use <tt>mag2db</tt> to convert the values to dB.</p><pre class="codeinput">m = allmargin(G)

GainMargins_dB = mag2db(m.GainMargin)
</pre><pre class="codeoutput">
m = 

     GainMargin: [0.3408 3.3920]
    GMFrequency: [1.9421 16.4807]
    PhaseMargin: 68.1178
    PMFrequency: 7.0762
    DelayMargin: 0.1680
    DMFrequency: 7.0762
         Stable: 1


GainMargins_dB =

   -9.3510   10.6091

</pre><h2>Interactive GUI<a name="21"></a></h2><p>To gain additional insight into the connection between stability margins and closed-loop responses, click on the link below to launch an interactive GUI for tuning the loop gain <tt>k</tt> and seeing the effect on margins and closed-loop responses.</p><p><a href="matlab:margin_gui">Open the Gain and Phase Margin GUI</a></p><pre class="codeinput">margin_gui
</pre><img vspace="5" hspace="5" src="margindemo_08.png" alt=""> <p class="footer">Copyright 1986-2007 The MathWorks, Inc.<br>
          Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!--
##### SOURCE BEGIN #####
%% Assessing Gain and Phase Margins
% This demo illustrates the concept of stability margins and 
% its connection with closed-loop response characteristics.

%   Copyright 1986-2007 The MathWorks, Inc.
%   $Revision: 1.8.4.7 $  $Date: 2007/11/09 19:48:09 $

%% Stability of a Feedback Loop
% Stability generally means that all internal signals remain bounded. This
% is a standard requirement for control systems to avoid loss of
% control and damage to equipment. For linear feedback systems,
% stability can be assessed by looking at the poles of the closed-loop
% transfer function. Consider for example the SISO feedback loop:
%
% <<../Figures/margin_01.png>>

%%
% *Figure 1*: SISO Feedback Loop.


%%
% For a unit loop gain |k|, you can compute the closed-loop transfer function
% |T| using:
G = tf([.5 1.3],[1 1.2  1.6 0]);
T = feedback(G,1);

%%
% To obtain the poles of |T|, type
pole(T)

%%
% The feedback loop for |k=1| is stable since all poles have negative real parts.

%% How Stable is Stable?
% Checking the closed-loop poles gives us a binary assessment of stability.
% In practice, it is more useful to know how robust (or fragile) stability 
% is. One indication of robustness is  how much the loop gain can change
% before stability is lost. You can use the root locus plot to estimate the
% range of |k| values for which the loop is stable:
rlocus(G)

%% 
% Clicking on the point where the locus intersects the y axis reveals that
% this feedback loop is stable for 
%
% $$ 0 < k < 2.7 $$
%
% This range shows that with |k=1|, the loop gain can increase 270% before 
% you lose stability.

%% Gain and Phase Margins
% Changes in the loop gain are only one aspect of robust stability. In
% general, imperfect plant modeling means that both  gain and 
% phase are not known exactly. Because modeling errors are most damaging
% near the gain crossover frequency (frequency where open-loop gain is
% 0dB), it also matters how much phase variation can be tolerated at
% this frequency.
%
% The phase margin measures how much phase variation is needed at the gain
% crossover frequency to lose stability. Similarly, the gain margin
% measures what relative gain variation is needed at the gain
% crossover frequency to lose stability. Together, these two numbers give an
% estimate of the "safety margin" for closed-loop stability. The smaller
% the stability margins, the more fragile stability is.
%
% You can display the gain and phase margins on a Bode plot as follows.
% First create the plot:
bode(G), grid

%% 
% Then, right-click on the plot and select the *Characteristics -> Minimum Stability
% Margins* submenu. Finally, click on the blue dot markers. 
% The resulting plot is shown below:
% 
% <<../Figures/margin_03.png>>

%%
% This indicates a gain margin of about 9 dB and a phase
% margin of about 45 degrees. The corresponding closed-loop step response
% exhibits about 20% overshoot and some oscillations.
step(T), title('Closed-loop response for k=1')

%%
% If we increase the gain to |k=2|, the stability margins are reduced to
[Gm,Pm] = margin(2*G);
GmdB = 20*log10(Gm)   % gain margin in dB
Pm  % phase margin in degrees

%%
% and the closed-loop response has poorly damped oscillations, a sign of
% near instability.
step(feedback(2*G,1)), title('Closed-loop response for k=2')

%% Systems with Multiple Gain or Phase Crossings
% Some systems have multiple gain crossover or phase
% crossover frequencies, which leads to multiple gain or phase margin values. For
% example, consider the feedback loop
% 
% <<../Figures/margin_02.png>>

%%
% *Figure 2*: Feedback Loop with Multiple Phase Crossovers

%%
% The closed-loop response for |k=1| is stable:
G = tf(20,[1 7]) * tf([1 3.2 7.2],[1 -1.2 0.8]) * tf([1 -8 400],[1 33 700]);
T = feedback(G,1);
step(T), title('Closed-loop response for k=1')

%% 
% To assess how robustly stable this loop is, plot its Bode response:
bode(G), grid

%%
% Then, right-click on the plot and select the *Characteristics -> All Stability Margins*
% submenu to show all the crossover frequencies and associated stability
% margins. The resulting plot is shown below.
%
% <<../Figures/margin_04.png>>

%%
% Note that there are two 180 deg phase crossings with corresponding gain 
% margins of -9.35dB and +10.6dB. Negative gain margins
% indicate that stability is lost by decreasing the gain, while positive
% gain margins indicate that stability is lost by increasing the gain.
% This is confirmed by plotting the closed-loop step response for a 
% plus/minus 6dB gain variation about |k=1|:
k1 = 2;     T1 = feedback(G*k1,1);
k2 = 1/2;   T2 = feedback(G*k2,1);
step(T,'b',T1,'r',T2,'g',12), 
legend('k = 1','k = 2','k = 0.5')

%% 
% The plot shows increased oscillations for both smaller and larger
% gain values.

%%
% You can use the command |allmargin| to compute all stability margins. Note
% that gain margins are expressed as gain ratios, not dB. Use |mag2db| to
% convert the values to dB.
m = allmargin(G)

GainMargins_dB = mag2db(m.GainMargin)

%% Interactive GUI
% To gain additional insight into the connection between stability margins
% and closed-loop responses, click on the link below to launch an interactive 
% GUI for tuning the loop gain |k| and seeing the effect on margins and
% closed-loop responses.
%
% <matlab:margin_gui Open the Gain and Phase Margin GUI>
margin_gui


displayEndOfDemoMessage(mfilename)


##### SOURCE END #####
--></body></html>