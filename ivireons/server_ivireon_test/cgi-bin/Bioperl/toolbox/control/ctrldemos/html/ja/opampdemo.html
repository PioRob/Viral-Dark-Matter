
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>フィードバック アンプの設計</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="opampdemo.m"><link rel="stylesheet" type="text/css" href="../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit opampdemo">エディターで opampdemo.m を開く</a></div><div class="right"><a href="matlab:echodemo opampdemo">コマンド ウィンドウで実行</a></div></div><div class="content"><h1>フィードバック アンプの設計</h1><!--introduction--><p>このデモでは、Control System Toolbox™ を使用して非反転フィードバック アンプの回路設計を行います。この設計では、電気フィードバック回路の標準的な構成要素であるオペ アンプ (op amp) を作成します。</p><p>このチュートリアルは、Control System Toolbox で提供されるツールを使用して、実際の電気システムを設計、モデル化し、解析する様子のデモを行います。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">オペ アンプの説明</a></li><li><a href="#10">フィードバック アンプ</a></li><li><a href="#27">フィードバック リード補償器</a></li><li><a href="#40">まとめ</a></li></ul></div><h2>オペ アンプの説明<a name="1"></a></h2><p>電気フィードバック回路の標準的な構成要素としては、一般的に 1e5 ～ 1e7 の範囲においてきわめて高い dc ゲインを持つように設計された差動電圧アンプである、オペ アンプ (op amp) があります。</p><p>オペ アンプの電気記号は次のとおりです。</p><p><img vspace="5" hspace="5" src="../../Figures/opampdemofigures_01.png" alt=""> </p><p>このデモでは、2 つの極 (周波数 w1 および w2) と高 dc ゲイン (a0) を持つ非補償型オペ アンプを使用することを前提としています。このオペ アンプが (飽和モードではなく) 線形モードで作動していると仮定すると、オペ アンプの開ループ伝達関数は、線形時不変 (LTI) システムとして表現できます (上記を参照)。</p><p>高次極は物理的なオペ アンプには存在しますが、この例では、振幅が 1 をはるかに下回っている周波数範囲にこれらの極が含まれていることが前提となっています。</p><p><b>開ループ伝達関数:</b></p><p><img src="../opampdemo_eq47417.png" alt="$$ a(s)=\frac{a_0}{(1+s/\omega_1)(1+s/\omega_2)} $$"></p><p>以下のシステム パラメーターが仮定されています。</p><p><img src="../opampdemo_eq95508.png" alt="$$ a_0 = 1e5 $$"></p><p><img src="../opampdemo_eq97314.png" alt="$$ \omega_1 = 1e4 $$"></p><p><img src="../opampdemo_eq49487.png" alt="$$ \omega_2 = 1e6 $$"></p><pre class="codeinput">a0 = 1e5;
w1 = 1e4;
w2 = 1e6;
</pre><p>次に、Control System Toolbox を使用して、このシステムの伝達関数モデルを作成します。このモデルは、MATLAB&reg; ワークスペースに LTI オブジェクトとして保存されます。</p><p>まず、TF コマンドを使用して、ラプラス変数 s を定義します。その後で、's' を使用して、開ループ伝達関数 a(s) を作成します。</p><pre class="codeinput">s = tf(<span class="string">'s'</span>);
a = a0/(1+s/w1)/(1+s/w2)
</pre><pre class="codeoutput"> 
Transfer function:
         1e015
------------------------
s^2 + 1.01e006 s + 1e010
 
</pre><p>BODEPLOT コマンドを使用すると、a(s) の周波数応答を表示できます。</p><pre class="codeinput">h = bodeplot(a,<span class="string">'r'</span>);

setoptions(h,<span class="string">'FreqUnits'</span>,<span class="string">'rad/sec'</span>,<span class="string">'MagUnits'</span>,<span class="string">'dB'</span>,<span class="string">'PhaseUnits'</span>,<span class="string">'deg'</span>,<span class="keyword">...</span>
    <span class="string">'YLimMode'</span>,<span class="string">'Manual'</span>,<span class="string">'YLim'</span>,{[0,110],[-180,0]});
</pre><img vspace="5" hspace="5" src="../opampdemo_01.png" alt=""> <p>このボード線図のプロパティのメニューにアクセスするには、プロットを右クリックします。  応答の詳細を取得するために使用できる移動可能なデータ マーカーを作成するには、曲線を左クリックします。</p><p>STEPPLOT コマンドと DCGAIN コマンドを使用すると、正規化された a(s) のステップ応答を表示できます。</p><pre class="codeinput">a_norm = a / dcgain(a);
stepplot(a_norm,<span class="string">'r'</span>)

title(<span class="string">'Normalized Open-Loop Step Response'</span>);
ylabel(<span class="string">'Normalized Amplitude'</span>);
</pre><img vspace="5" hspace="5" src="../opampdemo_02.png" alt=""> <p>プロットを右クリックし、[特性]、[整定時間] を選択して、整定時間を表示します。整定時間マーカーの上にマウスを置いたままにすると、整定時間の正確な値が表示されます。</p><h2>フィードバック アンプ<a name="10"></a></h2><p>ここでは、抵抗性フィードバック ネットワークを追加して、システムを非反転アンプとして接続します。</p><p><img vspace="5" hspace="5" src="../../Figures/opampdemofigures_02.png" alt=""> </p><p>このフィードバック ネットワーク b(s) は、入力 Vo と出力 Vn を持つ分圧器です。比率 Vn/Vo を求めると、b(s) の伝達関数が得られます。</p><pre>     b  =  Vn / Vo  =  R1 / (R1 + R2)</pre><p>このシステムのブロック線図表現は次のようになります。</p><p><img vspace="5" hspace="5" src="../../Figures/opampdemofigures_03.png" alt=""> </p><p>比率 Vo/Vp を求めると、閉ループゲイン A(s) が得られます。</p><pre>     A  =  Vo / Vp  =  a / (1 + ab)</pre><p>積 &quot;ab&quot; が十分に大きい (&gt;&gt;1) 場合、A(s) は次のように近似できます。</p><pre>     A  =  1 / b</pre><p>dc ゲイン (Vo/Vp) 10 のアンプを設計する必要があり、R1 が 10 kΩで固定されていると仮定します。R2 の解を求めると、次のようになります。</p><pre class="codeinput">A0 = 10;
b = 1 / A0;    <span class="comment">% approximation for ab&gt;&gt;1</span>
R1 = 10000;
R2 = R1 * (1/b - 1)
</pre><pre class="codeoutput">
R2 =

       90000

</pre><p>FEEDBACK コマンドを使用して、閉ループ システムを作成します。</p><pre class="codeinput">A = feedback(a,b);
</pre><p>次に、BODEMAG コマンドを使用して、a(s) と A(s) の周波数応答を同時にプロットします。</p><pre class="codeinput">bodemag(a,<span class="string">'r'</span>,A,<span class="string">'b'</span>);

legend(<span class="string">'Open-Loop Gain (a)'</span>,<span class="string">'Closed-Loop Gain (A)'</span>)
set(gca,<span class="string">'YLim'</span>,[0,110])

<span class="comment">% Annotations</span>
opampdemo_annotate(1)
</pre><img vspace="5" hspace="5" src="../opampdemo_03.png" alt=""> <p>負のフィードバックを使用して低周波数 (LF) ゲインを低減したことにより、それに対応するシステム帯域幅の増加が生じています (ゲインが最大値より 3dB 低下する周波数として定義)。</p><p>このゲイン/帯域幅のトレードオフは、フィードバック アンプ回路の設計における強力なツールです。</p><p>ゲインはフィードバック ネットワークによって支配されるようになったため、オペ アンプの自然な (開ループ) ゲインの変動に対するこのゲインの感度がどの程度であるかを考慮すると効果的です。</p><p>ただし、システム感度を導出する前に、信号がループ内を移動する過程で得るゲインの合計値、ループ ゲイン L(s)=a(s)b(s) を定義しておくと便利です。</p><pre class="codeinput">L = a * b;
</pre><p>この値は、システム感度と安定余裕を評価するために使用します。</p><p>システム感度 S(s) は、a(s) の変動に対する A(s) の感度を表します。</p><p><img src="../opampdemo_eq67047.png" alt="$$ S = \frac{\delta A/A}{\delta a/a}= \frac{1}{1+a(s)b(s)}=\frac{1}{1+L(s)} $$"></p><p>S(s) と L(s) の間の逆相関関係は、「ゲインの感度抑制」という、負のフィードバックがもたらすもう 1 つのメリットを表しています。</p><pre class="codeinput">S = 1 / (1 + L);
</pre><p>S(s) は、フィードバック方程式と形式が同じであるため、より堅牢な FEEDBACK コマンドを使用して作成できます。</p><pre class="codeinput">S = feedback(1,L);
</pre><p>S(s) と A(s) の振幅は、BODEMAG コマンドを使用して同時にプロットできます。</p><pre class="codeinput">bodemag(A,<span class="string">'b'</span>,S,<span class="string">'g'</span>)
legend(<span class="string">'Closed-Loop Gain(A)'</span>, <span class="string">'System Sensitivity(S)'</span>,4)
</pre><img vspace="5" hspace="5" src="../opampdemo_04.png" alt=""> <p>低周波数感度 (約 -80 dB) が非常に小さいことは、閉ループ ゲインが開ループ ゲインの変動の影響を最小限にしか受けない設計であることを示しています。このような a(s) の変動は、製造のばらつきや温度変化などを原因としてよく起こります。</p><p>STEPPLOT コマンドを使用すると、A(s) のステップ応答をチェックできます。</p><pre class="codeinput">stepplot(A)

<span class="comment">%Annotation</span>
opampdemo_annotate(2)
</pre><img vspace="5" hspace="5" src="../opampdemo_05.png" alt=""> <p>フィードバックの使用によって整定時間が大きく (約 98%) 短縮されました。ただし、ステップ応答には、安定余裕が少ないことを意味する大量のリンギングが示されています。</p><p>安定余裕を解析するには、MARGIN コマンドを使用してループ ゲイン L(s) をプロットします。</p><pre class="codeinput">margin(L)
</pre><img vspace="5" hspace="5" src="../opampdemo_06.png" alt=""> <p>結果として生成されるプロットに、位相余裕が 6 度未満であることが示されます。このアンプを補償して、位相余裕を許容可能なレベル (通常は 45 度以上) まで引き上げることによって、過剰なオーバーシュートやリンギングを低減する必要があります。</p><h2>フィードバック リード補償器<a name="27"></a></h2><p>&quot;フィードバック リード補償器&quot; は、この種類の回路で一般的に使用される補償方法です。この手法では、コンデンサー C をフィードバック抵抗器 R2 と並列させて追加することによって、b(s) が変更されます。</p><p><img vspace="5" hspace="5" src="../../Figures/opampdemofigures_04.png" alt=""> </p><p>コンデンサーの値を選択する際は、交差周波数の近傍の b(s) に位相進みを加えることで、アンプの位相余裕を大きくすることを考慮できます。</p><p>新しいフィードバック伝達関数は次のようになります。</p><p><img vspace="5" hspace="5" src="../../Figures/opampdemofigures_05.png" alt=""> </p><p>L(s) の 0dB 交差周波数にゼロの b(s) を挿入することによって C の値を近似できます。</p><pre class="codeinput">[Gm,Pm,Wcg,Wcp] = margin(L);
C = 1/(R2*Wcp)
</pre><pre class="codeoutput">
C =

  1.1139e-012

</pre><p>アンプの応答に対する C の影響を調べるには、初期推定に基づいて、いくつかの C の値に関する b(s) の LTI モデル配列を作成します。</p><p><img vspace="5" hspace="5" src="../../Figures/opampdemofigures_06.png" alt=""> </p><pre class="codeinput">K = R1/(R1+R2);
C = [1:.2:3]*1e-12;
<span class="keyword">for</span> n = 1:length(C)
    b_array(:,:,n) = tf([K*R2*C(n) K],[K*R2*C(n) 1]);
<span class="keyword">end</span>
</pre><p>次に、A(s) と L(s) の LTI 配列を作成できます。</p><pre class="codeinput">A_array = feedback(a,b_array);
L_array = a*b_array;
</pre><p>STEPPLOT コマンドを使用して、LTI 配列 A_array(s) 内のすべてのモデルのステップ応答を A(s) のステップ応答と共にプロットできます。</p><pre class="codeinput">stepplot(A,<span class="string">'b:'</span>,A_array,<span class="string">'b'</span>,[0:.005:1]*1.5e-6);
title(<span class="string">'Closed-Loop Step Response (Compensated)'</span>);

<span class="comment">% Plot Annotations</span>
opampdemo_annotate(3)
</pre><img vspace="5" hspace="5" src="../opampdemo_07.png" alt=""> <p>ループ ゲイン配列 L_array(s) の位相余裕は、MARGIN コマンドを使用して見つけることができます。</p><pre class="codeinput">[Gm,Pm,Wcg,Wcp] = margin(L_array);
</pre><p>位相余裕を C の関数としてプロットできるようになりました。</p><pre class="codeinput">plot(C*1e12,Pm,<span class="string">'g'</span>);

set(gca,<span class="string">'XLim'</span>,[0.8 3.6],<span class="string">'YLim'</span>,[45 60],<span class="string">'Box'</span>,<span class="string">'on'</span>)
xlabel(<span class="string">'Compensation Capacitor, C (pF)'</span>);
ylabel(<span class="string">'Phase Margin (deg)'</span>)

<span class="comment">% Plot Annotations</span>
opampdemo_annotate(4)
</pre><img vspace="5" hspace="5" src="../opampdemo_08.png" alt=""> <p>C=2pF (2e-12) の場合は、58 度の最大位相余裕が取得されます。</p><p>C=2pF に対応するモデルは、LTI 配列 b_array(s) 内の 6 番目のモデルです。このモデルの閉ループ システムのステップ応答をプロットするには、LTI 配列 A_array(s) のインデックス 6 を選択します。</p><pre class="codeinput">A_comp = A_array(:,:,6);
stepplot(A,<span class="string">'b:'</span>,A_comp,<span class="string">'b'</span>)
legend(<span class="string">'Uncompensated (0 pF)'</span>,<span class="string">'Compensated (2 pF)'</span>)
</pre><img vspace="5" hspace="5" src="../opampdemo_09.png" alt=""> <p>整定時間がさらに (85%) 短縮されました。</p><p>BODE コマンドを使用すると、3 つのすべてのモデル (開ループ、閉ループ、補償済み閉ループ) の周波数応答を重ね合わせることができます。</p><pre class="codeinput">bodeplot(a,<span class="string">'r'</span>,A,<span class="string">'b:'</span>,A_comp,<span class="string">'b'</span>)
legend(<span class="string">'a(s)'</span>,<span class="string">'A(s)'</span>,<span class="string">'A\_comp(s)'</span>);
</pre><img vspace="5" hspace="5" src="../opampdemo_10.png" alt=""> <p>補償コンデンサーを追加したことによって、閉ループ ゲインにおけるピーキングが解消され、位相余裕が大きく拡大されました。</p><h2>まとめ<a name="40"></a></h2><p>非反転フィードバック アンプ回路の設計におけるコンポーネント値の選択を簡潔にまとめると、次のようになります。</p><div><ul><li>最終コンポーネント値: R1 = 10 kΩ、R2 = 90 kΩ、C =  2 pF</li></ul></div><div><ul><li>抵抗性フィードバック ネットワーク (R1,R2) は、10 (20 dB) の広帯域アンプ ゲインを生成するために選択されました。</li></ul></div><div><ul><li>フィードバック リード補償器は、交差周波数の近傍でループ ゲインを調整するために使用されました。補償コンデンサー C の値は、約 58 度の最大位相余裕を提供するように最適化されました。</li></ul></div><p class="footer">Copyright 1986-2009 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Feedback Amplifier Design % This demo demonstrates the design of a non-inverting feedback % amplifier circuit using Control System Toolbox(TM). This design % is built around the operational amplifier (op amp), a standard % building block of electrical feedback circuits. % % This tutorial demonstrates how a real electrical system can be % designed, modeled, and analyzed using the tools provided by  % Control System Toolbox.  % Copyright 1986-2009 The MathWorks, Inc. % $Revision: 1.1.4.2.2.1 $  $Date: 2010/07/29 21:28:40 $  %% Op Amp Description % The standard building block of electrical feedback circuits is % the operational amplifier (op amp), a differential voltage % amplifier designed to have extremely high dc gain, often in % the range of 1e5 to 1e7. %  % The electrical symbol for the op amp is shown below. % % <<../Figures/opampdemofigures_01.png>>   %% % This demo assumes the use of an uncompensated op amp with 2 % poles (at frequencies w1,w2) and high dc gain (a0).  Assuming % this op amp is operated in its linear mode (not saturated),  % then its open-loop transfer function can be represented as a % linear time-invariant (LTI) system, as shown above. %  % Though higher-order poles will exist in a physical op amp, it % has been assumed in this case that these poles lie in a frequency % range where the magnitude has dropped well below unity. %  % *Open-Loop Transfer Function:* %  % $$ a(s)=\frac{a_0}{(1+s/\omega_1)(1+s/\omega_2)} $$  %% % The following system parameters are assumed: %  % $$ a_0 = 1e5 $$ % % $$ \omega_1 = 1e4 $$ % % $$ \omega_2 = 1e6 $$  a0 = 1e5; w1 = 1e4; w2 = 1e6;  %%  % Next, you want to create a transfer function model of this system % using Control System Toolbox.  This model will be stored in % the MATLAB(R) workspace as an LTI object.  %% % First, define the Laplace variable, s, using the TF command.  Then % use 's' to construct the open-loop transfer function, a(s): %  s = tf('s');           a = a0/(1+s/w1)/(1+s/w2)     %% % You can view the frequency response of a(s) using the BODEPLOT command: %  h = bodeplot(a,'r');  setoptions(h,'FreqUnits','rad/sec','MagUnits','dB','PhaseUnits','deg',...     'YLimMode','Manual','YLim',{[0,110],[-180,0]});          %%   % Right-click on the plot to access a menu of properties for this % Bode Diagram.  Left-click on the curves to create moveable data % markers which can be used to obtain response details.   %% % You can view the normalized step response of a(s) using the STEPPLOT % and DCGAIN commands: %  a_norm = a / dcgain(a); stepplot(a_norm,'r')  title('Normalized Open-Loop Step Response'); ylabel('Normalized Amplitude');          %%   % Right-click on the plot and select "Characteristics -> Settling Time" % to display the settling time. Hold the mouse over the settling time % marker to reveal the exact value of the settling time.   %% Feedback Amplifier % Now add a resistive feedback network and wire the system as a % non-inverting amplifier. % % <<../Figures/opampdemofigures_02.png>>  % % This feedback network, b(s), is simply a voltage divider with % input Vo and output Vn.  Solving for the ratio Vn/Vo yields the % transfer function for b(s): %  %       b  =  Vn / Vo  =  R1 / (R1 + R2)     %% % The block diagram representation of the system is shown below. % % <<../Figures/opampdemofigures_03.png>>  % % Solving for the ratio Vo/Vp yields the closed-loop gain, A(s): %  %       A  =  Vo / Vp  =  a / (1 + ab) %   % If the product 'ab' is sufficiently large (>>1), then A(s) may % be approximated as %  %       A  =  1 / b   %% % Now assume that you need to design an amplifier of dc gain (Vo/Vp) 10 and % that R1 is fixed at 10 kOhm.  Solving for R2 yields:  A0 = 10; b = 1 / A0;    % approximation for ab>>1 R1 = 10000; R2 = R1 * (1/b - 1)   %% % Construct the closed-loop system using the FEEDBACK command: %  A = feedback(a,b);  %%   % Next, plot the frequency responses of a(s) and A(s) together % using the BODEMAG command: %  bodemag(a,'r',A,'b');  legend('Open-Loop Gain (a)','Closed-Loop Gain (A)') set(gca,'YLim',[0,110])  % Annotations opampdemo_annotate(1)    %% % The use of negative feedback to reduce the low-frequency (LF) gain % has led to a corresponding increase in the system bandwidth (defined % as the frequency where the gain drops 3dB below its maximum value). %  % This gain / bandwidth tradeoff is a powerful tool in the design of % feedback amplifier circuits. %  % Since the gain is now dominated by the feedback network, a useful % relationship to consider is the sensitivity of this gain to % variation in the op amp's natural (open-loop) gain.  %% % Before deriving the system sensitivity, however, it is useful to % define the loop gain, L(s)=a(s)b(s), which is the total gain a signal % experiences traveling around the loop: %   L = a * b;  %%  % You will use this quantity to evaluate the system sensitivity and % stability margins.  %% % The system sensitivity, S(s), represents the sensitivity of A(s) to % variation in a(s).   % % $$ S = \frac{\delta A/A}{\delta a/a}= \frac{1}{1+a(s)b(s)}=\frac{1}{1+L(s)} $$  %% % The inverse relationship between S(s) and L(s) % reveals another benefit of negative feedback: "gain desensitivity".  S = 1 / (1 + L);  %%  % S(s) has the same form as the feedback equation and, therefore, may % be constructed using the more-robust FEEDBACK command: %  S = feedback(1,L);  %% % The magnitudes of S(s) and A(s) may be plotted together using the % BODEMAG command: %  bodemag(A,'b',S,'g') legend('Closed-Loop Gain(A)', 'System Sensitivity(S)',4)  %%   % The very small low-frequency sensitivity (about -80 dB) indicates a % design whose closed-loop gain suffers minimally from open-loop gain % variation.  Such variation in a(s) is common due to manufacturing % variability, temperature change, etc.  %% % You can check the step response of A(s) using the STEPPLOT command: %  stepplot(A)  %Annotation opampdemo_annotate(2)  %% % Note that the use of feedback has greatly reduced the settling time (by % about 98%).  However, the step response now displays a large amount of % ringing, indicating poor stability margin.  %% % You can analyze the stability margin by plotting the loop gain, L(s), % with the MARGIN command: %  margin(L)  %%  % The resulting plot indicates a phase margin of less than 6 degrees. You % will need to compensate this amplifier in order to raise the phase margin % to an acceptable level (generally 45 deg or more), thus reducing % excessive overshoot and ringing.   %% Feedback Lead Compensation % A commonly used method of compensation in this type of circuit is % "feedback lead compensation".  This technique modifies b(s) by adding a % capacitor, C, in parallel with the feedback resistor, R2. %  % <<../Figures/opampdemofigures_04.png>> % % The capacitor value is chosen so as to introduce a phase lead to b(s) % near the crossover frequency, thus increasing the amplifier's phase % margin. %   %% % The new feedback transfer function is shown below. %  % <<../Figures/opampdemofigures_05.png>>  %% % You can approximate a value for C by placing the zero of b(s) at the 0dB % crossover frequency of L(s): %  [Gm,Pm,Wcg,Wcp] = margin(L); C = 1/(R2*Wcp)   %% % To study the effect of C on the amplifier response, create an LTI model % array of b(s) for several values of C around your initial guess: % % <<../Figures/opampdemofigures_06.png>>  %% K = R1/(R1+R2); C = [1:.2:3]*1e-12; for n = 1:length(C)     b_array(:,:,n) = tf([K*R2*C(n) K],[K*R2*C(n) 1]); end  %% % Now you can create LTI arrays for A(s) and L(s): %  A_array = feedback(a,b_array); L_array = a*b_array;  %%  % You can plot the step response of all models in the LTI array, % A_array(s), together with A(s) using the STEPPLOT command: %  stepplot(A,'b:',A_array,'b',[0:.005:1]*1.5e-6); title('Closed-Loop Step Response (Compensated)');          % Plot Annotations opampdemo_annotate(3)  %% % The phase margins for our loop gain array, L_array(s), are found using % the MARGIN command: %   [Gm,Pm,Wcg,Wcp] = margin(L_array);  %%   % The phase margins may now be plotted as a function of C.   plot(C*1e12,Pm,'g');  set(gca,'XLim',[0.8 3.6],'YLim',[45 60],'Box','on') xlabel('Compensation Capacitor, C (pF)'); ylabel('Phase Margin (deg)')  % Plot Annotations opampdemo_annotate(4)   %%  % A maximum phase margin of 58 deg is obtained when C=2pF (2e-12). % % The model corresponding to C=2pF is the sixth model in the LTI array, % b_array(s).  You can plot the step response of the closed- loop system % for this model by selecting index 6 of the LTI array A_array(s): %  A_comp = A_array(:,:,6); stepplot(A,'b:',A_comp,'b') legend('Uncompensated (0 pF)','Compensated (2 pF)')  %%   % Note that the settling time has been further reduced (by an % additional 85%).   %% % We can overlay the frequency-response of all three models (open-loop, % closed-loop, compensated closed-loop) using the BODE command: %  bodeplot(a,'r',A,'b:',A_comp,'b') legend('a(s)','A(s)','A\_comp(s)');  %%   % Note how the addition of the compensation capacitor has eliminated % peaking in the closed-loop gain and also greatly extended the phase % margin.   %% Summary % A brief summary of the choice of component values in the design of this % non-inverting feedback amplifier circuit: % % * Final component values: R1 = 10 kOhm, R2 = 90 kOhm, C =  2 pF. % % * A resistive feedback network (R1,R2) was selected to yield a %    broadband amplifier gain of 10 (20 dB). %  % * Feedback lead compensation was used to tune the loop gain near %    the crossover frequency.  The value for the compensation %    capacitor, C, was optimized to provide a maximum phase margin %    of about 58 degrees. %   displayEndOfDemoMessage(mfilename) ##### SOURCE END ##### --></body></html>