
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>PWM 駆動油圧サーボ機構のモデル作成</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="sf_electrohydraulic.m"><link rel="stylesheet" type="text/css" href="../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left">sf_electrohydraulic.mdl</div><div class="right"><a href="matlab:sf_electrohydraulic">このモデルを開く</a></div></div><div class="content"><h1>PWM 駆動油圧サーボ機構のモデル作成</h1><!--introduction--><p>このデモでは、Simulink&reg; と Stateflow&reg; を使用して、パルス幅変調 (PWM) ソレノイドによって制御される油圧サーボ機構のモデルを作成します。このタイプのモーション コントロール システムは、工業、製造、自動車、航空宇宙などのアプリケーションで使用されています。</p><p>このデモでは、非線形の微分方程式を使用して、システムの磁気、油圧、および機械コンポーネントのモデルを作成します。コントローラーは離散時間の微分方程式を使用して表現されます。Stateflow 内の動作モデルには、PWM 波形の生成とソレノイド電流の調整を行う電子回路が実装されます。図 1 は、この機構を示しています。</p><p><img vspace="5" hspace="5" src="../sf_electrohydraulic_HydroSchema.png" alt=""> </p><p><b>図 1:</b> ソレノイド バルブと油圧アクチュエータの概略ブロック線図</p><div><ul><li><b>メモ</b>: これは基本的な水力学のデモです。Simscape™ と SimHydraulics&reg; を使用して、水力学のモデルをより簡単に作成できます。SimHydraulics は、Simulink の拡張機能として、水力および制御システムのモデル作成およびシミュレーションのツールを備えています。これを使用すると、接続された油圧コンポーネントと機械コンポーネントを物理ネットワークとして含むマルチドメイン システムを記述できます。</li></ul></div><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">非線形の微分方程式を使用したモデル作成</a></li><li><a href="#20">離散時間の微分方程式を使用したコントローラー実装</a></li><li><a href="#21">Stateflow を使用した PWM 生成回路の動作モデルの実装</a></li></ul></div><h2>非線形の微分方程式を使用したモデル作成<a name="1"></a></h2><p>サーボ機構のバルブのモデルは次の 4 つの部分に分かれています。</p><div><ul><li>磁気回路</li><li>ソレノイド電機子の運動</li><li>油圧システム</li><li>ピストン運動</li></ul></div><p><b>磁気回路</b></p><p>まず、磁気回路について説明します。磁束の導関数は、ファラデーの法則によって次のようになります。</p><p><img src="../sf_electrohydraulic_eq57282.png" alt="$$\frac{d \phi}{d t} = \frac{v_{sol}- i R}{N}$$"></p><p>ここで、<img src="../sf_electrohydraulic_eq22942.png" alt="$v_{sol}$"> はソレノイド電圧、<img src="../sf_electrohydraulic_eq28128.png" alt="$i$"> は電流、<img src="../sf_electrohydraulic_eq85930.png" alt="$R$"> は巻き上げ抵抗、<img src="../sf_electrohydraulic_eq05153.png" alt="$N$"> は巻き上げ回数です。この方程式は、周辺の磁束と漏れ磁束が無視できるレベルであると想定しています。</p><p>また、磁束 <img src="../sf_electrohydraulic_eq26509.png" alt="$\phi$"> と磁束密度 <img src="../sf_electrohydraulic_eq73617.png" alt="$B$"> を関連付けるエア ギャップ断面積 <img src="../sf_electrohydraulic_eq31461.png" alt="$A$"> は鋼鉄の経路に均一に適用されると想定しています。</p><p><img src="../sf_electrohydraulic_eq69837.png" alt="$$B = \frac{\phi}{A}$$"></p><p>磁束密度は、空中および鋼鉄の磁場の強さに関連しています。空中での磁場の強さは次の式で計算されます。</p><p><img src="../sf_electrohydraulic_eq72458.png" alt="$$H_{air} = \frac{B}{\mu_0}$$"></p><p>ここで、<img src="../sf_electrohydraulic_eq66048.png" alt="$\mu_0$"> は空気の透磁率です。鋼鉄内では、非線形の関数によって磁場の強さ <img src="../sf_electrohydraulic_eq74869.png" alt="$H_{steel}$"> が磁束密度 <img src="../sf_electrohydraulic_eq73617.png" alt="$B$"> に関連付けられています。</p><p><img src="../sf_electrohydraulic_eq78049.png" alt="$$H_{steel} = f(B)$$"></p><p>このデモではヒステリシスのモデルが作成されていないので注意してください。空中の磁場と鋼鉄内の磁場の組み合わせによって、次のような動磁力が得られます。</p><p><img src="../sf_electrohydraulic_eq45175.png" alt="$$MMF = H_{air} g + H_{steel} L_{steel}$$"></p><p>ここで、<img src="../sf_electrohydraulic_eq31049.png" alt="$g$"> はエア ギャップの長さ、<img src="../sf_electrohydraulic_eq17995.png" alt="$L_{steel}$"> は鋼鉄の磁気回路の長さです。</p><p>最後にもう 1 つ、磁気回路内のループを閉じて電流 <img src="../sf_electrohydraulic_eq28128.png" alt="$i$"> を得るために次の式が必要です。</p><p><img src="../sf_electrohydraulic_eq58613.png" alt="$$i = \frac{MMF}{N}$$"></p><p>機械コンポーネントでは、ソレノイドによって得られる力は次のように計算されます。</p><p><img src="../sf_electrohydraulic_eq26590.png" alt="$$F_{sol} = \frac{A B^2}{2 \mu_0}$$"></p><p>Simulink で実装すると、磁気回路の式は次のようになります。</p><img vspace="5" hspace="5" src="../sf_electrohydraulic_01.png" alt=""> <p><b>図 2:</b> ソレノイド磁気回路サブシステム</p><p><b>ソレノイド電機子の運動</b></p><p>ソレノイドの可動部分である電機子の運動は、次のように磁気、油圧、および機械的な力の組み合わせによって生成されます。</p><p><img src="../sf_electrohydraulic_eq97861.png" alt="$$ m \frac{d^2 x}{d t^2} = F_{sol} + A_0 P_s - F_{s0} - K_s x - C_v x\cdot$$"></p><p>ここで、<img src="../sf_electrohydraulic_eq09021.png" alt="$A_0$"> は供給オリフィス面積、<img src="../sf_electrohydraulic_eq01004.png" alt="$P_s$"> は油圧回路の供給圧力、<img src="../sf_electrohydraulic_eq92952.png" alt="$F_{s0}$"> はスプリング プリロード、<img src="../sf_electrohydraulic_eq51796.png" alt="$K_s$"> はスプリング戻り速度、<img src="../sf_electrohydraulic_eq17739.png" alt="$C_v$"> は減衰率です。</p><p>Simulink では、この式は図 3 のように Second-Order Integrator ブロックを使用して実装されます。</p><img vspace="5" hspace="5" src="../sf_electrohydraulic_02.png" alt=""> <p><b>図 3:</b> 電機子の運動サブシステム</p><p><b>油圧回路</b></p><p>油圧回路内の流れは、ソレノイド電機子の動きによって制御されます。このシステムの概略図は次のとおりです。</p><p><img vspace="5" hspace="5" src="../sf_electrohydraulic_Solenoid.png" alt=""> </p><p><b>図 4:</b> ソレノイドの概略図</p><p>この図は、磁気回路に電流が流れていないときに、内部のスプリングが電機子とボールを押して圧力 <img src="../sf_electrohydraulic_eq01004.png" alt="$P_s$"> の供給を遮断することを示しています。供給圧力 <img src="../sf_electrohydraulic_eq01004.png" alt="$P_s$"> が遮断されると、制御圧力 <img src="../sf_electrohydraulic_eq70770.png" alt="$P_c$"> は排出に向けられます。ソレノイドに電流が流れると、電機子と電極が接触し、供給圧力 <img src="../sf_electrohydraulic_eq01004.png" alt="$P_s$"> がボールを押して供給ポートを開き、排出ポートを遮断します。</p><p>供給システムからピストンへのオイル流量 <img src="../sf_electrohydraulic_eq75643.png" alt="$q_{net}$"> は、供給流量と排出流量の組み合わせになります。</p><p><img src="../sf_electrohydraulic_eq25839.png" alt="$$ q_{net} = q_{s} - q_{ex} $$"></p><p>供給流量は次のように計算されます。</p><p><img src="../sf_electrohydraulic_eq79669.png" alt="$$ q_{s} = K_0 A_0 sgn(P_s - p_c) \sqrt{|P_s-p_c|}$$"></p><p>ここで、<img src="../sf_electrohydraulic_eq28128.png" alt="$p_c$"> は制御圧力、<img src="../sf_electrohydraulic_eq16303.png" alt="$K_0$"> は流量係数です。排出流量は次のように計算されます。</p><p><img src="../sf_electrohydraulic_eq74481.png" alt="$$ q_{ex} = K_0 A_0 \sqrt{p_c} $$"></p><p>Simulink では、供給と排出の方程式は If Action サブシステムによって実行されます。これらのサブシステムは電機子の位置に基づいてアクティブになります。</p><img vspace="5" hspace="5" src="../sf_electrohydraulic_03.png" alt=""> <p><b>図 5:</b> バルブ流量サブシステム</p><img vspace="5" hspace="5" src="../sf_electrohydraulic_04.png" alt=""> <p><b>図 6:</b> オリフィス流量サブシステム</p><p>油圧回路を完成させるには、制御圧力を計算しなければなりません。この圧力は、回路内の正味オイル流量 <img src="../sf_electrohydraulic_eq75643.png" alt="$q_{net}$"> とピストン位置 <img src="../sf_electrohydraulic_eq43894.png" alt="$x_p$"> の関数になります。</p><p><img src="../sf_electrohydraulic_eq60984.png" alt="$$\frac{d p_c}{d t} = \frac{\beta}{x_p A_p}(q_{net} - \frac{d x_p}{d t} A_p)$$"></p><p>ここで、<img src="../sf_electrohydraulic_eq42727.png" alt="$\beta$"> はオイルの体積弾性率、<img src="../sf_electrohydraulic_eq37525.png" alt="$A_p$"> はシリンダーの断面積です。</p><p>Simulink では、これは次のように実装されます。</p><img vspace="5" hspace="5" src="../sf_electrohydraulic_05.png" alt=""> <p><b>図 7:</b> シリンダー加圧システム</p><p><b>ピストン運動</b></p><p>ピストン運動の方程式は次のようになります。</p><p><img src="../sf_electrohydraulic_eq90207.png" alt="$$M_p \frac{d x^2}{d t} = p_p A_p - K_{sp} x_p $$"></p><p>ここで、<img src="../sf_electrohydraulic_eq51128.png" alt="$M_p$"> は正味アクチュエーター重量、<img src="../sf_electrohydraulic_eq84852.png" alt="$k_{sp}$"> はスプリング戻り速度です。</p><p>Simulink では、この式は次のように Second-Order Integrator ブロックを使用して実装されます。</p><img vspace="5" hspace="5" src="../sf_electrohydraulic_06.png" alt=""> <p><b>図 8:</b> ピストン運動サブシステム</p><h2>離散時間の微分方程式を使用したコントローラー実装<a name="20"></a></h2><p>このシステムの目的は、負荷 <img src="../sf_electrohydraulic_eq43894.png" alt="$x_p$"> を時変設定値 <img src="../sf_electrohydraulic_eq23777.png" alt="$r_{set}$"> に追従するように配置することです。電子コントローラーはコマンドと設定値を比較して、PWM 制御信号を 50 Hz のレートで生成します。ここでは離散時間 PI 制御則を採用します。</p><p><img src="../sf_electrohydraulic_eq00739.png" alt="$$dutycycle = (K_p + \frac{K_I}{z-1})(r_{set}-x_p)$$"></p><p>制御信号は 50 Hz のパルス列に適用され、パワー エレクトロニクスがパルス信号をソレノイド電流に変換します。</p><h2>Stateflow を使用した PWM 生成回路の動作モデルの実装<a name="21"></a></h2><p>この機能を実行するためにデジタルとアナログの集積回路を使用できるので、ここでは詳細な物理モデルではなく動作モデルを使用します。動作を記述するには、コマンドに対する回路の反応とその負荷の応答という観点で記述するのが最も良い方法です。図 9 は制御回路の通常サイクルでの電圧と電流を示しています。</p><p><img vspace="5" hspace="5" src="../sf_electrohydraulic_PWM.png" alt=""> </p><p><b>図 9:</b> 1 パルス内での PWM 信号の電圧および電流の動作</p><p>各サイクルの開始時に、PWM パルスがオンになって、電機子を電極に押し付け、加圧バルブを開きます。その時点でドライバー回路は、最も速い初期電流の立ち上げを達成するために、最大電圧を適用します。電流が上昇して、磁力と油圧力がスプリングの抵抗に打ち勝って電機子を動かすレベルに達するまで、ソレノイドはこの状態を維持します。</p><p>電機子が引き込まれると、エア ギャップが非常に小さくなり、電機子を引き込んだままにするための電流は少なくて済みます。このドライバーは、サイクルがオンになっている残りの期間にわたって、電流を低レベルに調整します。</p><p>各パルスの終了時には、電機子が解放され、ボールが元の位置に戻って排出口が開きます。これは、磁場が急速に消滅するようにソレノイド回路を開くことによって行われます。その後は、次のサイクルが開始するまでのオフ期間、電流はゼロのままです。</p><p>このように、PWM サイクルのオン期間は電機子を引き付けて維持する期間です。オフ期間は、電圧と電流の急激な低下で始まり、ゼロにとどまる期間です。</p><p>これは Stateflow 内で次のように実装できます。</p><img vspace="5" hspace="5" src="../sf_electrohydraulic_07.png" alt=""> <p><b>図 10:</b> Stateflow での PWM ドライバー回路の実装</p><p class="footer">Copyright 2010 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Modeling a PWM Driven Hydraulic Servomechanism %  % This demo uses Simulink(R) and Stateflow(R) to model a hydraulic % servomechanism controlled by a pulse-width modulated (PWM) solenoid. This % type of motion control system is used in industrial, manufacturing, % automotive and aerospace applications. % % In this demo, nonlinear differential equations are used to model the % magnetic, hydraulic and mechanical components of the system. % Discrete-time difference equations are used to represent the controller. % A behavioral model in Stateflow implements the electronic circuit % generating the PWM waveforms and regulating the solenoid current. Figure % 1 shows a schematic of this mechanism. % % <<../sf_electrohydraulic_HydroSchema.png>> % % *Figure 1:* Schematic diagram of the Solenoid valve and hydraulic % actuator % % * *Note*: This is a basic hydraulics demo. You can more easily build % hydraulic models using Simscape(TM) and SimHydraulics(R). SimHydraulics % extends Simulink with tools for modeling and simulating hydraulic power % and control systems. It enables you to describe multi-domain systems % containing connected hydraulic and mechanical components as physical % networks. % % %% Modeling the System Using Nonlinear Differential Equations % % The model of the servomechanism valve is divided in four parts: % % * Magnetic Circuit % * Solenoid Armature Motion % * Hydraulic System % * Piston Motion % % *Magnetic Circuit* % % Consider first the magnetic circuit. The derivative of the magnetic flux % is determined by Faraday's law as: % % $$\frac{d \phi}{d t} = \frac{v_{sol}- i R}{N}$$ % % where $v_{sol}$ is the solenoid voltage, $i$ is the current, $R$ is the % winding resistance and $N$ the number of turns. This equation assumes % that fringing and leakage flux are negligible, as are eddy currents. % % We assume that the cross-sectional area of the air gap $A$ which relates % the flux $\phi$ and the flux density $B$ at the air gap applies % uniformly for the steel path so that: % % $$B = \frac{\phi}{A}$$ % % The flux density is linked to the magnetic field intensity in the air and % the steel. In the air, magnetic field intensity is computed by: % % $$H_{air} = \frac{B}{\mu_0}$$ % % where $\mu_0$ is the permeability of air. In the steel, the magnetic % field intensity $H_{steel}$ is linked to the flux density $B$ through a % nonlinear function so that: % % $$H_{steel} = f(B)$$ % % Note that the hysteresis is not modeled in this demo. The combination of % the magnetic fields in the air and the steel gives us the magnetomotive % force: % % $$MMF = H_{air} g + H_{steel} L_{steel}$$ % % where $g$ is the length of the air gap and $L_{steel}$ is the length of the  % steel magnetic circuit.  % % One last equation is now required to close the loop and obtain the % current $i$ in the magnetic circuit by: % % $$i = \frac{MMF}{N}$$ % % On the mechanical side, the force developed by the solenoid is computed % as: % % $$F_{sol} = \frac{A B^2}{2 \mu_0}$$ % % Implemented in Simulink, magnetic circuit equations look like: % %%  %   Copyright 2010 The MathWorks, Inc.  open_system('sf_electrohydraulic', 'loadonly'); open_system(['sf_electrohydraulic/Magnetic', char(10), 'Circuit']);  %% close_system('sf_electrohydraulic',0);  %% % *Figure 2:* Solenoid magnetic circuit subsystem % % *Solenoid Armature Motion* % % The motion of the solenoid moving part, the armature, is generated by a % combination of magnetic, hydraulic and mechanical forces: %  % $$ m \frac{d^2 x}{d t^2} = F_{sol} + A_0 P_s - F_{s0} - K_s x - C_v x\cdot$$ %  % where $A_0$ is the supply orifice area, $P_s$ is the hydraulic circuit % supply pressure, $F_{s0}$ is the spring preload, $K_s$ is the return spring % rate and $C_v$ is the damping rate. % % In Simulink this equation is implemented using the Second-Order % Integrator block as show on figure 3.  %% open_system('sf_electrohydraulic', 'loadonly'); open_system(['sf_electrohydraulic/Armature' char(10),'Motion']);  %% close_system('sf_electrohydraulic',0);  %% % *Figure 3:* Armature motion subsystem % % % *Hydraulic Circuit* % % The flow in the hydraulic circuit is controlled by the motion of the % solenoid armature. A schematic of this system is displayed in the % following diagram % % <<../sf_electrohydraulic_Solenoid.png>> % % *Figure 4:* Solenoid Schematic % % This diagram shows that when no current is applied to the magnetic % circuit, the internal spring pushes the armature and ball to block the % supply pressure $P_s$. When the supply pressure $P_s$ is blocked, the % control pressure $P_c$ is directed toward the exhaust. When the solenoid % is energized, the armature and pole come together and the supply pressure % $P_s$ pushes the ball to open the supply port and block the exhaust port. % % The oil flow directed from the supply system to the piston, $q_{net}$, is % the combination of the supply flow and the exhaust flow. % % $$ q_{net} = q_{s} - q_{ex} $$ % % The supply flow is computed has: % % $$ q_{s} = K_0 A_0 sgn(P_s - p_c) \sqrt{|P_s-p_c|}$$ % % where $p_c$ is the control pressure and $K_0$ is the flow coefficient. % The exhaust flow is computed has % % $$ q_{ex} = K_0 A_0 \sqrt{p_c} $$ % % In Simulink, the supply and exhaust equations are implemented using If % Action Subsystems. These subsystems are activated based on the armature % position. %   %% open_system('sf_electrohydraulic', 'loadonly'); open_system('sf_electrohydraulic/Hydraulic System/Valve Flows');  %% close_system('sf_electrohydraulic',0);  %%  % *Figure 5:* Valve flows subsystem %   %% open_system('sf_electrohydraulic', 'loadonly'); open_system('sf_electrohydraulic/Hydraulic System/Valve Flows/Source Flow','force'); close_system('sf_electrohydraulic/Hydraulic System/Valve Flows'); %% close_system('sf_electrohydraulic',0);  %%  % *Figure 6:* Orifice flow subsystem % % To complete the hydraulic circuit, the control pressure must be computed. % This pressure is a function of the net oil flow in the circuit $q_{net}$ % and the piston position $x_p$ as: % % $$\frac{d p_c}{d t} = \frac{\beta}{x_p A_p}(q_{net} - \frac{d x_p}{d t} A_p)$$ % % where $\beta$ is the oil bulk modulus and $A_p$ is the cross-sectional % area of the cylinder. % % In Simulink this is implemented as: %  %% open_system('sf_electrohydraulic', 'loadonly'); open_system('sf_electrohydraulic/Hydraulic System/Cylinder Pressurization');  %% close_system('sf_electrohydraulic',0);  %% % *Figure 7:* Cylinder Pressurization Subsystem % % *Piston Motion* % % The piston's equation of motion is: % % $$M_p \frac{d x^2}{d t} = p_p A_p - K_{sp} x_p $$ % % where $M_p$ is the net actuator mass and $k_{sp}$ is the spring rate. % % In Simulink this equation is implemented using the Second-Order % Integrator block as: %  %% open_system('sf_electrohydraulic', 'loadonly'); open_system('sf_electrohydraulic/Piston Motion');  %% close_system('sf_electrohydraulic',0);  %% % *Figure 8:* Piston Motion Subsystem % % %% Implementing the Controller Using Discrete-Time Difference Equations  % % The objective of the system is to position the load $x_p$ so that it % follows a time-varying set point $r_{set}$. An electronic controller % compares the command and set point to generate a PWM control signal at a % rate of 50 Hz. We employ a discrete-time PI control law: % % $$dutycycle = (K_p + \frac{K_I}{z-1})(r_{set}-x_p)$$ % % The control signal is applied to a 50 Hz pulse train and the power electronics  % converts the pulse signal to the solenoid current. % %% Implementing the Behavioral Model of a PWM Generating Circuit Using Stateflow % % Digital and analog integrated circuits are available to perform this % function, so we use a behavioral model rather than a highly detailed % physical model. The behavior is best described in terms of the circuit's % reaction to the commands and the response of it's load. The voltage and  % current for one typical cycle of the control circuit show in figure 9. % % <<../sf_electrohydraulic_PWM.png>> % % *Figure 9:* Voltage and current behavior of the PWM signal within one % pulse. % % At the beginning of each cycle, the PWM pulse turns on to push the % armature against the pole and open the valve supplying pressure. At that % time the driver circuit applies the full voltage to achieve the fastest % initial rise in current. The solenoid maintains this condition until the % current as risen to the level at which the magnetic and hydraulic forces % overcome the spring and move the armature. % % Once the armature has been pulled in, the air gap is very small and less % current is needed to hold the armature in place. The driver regulates the % current at a lower level for the remainder of the "on" portion of the % cycle. % % At the end of each pulse, the armature releases so that the ball returns % to its original position to open the exhaust. This is achieved by opening % the solenoid circuit so that the magnetic field collapses quickly. The % current then remains at zero for the duration of the "off" time until the % next cycle begins. % % % This way, the "on" portion of the PWM cycle is composed of the "pull in"  % and "hold". The "off" portion is characterized by the initial rapid decay,  % followed by zero voltage and current.   % % This can be implemented in Stateflow as: %  %% open_system('sf_electrohydraulic', 'loadonly'); rt = sfroot; machine = rt.find('-isa','Stateflow.Machine','Name','sf_electrohydraulic'); PWM_Driver_Circuit_Chart = machine.find('-isa','Stateflow.Chart','Name','PWM Driver Circuit'); PWM_Driver_Circuit_Chart.visible = 1;  %% close_system('sf_electrohydraulic',0);  %% % *Figure 10:* Stateflow implementation of the PWM driver circuit                       ##### SOURCE END ##### --></body></html>