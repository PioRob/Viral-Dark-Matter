
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>データ ストアを使用したインスタンスごとのメモリへのアクセス</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="rtwdemo_autosar_PIM_script.m"><link rel="stylesheet" type="text/css" href="../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit rtwdemo_autosar_PIM_script">エディターで rtwdemo_autosar_PIM_script.m を開く</a></div><div class="right"><a href="matlab:echodemo rtwdemo_autosar_PIM_script">コマンド ウィンドウで実行</a></div></div><div class="content"><h1>データ ストアを使用したインスタンスごとのメモリへのアクセス</h1><!--introduction--><p>このデモでは、インスタンスごとのメモリで AUTOSAR ソフトウェア コンポーネントを変換する方法を示します。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">インスタンスごとのメモリの概要</a></li><li><a href="#2">インスタンスごとのメモリのモデル作成</a></li><li><a href="#4">複数実行エンティティでデータ ストアにアクセスする際のデータ整合性の実現</a></li><li><a href="#5">データ ストアを使用した不揮発性メモリのミラー</a></li><li><a href="#6">メモ: オーサーリング ツールへのマージ</a></li><li><a href="#7">詳細情報</a></li></ul></div><h2>インスタンスごとのメモリの概要<a name="1"></a></h2><p>インスタンスごとのメモリは、ソフトウェア コンポーネント内でインスタンス固有のグローバル メモリを指定するために AUTOSAR によって提供される機能です。AUTOSAR ランタイム環境のジェネレーターはこのメモリを割り当て、このメモリにアクセスするための API を提供します。</p><h2>インスタンスごとのメモリのモデル作成<a name="2"></a></h2><p>Simulink&reg; モデルでインスタンスごとのメモリを使用するには、&quot;PerInstanceMemory&quot; カスタム ストレージ クラスを指定する AUTOSAR.Signal データ オブジェクトと共に Data Store Memory ブロックを追加します。<tt>rtwdemo_autosar_PIM</tt> モデルを開いて、この使用例を参照してください。</p><pre class="codeinput">open_system(<span class="string">'rtwdemo_autosar_PIM'</span>)
</pre><img vspace="5" hspace="5" src="../rtwdemo_autosar_PIM_script_01.png" alt=""> <p>AUTOSAR.Signal オブジェクトの <tt>nvmImplicitRExplicitW</tt> および <tt>nvmImplicitRW</tt> がベース ワークスペースに作成され、モデル内の Data Store Memory ブロックによって参照されています。このモデルのために生成された C コードでは、それぞれ関数 <tt>Rte_Pim_nvmImplicitRExplicitW()</tt> および <tt>Rte_Pim_nvmImplicitRW()</tt> を介してデータ ストアの値にアクセスしています。</p><h2>複数実行エンティティでデータ ストアにアクセスする際のデータ整合性の強制<a name="4"></a></h2><p>ソフトウェア コンポーネントの内部動作のために生成された XML ファイルには、インスタンスごとのメモリを参照する各 Data Store Memory ブロックの専用領域が設けられています。このインスタンスごとのメモリにアクセスする実行エンティティは、対応する専用領域内で実行されます。複数の AUTOSAR 実行エンティティが同じ Data Store Memory ブロックにアクセスすると、エクスポートされた AUTOSAR の指定によって AUTOSAR 専用領域を使用することでデータの整合性が強制されます。この指定は、実行エンティティがインスタンスごとのメモリのグローバル データに相互排他的にアクセスできるようにし、データの破損を防止します。</p><h2>データ ストアを使用した不揮発性メモリのミラー<a name="5"></a></h2><p>AUTOSAR アプリケーションから不揮発性メモリにアクセスして利用するには、一般的なグローバル データの定義に加えて、インスタンスごとのメモリを不揮発性メモリのデータの RAM ミラーとして使用することができます。AUTOSAR には、不揮発性メモリの内容をインスタンスごとのメモリの RAM ミラーと同期させるための 2 つの動作モードがあります。<tt>rtwdemo_autosar_PIM</tt> モデルは、これらの 2 つのモードを示します。</p><div><ul><li>暗黙的読み取り、暗黙的書き込み</li></ul></div><p>ECU の起動時に、インスタンスごとのメモリの内容が NvM マネージャー モジュールによって初期化されます。コンポーネント内での実行エンティティの実行中にインスタンスごとのメモリ ブロックが更新され、その後で AUTOSAR サーバー処理 Nvm.setRamBlockStatus(true) が呼び出されると、電子コントロール ユニット (ECU) のシャットダウン中にメモリの内容が保存されます。</p><div><ul><li>暗黙的読み取り、明示的書き込み</li></ul></div><p>ECU の起動時に、インスタンスごとのメモリの内容が NvM マネージャー モジュールによって初期化されます。ソフトウェア コンポーネントの実行中、インスタンスごとのメモリの値が更新され、AUTOSAR サーバー処理 NvM.WriteBlock(NULL) が実行されると、メモリの内容が保存されます。この方法は、ECU のシャットダウンを待たずに不揮発性メモリに直ちに値を書き込むときに便利です。</p><p>AUTOSAR.Signal データ オブジェクトが PerInstanceMemory カスタム ストレージ クラスを指定すると、データ属性 &quot;needsNVRAMAccess&quot; を true に設定することで、このインスタンスごとのメモリを特定の不揮発性メモリ ブロックのミラー ブロックに指定することができます。この設定により、インスタンスごとのメモリが RAM ミラー ブロックとして使用され、NvM マネージャー モジュールで処理する必要があることを示すように、SERVICE-NEEDS エントリ (スキーマ バージョン 3.0) または NVRAM-MAPPINGS エントリ (スキーマ バージョン 2.1) がソフトウェア コンポーネントの内部動作で宣言されます。</p><h2>メモ: オーサーリング ツールへのマージ<a name="6"></a></h2><p>このデモでは不揮発性メモリを使用します。生成した XML ファイルを AUTOSAR オーサリング ツールにインポートする場合は、Data Store Memory ブロックによって参照されるサーバー インターフェイス (<a href="matlab:web(fullfile(matlabroot,'toolbox','rtw','rtwdemos','NvMInterface2.arxml'))">NvMInterface2.arxml</a>) を含める必要があります。</p><h2>詳細情報<a name="7"></a></h2><p><a href="matlab:helpview(fullfile(docroot,'toolbox','ecoder','helptargets.map'),'ecoder_autosar')">AUTOSAR ターゲットのドキュメンテーション</a></p><pre class="codeinput">bdclose(<span class="string">'rtwdemo_autosar_PIM'</span>)
clear <span class="string">nvmImplicitRExplicitW</span> <span class="string">nvmImplicitRW</span>
</pre><p class="footer">Copyright 2010 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Using Data Stores to Access Per-Instance Memory % This demonstration explains how to publish an AUTOSAR software component with  % per-instance memory.   %   Copyright 2010 The MathWorks, Inc.  %% Overview of Per-Instance Memory % Per-instance memory is a feature that AUTOSAR provides  % to specify instance-specific global memory within a software component. % An AUTOSAR run-time environment generator allocates this memory and provides  % an API for you to to access this memory.   %% Modeling Per-Instance Memory % To use per-instance memory in a Simulink(R) model, you can add a Data Store Memory  % block together with an AUTOSAR.Signal data object that specifies the  % "PerInstanceMemory" custom storage class.  Open the  % |rtwdemo_autosar_PIM| model to see an example of such usage. % open_system('rtwdemo_autosar_PIM')  %% % The AUTOSAR.Signal objects |nvmImplicitRExplicitW| and |nvmImplicitRW| have been  % created in the base workspace, and are referenced by the Data Store Memory  % blocks in the model.  In the C code generated for the model, the values of the % data stores are accessed via the functions  |Rte_Pim_nvmImplicitRExplicitW()| and  % |Rte_Pim_nvmImplicitRW()|, respectively.  %% Enforcing Data Consistency When Multiple Runnables Access a Data Store % The generated XML files for the internal behavior % of the software component will contain an exclusive area for each Data Store % Memory block that references per-instance memory. % Every runnable that accesses this per-instance memory  % runs inside its corresponding exclusive area.  % If multiple AUTOSAR runnables access to the same Data Store Memory block,  % the exported AUTOSAR specification enforces data consistency by using an  % AUTOSAR exclusive area.  This specification ensures that runnables will have % mutually exclusive access to the per-instance memory global data, preventing % data corruption.  %% Using Data Stores to Mirror Nonvolatile Memory % In addition to defining generic global data, you can use per-instance memory % as a RAM mirror for data in nonvolatile memory, in order to access and utilize  % nonvolatile memory from your AUTOSAR application. % AUTOSAR provides two modes of operation to synchronize the content in  % nonvolatile memory with the per-instance memory RAM mirror.  The % |rtwdemo_autosar_PIM| model demonstrates these two modes. % % * Implicit Read, Implicit write % % During ECU startup, the content in the per-instance memory is initialized by % the NvM manager module.  During shutdown of the electronic control unit (ECU) % the content is stored if % at any time during the execution of runnables within the component, the % per-instance memory block is updated and subsequently the  % AUTOSAR server operation Nvm.setRamBlockStatus(true) is invoked. %  % * Implicit Read, Explicit write % % During ECU startup, the content in the per-instance memory is initialized by % the NvM manager module.  During the execution of a software component, % the content is stored if the per-instance memory value is updated, and the  % AUTOSAR server operation NvM.WriteBlock(NULL) is executed. This technique is useful to  % write values immediately to the nonvolatile memory without waiting % for the ECU to shut down. % % Once an AUTOSAR.Signal data object specifies the PerInstanceMemory custom % storage class, you can specify this per-instance memory to be a mirror block % for a specific nonvolatile memory block by setting the data attribute  % "needsNVRAMAccess" to true. This setting ensures that a % SERVICE-NEEDS entry (in schema version 3.0) or NVRAM-MAPPINGS entry (in schema version 2.1)  % is declared in the internal behavior of the software component to indicate % that the per-instance memory is used as a RAM mirror block and needs to  % be serviced by the NvM manager module.  %% NOTE: Merge into the Authoring Tool % This demonstration makes use of nonvolatile memory. If you intend to import % the generated XML files into an AUTOSAR authoring tool, you should include the % server interface referenced by the Data Store Memory blocks % (<matlab:web(fullfile(matlabroot,'toolbox','rtw','rtwdemos','NvMInterface2.arxml')) % NvMInterface2.arxml>).  %% Further Information % % <matlab:helpview(fullfile(docroot,'toolbox','ecoder','helptargets.map'),'ecoder_autosar') AUTOSAR Target documentation>  bdclose('rtwdemo_autosar_PIM') clear nvmImplicitRExplicitW nvmImplicitRW  displayEndOfDemoMessage(mfilename)  ##### SOURCE END ##### --></body></html>