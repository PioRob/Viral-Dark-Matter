
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>複数のモデルに対するデータ ストアの利用</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="sldemo_mdlref_dsm.m"><link rel="stylesheet" type="text/css" href="../../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left">sldemo_mdlref_dsm.mdl</div><div class="right"><a href="matlab:sldemo_mdlref_dsm">このモデルを開く</a></div></div><div class="content"><h1>複数のモデルに対するデータ ストアの利用</h1><!--introduction--><p>このデモでは、ローカル データ ストアを使用、ログを作成する方法を説明します。また、グローバル データ ストアを定義、使用、ログを作成することにより、参照モデル間でグローバル データを共有する方法も示します。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#2">デモ モデルを開く</a></li><li><a href="#6">Simulink&reg; Signal オブジェクトを使用してグローバル データ ストアを定義</a></li><li><a href="#7">グローバル データ ストアのログ</a></li><li><a href="#8">モデルのシミュレーション</a></li><li><a href="#9">ログを作成された結果を表示</a></li></ul></div><h2>デモ モデルを開く<a name="2"></a></h2><p>デモ モデルを開きます。最上位モデル <tt>sldemo_mdlref_dsm</tt> からモデル <tt>sldemo_mdlref_dsm_bot</tt> および <tt>sldemo_mdlref_dsm_bot2</tt> が参照されます。[コンフィギュレーション パラメーター] ダイアログの [データのインポート/エクスポート] ペインで、<tt>sldemo_mdlref_dsm</tt> のデータ ストアのログはオンになっています。</p><p>参照モデル <tt>sldemo_mdlref_dsm_bot</tt> で入力信号が (正の場合は 5、負の場合は 2 だけ) 増幅され、この信号の値がローカル データ ストア <tt>RefSignalVal</tt> に書き込まれます。このローカル データ ストアは、書き込まれた値がすべてシミュレーション後にワークスペースにログを作成されるように設定されています。このローカル データ ストアのログ パラメーターは、ブロック パラメーター ダイアログの [ログ] タブで制御されます。</p><p>参照モデル <tt>sldemo_mdlref_dsm_bot2</tt> により、ErrorCond という名前のグローバル boolean データ ストアの値は、その入力信号の値が (-0.8, 0.8) の範囲外にある場合、true に設定されます。また、最上位モデルではデータ ストア ErrorCond and がモニターされ、2 つの参照モデルの出力が、このデータ ストアの値に応じて切り替えられます。</p><img vspace="5" hspace="5" src="../sldemo_mdlref_dsm_01.png" alt=""> <img vspace="5" hspace="5" src="../sldemo_mdlref_dsm_02.png" alt=""> <img vspace="5" hspace="5" src="../sldemo_mdlref_dsm_03.png" alt=""> <img vspace="5" hspace="5" src="../sldemo_mdlref_dsm_04.png" alt=""> <img vspace="5" hspace="5" src="../sldemo_mdlref_dsm_05.png" alt=""> <h2>Simulink&reg; Signal オブジェクトを使用してグローバル データ ストアを定義<a name="6"></a></h2><p>最上位モデルと両方の参照モデルが各モデルで ErrorCond という名前のデータ ストアに対して同じメモリを使用するということを Simulink に対して指定するには、ErrorCond という名前の <tt>Simulink.Signal</tt> オブジェクトのインスタンスをベース ワークスペースに作成します。このオブジェクトは各モデルに可視であるため、そのスコープは個々のモデルを網羅し、モデル間で共有されるその名前のグローバル データ ストアが 1 つ存在することを意味します。3 つのモデルはどれも、ErrorCond のデータ ストア名を持つ Data Store Memory ブロックを含んでいません。いずれかのモデルがこのようなブロックを含んでいれば、そのブロックではそのモデルにローカルなデータ ストアが定義されることになり、グローバル データ ストアは隠されます。</p><p>ErrorCond オブジェクトではグローバル データ ストアが定義されるため、<tt>DataType</tt>、<tt>Complexity</tt>、<tt>Dimensions</tt>、および <tt>SamplingMode</tt> プロパティが、継承されない設定に明示的に定義されなければなりません。<tt>SampleTime</tt> と <tt>StorageClass</tt> は、継承された値のままにしても明示的に設定しても構いません。</p><p>このデモには、ErrorCond という <tt>Simulink.Signal</tt> オブジェクトを含む <tt>sldemo_mdlref_dsm_data.mat</tt> という名前の MAT ファイルが含まれています。モデル <tt>sldemo_mdlref_dsm</tt> のプリロード関数によってこの MAT ファイルが読み込まれ、このオブジェクトがベース ワークスペースに読み込まれます。モデル エクスプローラー (<a href="matlab:daexplr">matlab:daexplr</a>) でベース ワークスペースを選択することにより、このオブジェクトを表示できます。MATLAB&reg; コマンド プロンプトからこのオブジェクトを作成することもできます。以下のコマンドにより、このデモで使用するオブジェクトが定義されます。</p><pre>   <pre>   ErrorCond = Simulink.Signal;
ErrorCond.Description = 'Use to signal that subsystem output is invalid';
ErrorCond.DataType = 'boolean';
ErrorCond.Complexity = 'real';
ErrorCond.Dimensions = 1;
ErrorCond.SamplingMode='Sample based';
ErrorCond.SampleTime = 0.1;
ErrorCond.LoggingInfo.DataLogging = true;</pre></pre><h2>グローバル データ ストアのログ<a name="7"></a></h2><p>グローバル データ ストアに書き込まれた値のすべてのログを作成するには、<tt>Simulink.Signal</tt> オブジェクトの <tt>LoggingInfo</tt> プロパティの <tt>DataLogging</tt> プロパティを設定します。<tt>LoggingInfo</tt> プロパティを設定することにより、間引きや点の最大数といったその他のログ パラメーターも指定できます。</p><pre>   Simulink.LoggingInfo (handle)
DataLogging: 1
NameMode: 0
LoggingName: ''
DecimateData: 0
Decimation: 2
LimitDataPoints: 0
MaxPoints:5000</pre><h2>モデルのシミュレーション<a name="8"></a></h2><p>これで、<tt>sldemo_mdlref_dsm</tt> をシミュレートして出力を確認できます。参照モデル <tt>sldemo_mdlref_dsm_bot</tt> からデータ ストア ErrorCond への書き込みの間に、データ ストアから最上位モデル <tt>sldemo_mdlref_dsm</tt> への読み込みが行われます。青いラインは <tt>sldemo_mdlref_dsm_bot</tt> への入力を表し、緑のラインは Switch ブロックの出力を表します。入力信号の大きさが範囲外になると、出力は切り替わります。</p><img vspace="5" hspace="5" src="../sldemo_mdlref_dsm_06.png" alt=""> <h2>ログを作成された結果の表示<a name="9"></a></h2><p>グローバル データ ストア ErrorCond とローカル データ ストア RefSignalVal はいずれも、書き込まれたすべての値がシミュレーション後にログが作成されるように設定されています。ログが作成されたこれらの結果は、変数 <tt>dsmout</tt> のベース ワークスペースに保存されています。</p><pre class="codeoutput">
dsmout = 

Simulink.SimulationData.Dataset
Package:Simulink.SimulationData

Characteristics:
Name:'dsmout'
Total Elements: 2

Elements:
1: 'ErrorCond'
2: 'RefSignalVal'

Use getElement to access elements by index or 
find to access elements by name.
</pre><p>ローカル データ ストアの保存データにアクセスするには、関数 <tt>find</tt> を使用して、RefSignalVal という名前に基づき正しいデータ ストア要素を取得します。</p><pre>   &gt;&gt; dsmout.find('RefSignalVal')</pre><pre class="codeoutput">
ans = 

Simulink.SimulationData.DataStoreMemory
Package:Simulink.SimulationData

Properties:
Name:'RefSignalVal'
BlockPath:[1x1 Simulink.SimulationData.BlockPath]
Scope:'local'
DSMWriterBlockPaths:[1x2 Simulink.SimulationData.BlockPath]
DSMWriters:[101x1 uint32]
Values:[1x1 timeseries]

</pre><p>データは <tt>Values</tt> フィールド内の <tt>timeseries</tt> に保存されています。</p><pre>   &gt;&gt; plot(dsmout.find('RefSignalVal').Values);</pre><img vspace="5" hspace="5" src="../sldemo_mdlref_dsm_07.png" alt=""> <p>ある時間にデータ ストアがどのブロックによって書き込まれたのかを知るには、<tt>DSMWriters</tt> プロパティを使用します。この配列には、<tt>DSMWriterBlockPaths</tt> 配列へのインデックスの一覧が含まれています。たとえば、データ ストアに 5 番目の値を書き込んだ Data Store Write ブロックのブロック パスは、以下のように取得できます。</p><pre>   &gt;&gt; <pre>   &gt;&gt; dsm = dsmout.find('RefSignalVal');
&gt;&gt; dsm.DSMWriterBlockPaths(dsm.DSMWriters(5))</pre><pre class="codeoutput">
ans = 

Simulink.SimulationData.BlockPath
Package:Simulink.SimulationData

Block Path:
'sldemo_mdlref_dsm/A'
'sldemo_mdlref_dsm_bot/PositiveSS/DSW'
</pre><p class="footer">Copyright 1990-2009 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Using Data Stores Across Multiple Models % This demo explains how to use and log local data stores. It also shows  %  how to define, use and log global data stores to share global data among  % referenced models.  %   Copyright 1990-2009 The MathWorks, Inc. %   $Revision: 1.1.4.10.2.1 $  $Date: 2010/07/29 21:29:17 $  %% origdir = sldemo_mdlref_util('sldemo_mdlref_dsm', 'setup');  %% Open the Demo Models % Open the demo models. The top model |sldemo_mdlref_dsm| references  % models |sldemo_mdlref_dsm_bot| and |sldemo_mdlref_dsm_bot2|.  % Logging of data stores is turned on for |sldemo_mdlref_dsm| on the  % Data Import/Export pane of the Configuration Parameters dialog. %  % Reference model |sldemo_mdlref_dsm_bot| amplifies the incoming signal by  % 5 if the signal is positive or by 2 if the signal is negative and writes   % the value of this signal to local data store |RefSignalVal|. This local  % data store is configured to log all written values to the workspace after % simulation. The logging parameters for this local data store are controlled % by the Logging tab of the block parameters dialog. % % Reference model |sldemo_mdlref_dsm_bot2| sets the value of a global  % boolean data store named ErrorCond to true if the value of its incoming  % signal is outside of the range (-0.8, 0.8). The top model also monitors  % the data store ErrorCond and switches between the outputs of the two  % referenced models, depending on the value of that data store. % open_system('sldemo_mdlref_dsm');  %% open_system('sldemo_mdlref_dsm_bot2');  %% open_system('sldemo_mdlref_dsm_bot');  %% open_system('sldemo_mdlref_dsm_bot/PositiveSS'); open_system('sldemo_mdlref_dsm_bot/NegativeSS');  %% Define a Global Data Store Using a Simulink(R) Signal Object % To specify to Simulink that the top model and both of the % referenced models use the same memory for the Data Store named ErrorCond  % in each model, create an instance of a |Simulink.Signal| object named  % ErrorCond in the base workspace.  Since this object is visible to each  % model, its scope encompasses the individual models and implies that there  % is one global data store of that name that is shared among the models.   % Note that none of the three models contains a Data Store Memory block with a % data store name of ErrorCond.  If any model contained such a block, that % block would define a data store local to the model, which would shadow the % global data store. % % Since the object ErrorCond defines a global data store, it must explicitly  % define the |DataType|, |Complexity|, |Dimensions|, and |SamplingMode| % properties to non-inherited settings.  |SampleTime| and |StorageClass| may  % be left as their inherited values, or explicitly set.  % % The demo includes a MAT-file named |sldemo_mdlref_dsm_data.mat| that  % contains the |Simulink.Signal| object ErrorCond. % The preload function of the model |sldemo_mdlref_dsm| loads this MAT-file  % causing the object to be loaded in the base workspace. You can view % this object by selecting the base workspace in the Model Explorer % (<matlab:daexplr>).  You can also create this object from the MATLAB(R) % command prompt.  The following commands define the object used in % this demo: % %     ErrorCond = Simulink.Signal; %     ErrorCond.Description = 'Use to signal that subsystem output is invalid'; %     ErrorCond.DataType = 'boolean'; %     ErrorCond.Complexity = 'real'; %     ErrorCond.Dimensions = 1; %     ErrorCond.SamplingMode='Sample based'; %     ErrorCond.SampleTime = 0.1; %     ErrorCond.LoggingInfo.DataLogging = true;  %% Logging a Global Data Store % To log all the values written to the global data store, set the % |DataLogging| property of the |LoggingInfo| property of the % |Simulink.Signal| object. The |LoggingInfo| property also allows % specification of other logging parameters such as decimation and maximum % points. % %     Simulink.LoggingInfo (handle) %             DataLogging: 1 %                NameMode: 0 %             LoggingName: '' %            DecimateData: 0 %              Decimation: 2 %         LimitDataPoints: 0 %               MaxPoints: 5000  %% Simulate the Model % Now you can simulate |sldemo_mdlref_dsm| to see the output.  The reference % model |sldemo_mdlref_dsm_bot| writes to the data store ErrorCond  % while the top model |sldemo_mdlref_dsm| reads from the data store.   % The blue line represents the  % input to |sldemo_mdlref_dsm_bot|; the green line represents the output of the  % Switch block.  Note that the output switches when the magnitude of the  % input signal falls outside of the range.  sldemo_mdlref_util('sldemo_mdlref_dsm', 'sim');  %% View Logged Results % Both the global data store ErrorCond and the local data store % RefSignalVal are configured to log all written values after simulation. % These logged results are stored in the base workspace in the |dsmout| % variable. display(dsmout);  %%  % To access the data stored for the local data store, use the |find| % function to get the correct data store element based on the name  % RefSignalVal.  % %     >> dsmout.find('RefSignalVal') display(dsmout.find('RefSignalVal'));  %% % Data is stored in a |timeseries| within the |Values| field. % %     >> plot(dsmout.find('RefSignalVal').Values); plot(dsmout.find('RefSignalVal').Values);  %% % To determine which block wrote to the data store at a given time, use the % |DSMWriters| property. This array contains a list of indices into the % |DSMWriterBlockPaths| array.  For example, the block path of the Data Store % Write block that wrote the 5th value to the data store can be obtained as % follows: % %     >> dsm = dsmout.find('RefSignalVal'); %     >> dsm.DSMWriterBlockPaths(dsm.DSMWriters(5)) display(dsmout.find('RefSignalVal').DSMWriterBlockPaths(dsmout.find('RefSignalVal').DSMWriters(5)));  %% sldemo_mdlref_util('sldemo_mdlref_dsm', 'close', origdir);  ##### SOURCE END ##### --></body></html>