
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>入れ子関数</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-26"><meta name="DC.source" content="nesteddemo.m"><link rel="stylesheet" type="text/css" href="../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit nesteddemo">エディターで nesteddemo.m を開く</a></div><div class="right"><a href="matlab:echodemo nesteddemo">コマンド ウィンドウで実行</a></div></div><div class="content"><h1>入れ子関数</h1><!--introduction--><p>このデモでは、入れ子関数を使用してデータ共有を簡単に行う方法の例を示し、カスタマイズ関数を作成する新しい方法を提供します。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">例 1:データの共有</a></li><li><a href="#4">例 2:カスタマイズ関数の作成</a></li><li><a href="#10">例 3:状態を持つカスタマイズ関数の作成</a></li></ul></div><h2>例 1:データの共有<a name="1"></a></h2><p>最初に、入れ子関数を含む <tt>taxDemo.m</tt> を見てみましょう。</p><pre class="codeinput">type <span class="string">taxDemo.m</span>
</pre><pre class="codeoutput">
function y = taxDemo(income)
%TAXDEMO Used by NESTEDDEMO.
% Calculate the tax on income.

% Copyright 1984-2004 The MathWorks, Inc. 
% $Revision: 1.1.4.8.2.1 $  $Date: 2010/07/29 21:28:52 $

AdjustedIncome = income - 6000; % Calculate adjusted income

% Call 'computeTax' without passing 'AdjustedIncome' as a parameter.

y = computeTax; 

    function y = computeTax
        
        % This function can see the variable 'AdjustedIncome'
        % in the calling function's workspace
        y = 0.28 * AdjustedIncome;
    end
end

</pre><p>入れ子関数 <tt>computeTax</tt> は、親関数のワークスペース内の変数を参照できます。これにより、複数の入れ子関数間で簡単にデータを共有することができるため、大きなデータ セットを処理する際に特に役立ちます。通常の方法で関数を 呼び出すことができます。</p><pre class="codeinput">y=taxDemo(80e3) <span class="comment">% What is the tax on $80k income?</span>
</pre><pre class="codeoutput">
y =

  2.0720e+004

</pre><p>入れ子関数については、<tt>end</tt> ステートメントが関数の終わりに必要です。任意のレベルに関数を入れ子にすることもできます。</p><h2>例 2:カスタマイズ関数の作成<a name="4"></a></h2><p>入れ子関数によってカスタマイズ関数を作成することも可能です。入れ子関数を含む <tt>makefcn.m</tt> を見てみましょう。</p><pre class="codeinput">type <span class="string">makefcn.m</span>
</pre><pre class="codeoutput">
function fcn = makefcn(a,b,c)
%MAKEFCN Used by NESTEDDEMO.
% This function returns a handle to a customized version of 'parabola'.
% a,b,c specifies the coefficients of the function.

% Copyright 1984-2004 The MathWorks, Inc. 
% $Revision: 1.1.4.8.2.1 $  $Date: 2010/07/29 21:28:52 $

fcn = @parabola;   % Return handle to nested function

    function y = parabola(x)
        % This nested function can see the variables 'a','b', and 'c'
        y = a*x.^2 + b.*x + c; 
    end
end

</pre><p><tt>makefcn</tt> を呼び出すと、カスタマイズ関数の関数ハンドルが返されます。以下に例を示します。</p><pre class="codeinput">f = makefcn(3,2,10);
g = makefcn(0,5,25);
</pre><p><tt>f</tt> と <tt>g</tt> は、それぞれ異なる係数を持つ 2 つの関数のハンドルです。これらの関数ハンドルを使用し、パラメーターを渡すことで関数を評価することができます。</p><pre class="codeinput">y=f(2)
</pre><pre class="codeoutput">
y =

    26

</pre><pre class="codeinput">y=g(2)
</pre><pre class="codeoutput">
y =

    35

</pre><p>最適化、積分など、関数を引数とする関数にハンドルを渡すことも可能です。</p><pre class="codeinput">minimum=fminbnd(f,-5,5);
</pre><p>または、ある範囲にわたって関数をプロットします。</p><pre class="codeinput">ezplot(f); <span class="comment">% Plot f over a range of x</span>
hold <span class="string">on</span>;
plot(2,f(2),<span class="string">'d'</span>); <span class="comment">% Plot a marker at (2,f(2))</span>
plot(minimum,f(minimum),<span class="string">'s'</span>); <span class="comment">% Plot at minimum of f</span>
text(minimum,f(minimum)-2,<span class="string">'Minimum'</span>);
h=ezplot(g); set(h,<span class="string">'color'</span>,<span class="string">'red'</span>) <span class="comment">% Plot g over a range of x</span>
plot(2,g(2),<span class="string">'rd'</span>);  <span class="comment">% Plot a marker at (2,g(2))</span>
hold <span class="string">off</span>;
</pre><img vspace="5" hspace="5" src="../nesteddemo_01.png" alt=""> <h2>例 3:状態を持つカスタマイズ関数の作成<a name="10"></a></h2><p>入れ子関数を含む <tt>makecounter.m</tt> を見てみましょう。</p><pre class="codeinput">type <span class="string">makecounter.m</span>
</pre><pre class="codeoutput">
function countfcn = makecounter(initvalue)
%MAKECOUNTER Used by NESTEDDEMO.
% This function returns a handle to a customized nested function 'getCounter'.
% initvalue specifies the initial value of the counter whose's handle is returned.

% Copyright 1984-2004 The MathWorks, Inc. 
% $Revision: 1.1.4.8.2.1 $  $Date: 2010/07/29 21:28:52 $

currentCount = initvalue; % Initial value
countfcn = @getCounter;   % Return handle to getCounter

    function count = getCounter
        % This function increments the variable 'currentCount', when it
        % gets called (using its function handle) .
        currentCount = currentCount + 1;
        count = currentCount;
    end
end

</pre><p><tt>makecounter</tt> を呼び出すと、入れ子関数 <tt>getCounter</tt> のハンドルが返されます。<tt>getCounter</tt> は、makecounter のワークスペース内で入れ子にすることで参照できる変数 initvalue の値でカスタマイズされます。</p><pre class="codeinput">counter1 = makecounter(0);  <span class="comment">% Define counter initialized to 0</span>
counter2 = makecounter(10); <span class="comment">% Define counter initialized to 10</span>
</pre><p>2 つのカスタマイズ カウンターを作成しました。1 つは 0 で始まるもので、もう 1 つは 10 で始まるものです。それぞれのハンドルは関数と呼び出し側のワークスペースの個別のインスタンスです。そのハンドルによって内部の入れ子関数を呼び出せます。<tt>counter1</tt> は、パラメーターを取りませんが、値を取得することはできます。</p><pre class="codeinput">counter1Value=counter1()
</pre><pre class="codeoutput">
counter1Value =

     1

</pre><p>親関数について 2 つの別々のワークスペースが確保されているので、2 つの関数を個別に呼び出せます。それらの入れ子関数へのハンドルが存在する間、それらはメモリに残ります。この場合、counter1 が呼び出されると、<tt>currentCount</tt> 変数は更新されます。</p><pre class="codeinput">counter1Value=counter1()
</pre><pre class="codeoutput">
counter1Value =

     2

</pre><pre class="codeinput">counter2Value=counter2()
</pre><pre class="codeoutput">
counter2Value =

    11

</pre><p class="footer">Copyright 1984-2006 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Nested Functions % This gives examples of how nested functions can be used for easy data % sharing, as well as providing a new way to create customized functions.  % Copyright 1984-2006 The MathWorks, Inc.  % $Revision: 1.1.4.8.2.1 $  $Date: 2010/07/29 21:28:52 $   %% Example 1: Sharing Data % Let's first take a look at |taxDemo.m|, which contains a nested function.  type taxDemo.m  %% % The nested function |computeTax| can see the variables in the parent function's % workspace. This makes sharing of data between multiple nested functions % easy and particularly useful when processing large data sets. We can call the function % in the usual way. y=taxDemo(80e3) % What is the tax on $80k income?  %% % For nested functions, the |end| statement is required at the end of a % function. You can also nest functions to any level.  %% Example 2: Creating Customized Functions % Nested functions allow the ability to create customized functions.  Let's look at |makefcn.m| % which contains a nested function. type makefcn.m  %% % When you call |makefcn|, it returns a function handle to a customized function. % For example: f = makefcn(3,2,10);  g = makefcn(0,5,25);  %% % |f| and |g| are handles to two functions, each with different % coefficients. We can evaluate the functions by using their function handles and passing  % in parameters.  y=f(2) %% y=g(2)  %% % We can also pass the handle to function functions, such as optimization % or integration. minimum=fminbnd(f,-5,5);  %% % Or plot the function over a range.  ezplot(f); % Plot f over a range of x hold on; plot(2,f(2),'d'); % Plot a marker at (2,f(2)) plot(minimum,f(minimum),'s'); % Plot at minimum of f text(minimum,f(minimum)-2,'Minimum'); h=ezplot(g); set(h,'color','red') % Plot g over a range of x plot(2,g(2),'rd');  % Plot a marker at (2,g(2)) hold off;  %% Example 3: Creating Customized Functions with State % Let's look at |makecounter.m| which contains a nested function. type makecounter.m  %% % When you call |makecounter|, it returns a handle to its nested % function |getCounter|. % |getCounter| is customized by the value of initvalue, a variable it % can see via nesting within the workspace of makecounter.  counter1 = makecounter(0);  % Define counter initialized to 0 counter2 = makecounter(10); % Define counter initialized to 10  %% % Here we have created two customized counters: one which starts at 0 and one % which starts at 10.  Each handle is a separate instance of the function and its % calling workspace. % Now we can call the inner nested function via its handle. % |counter1| does not take parameters but it could.   counter1Value=counter1()  %%  % We can call the two functions independently as there are two separate % workspaces for the parent functions kept. They remain in memory while the  % handles to their nested functions exist. In this case the |currentCount| % variable gets updated when counter1 is called.  counter1Value=counter1() %% counter2Value=counter2()   displayEndOfDemoMessage(mfilename) ##### SOURCE END ##### --></body></html>