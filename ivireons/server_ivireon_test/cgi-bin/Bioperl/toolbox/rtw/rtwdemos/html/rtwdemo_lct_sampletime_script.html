
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Specification of Block Sample Time</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-06-30"><meta name="DC.source" content="rtwdemo_lct_sampletime_script.m"><link rel="stylesheet" type="text/css" href="../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit rtwdemo_lct_sampletime_script">Open rtwdemo_lct_sampletime_script.m in the Editor</a></div><div class="right"><a href="matlab:echodemo rtwdemo_lct_sampletime_script">Run in the Command Window</a></div></div><div class="content"><h1>Specification of Block Sample Time</h1><!--introduction--><p>This demo shows you how to use the Legacy Code Tool to integrate legacy C functions with the block's sample time specified, inherited and parameterized.</p><p>The Legacy Code Tool allows you to:</p><div><ul><li>Provide the legacy function specification,</li><li>Generate a C-MEX S-function that is used during simulation to call the legacy code, and</li><li>Generate a block TLC file and optional rtwmakecfg.m file that is used during code generation to call the legacy code.</li></ul></div><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Providing the Legacy Function Specification</a></li><li><a href="#2">Generating S-Functions for Use During Simulation</a></li><li><a href="#3">Compiling the Generated S-Function for Simulation</a></li><li><a href="#4">Generating a TLC Block File for Code Generation</a></li><li><a href="#5">Generating an rtwmakecfg.m File for Code Generation</a></li><li><a href="#6">Generating a masked S-Function block for calling the generated S-Function</a></li><li><a href="#7">Demoing the Generated Integration with Legacy Code</a></li></ul></div><h2>Providing the Legacy Function Specification<a name="1"></a></h2><p>All functions provided with the Legacy Code Tool take a specific data structure or array of structures as the argument. The data structure is initialized by calling the function legacy_code() using 'initialize' as the first input. After initializing the structure, you have to assign its properties to values corresponding to the legacy code being integrated. For detailed help on the properties, call <a href="matlab:legacy_code('help')">legacy_code('help')</a>. The prototypes of the legacy functions being called in this demo are:</p><p>FLT gainScalar(const FLT in, const FLT gain)</p><p>where FLT is a typedef to float.  The legacy source code is found in the files <a href="matlab:sldemo_lct_util('edit','sldemo_lct_src/your_types.h')">your_types.h</a>, <a href="matlab:sldemo_lct_util('edit','sldemo_lct_src/gain.h')">gain.h</a>, and <a href="matlab:sldemo_lct_util('edit','sldemo_lct_src/gainScalar.c')">gainScalar.c</a>.</p><pre class="codeinput">defs = [];

<span class="comment">% rtwdemo_sfun_st_inherited</span>
def = legacy_code(<span class="string">'initialize'</span>);
def.SFunctionName = <span class="string">'rtwdemo_sfun_st_inherited'</span>;
def.OutputFcnSpec = <span class="string">'single y1 = gainScalar(single u1, single p1)'</span>;
def.HeaderFiles   = {<span class="string">'gain.h'</span>};
def.SourceFiles   = {<span class="string">'gainScalar.c'</span>};
def.IncPaths      = {<span class="string">'sldemo_lct_src'</span>};
def.SrcPaths      = {<span class="string">'sldemo_lct_src'</span>};
defs = [defs; def];

<span class="comment">% rtwdemo_sfun_st_fixed</span>
def = legacy_code(<span class="string">'initialize'</span>);
def.SFunctionName = <span class="string">'rtwdemo_sfun_st_fixed'</span>;
def.OutputFcnSpec = <span class="string">'single y1 = gainScalar(single u1, single p1)'</span>;
def.HeaderFiles   = {<span class="string">'gain.h'</span>};
def.SourceFiles   = {<span class="string">'gainScalar.c'</span>};
def.IncPaths      = {<span class="string">'sldemo_lct_src'</span>};
def.SrcPaths      = {<span class="string">'sldemo_lct_src'</span>};
def.SampleTime    = [2 1];
defs = [defs; def];

<span class="comment">% rtwdemo_sfun_st_parameterized</span>
def = legacy_code(<span class="string">'initialize'</span>);
def.SFunctionName = <span class="string">'rtwdemo_sfun_st_parameterized'</span>;
def.OutputFcnSpec = <span class="string">'single y1 = gainScalar(single u1, single p1)'</span>;
def.HeaderFiles   = {<span class="string">'gain.h'</span>};
def.SourceFiles   = {<span class="string">'gainScalar.c'</span>};
def.IncPaths      = {<span class="string">'sldemo_lct_src'</span>};
def.SrcPaths      = {<span class="string">'sldemo_lct_src'</span>};
def.SampleTime    = <span class="string">'parameterized'</span>;
defs = [defs; def];
</pre><h2>Generating S-Functions for Use During Simulation<a name="2"></a></h2><p>The function legacy_code() is called again with the first input set to 'sfcn_cmex_generate' in order to automatically generate C-MEX S-functions according to the description provided by the input argument 'defs'. The S-functions are used to call the legacy functions in simulation. The source code for the S-functions is found in the files <a href="matlab:rtwdemo_lct_util('edit','rtwdemo_sfun_st_inherited.c')">rtwdemo_sfun_st_inherited.c</a> and <a href="matlab:rtwdemo_lct_util('edit','rtwdemo_sfun_st_fixed.c')">rtwdemo_sfun_st_fixed.c</a>. <a href="matlab:rtwdemo_lct_util('edit','rtwdemo_sfun_st_parameterized.c')">rtwdemo_sfun_st_parameterized.c</a>.</p><pre class="codeinput">legacy_code(<span class="string">'sfcn_cmex_generate'</span>, defs);
</pre><h2>Compiling the Generated S-Function for Simulation<a name="3"></a></h2><p>After the C-MEX S-function source files are generated, the function legacy_code() is called again with the first input set to 'compile' in order to compile the S-function for simulation with Simulink&reg;.</p><pre class="codeinput">legacy_code(<span class="string">'compile'</span>, defs);
</pre><pre class="codeoutput">
### Start Compiling rtwdemo_sfun_st_inherited
    mex('rtwdemo_sfun_st_inherited.c', 'B:\matlab\toolbox\simulink\simdemos\simfeatures\sldemo_lct_src\gainScalar.c', '-IB:\matlab\toolbox\simulink\simdemos\simfeatures\sldemo_lct_src', '-IC:\Temp\R2010bd_251_3840\tp0131b8c4_8885_42d9_84ce_432a16cc3511')
### Finish Compiling rtwdemo_sfun_st_inherited
### Exit

### Start Compiling rtwdemo_sfun_st_fixed
    mex('rtwdemo_sfun_st_fixed.c', 'B:\matlab\toolbox\simulink\simdemos\simfeatures\sldemo_lct_src\gainScalar.c', '-IB:\matlab\toolbox\simulink\simdemos\simfeatures\sldemo_lct_src', '-IC:\Temp\R2010bd_251_3840\tp0131b8c4_8885_42d9_84ce_432a16cc3511')
### Finish Compiling rtwdemo_sfun_st_fixed
### Exit

### Start Compiling rtwdemo_sfun_st_parameterized
    mex('rtwdemo_sfun_st_parameterized.c', 'B:\matlab\toolbox\simulink\simdemos\simfeatures\sldemo_lct_src\gainScalar.c', '-IB:\matlab\toolbox\simulink\simdemos\simfeatures\sldemo_lct_src', '-IC:\Temp\R2010bd_251_3840\tp0131b8c4_8885_42d9_84ce_432a16cc3511')
### Finish Compiling rtwdemo_sfun_st_parameterized
### Exit
</pre><h2>Generating a TLC Block File for Code Generation<a name="4"></a></h2><p>After the S-function is compiled and used in simulation, the function legacy_code() can be called again with the first input set to 'sfcn_tlc_generate' in order to generate a TLC block file to support code generation through Real Time Workshop. Code generation will fail if the TLC block file is not created and you try to generate code for a model that includes the S-function. The TLC block file for the S-function is: <a href="matlab:rtwdemo_lct_util('edit','rtwdemo_sfun_st_inherited.tlc')">rtwdemo_sfun_st_inherited.tlc</a> and <a href="matlab:rtwdemo_lct_util('edit','rtwdemo_sfun_st_fixed.tlc')">rtwdemo_sfun_st_fixed.tlc</a>. <a href="matlab:rtwdemo_lct_util('edit','rtwdemo_sfun_st_parameterized.tlc')">rtwdemo_sfun_st_parameterized.tlc</a>.</p><pre class="codeinput">legacy_code(<span class="string">'sfcn_tlc_generate'</span>, defs);
</pre><h2>Generating an rtwmakecfg.m File for Code Generation<a name="5"></a></h2><p>After the TLC block file is created, the function legacy_code() can be called again with the first input set to 'rtwmakecfg_generate' in order to generate an rtwmakecfg.m file to support code generation through Real Time Workshop. The file is needed only if the required source and header files for the S-functions are not in the same directory as the S-functions, and you want to add these dependencies in the makefile produced during code generation.</p><pre class="codeinput">legacy_code(<span class="string">'rtwmakecfg_generate'</span>, defs);
</pre><h2>Generating a masked S-Function block for calling the generated S-Function<a name="6"></a></h2><p>After the C-MEX S-function source is compiled, the function legacy_code() can be called again with the first input set to 'slblock_generate' in order to generate a masked S-function block that is configured to call that S-function.  The block is placed in a new model and can be copied to an existing model.</p><pre class="codeinput"><span class="comment">% legacy_code('slblock_generate', defs);</span>
</pre><h2>Demoing the Generated Integration with Legacy Code<a name="7"></a></h2><p>The model <a href="matlab:rtwdemo_lct_sampletime">rtwdemo_lct_sampletime</a> shows integration with the legacy code. The subsystem sample_time serves as a harness for the calls to the legacy C functions, with unit delays serving to store the previous output values.</p><pre class="codeinput">open_system(<span class="string">'rtwdemo_lct_sampletime'</span>)
open_system(<span class="string">'rtwdemo_lct_sampletime/sample_time'</span>)
sim(<span class="string">'rtwdemo_lct_sampletime'</span>)
</pre><img vspace="5" hspace="5" src="rtwdemo_lct_sampletime_script_01.png" alt=""> <img vspace="5" hspace="5" src="rtwdemo_lct_sampletime_script_02.png" alt=""> <p class="footer">Copyright 1990-2008 The MathWorks, Inc.<br>
          Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!--
##### SOURCE BEGIN #####
%% Specification of Block Sample Time
% This demo shows you how to use the Legacy Code Tool to integrate legacy C 
% functions with the block's sample time specified, inherited and 
% parameterized.
%
% The Legacy Code Tool allows you to:
%
% * Provide the legacy function specification,
% * Generate a C-MEX S-function that is used during simulation to call the legacy code, and
% * Generate a block TLC file and optional rtwmakecfg.m file that is used during code generation to call the legacy code.
%

%   Copyright 1990-2008 The MathWorks, Inc.
%   $Revision: 1.1.8.4 $  $Date: 2008/12/01 07:30:56 $

%% Providing the Legacy Function Specification
% All functions provided with the Legacy Code Tool take a specific data 
% structure or array of structures as the argument. The data structure is 
% initialized by calling the function legacy_code() using 'initialize' as the
% first input. After initializing the structure, you have to assign its
% properties to values corresponding to the legacy code being integrated.  
% For detailed help on the properties, call 
% <matlab:legacy_code('help') legacy_code('help')>. The 
% prototypes of the legacy functions being called in this demo are:
%
% FLT gainScalar(const FLT in, const FLT gain)
%
% where FLT is a typedef to float.  The legacy source code is found in the
% files
% <matlab:sldemo_lct_util('edit','sldemo_lct_src/your_types.h') your_types.h>, 
% <matlab:sldemo_lct_util('edit','sldemo_lct_src/gain.h') gain.h>, and
% <matlab:sldemo_lct_util('edit','sldemo_lct_src/gainScalar.c') gainScalar.c>.

defs = [];

% rtwdemo_sfun_st_inherited
def = legacy_code('initialize');
def.SFunctionName = 'rtwdemo_sfun_st_inherited';
def.OutputFcnSpec = 'single y1 = gainScalar(single u1, single p1)';
def.HeaderFiles   = {'gain.h'};
def.SourceFiles   = {'gainScalar.c'};
def.IncPaths      = {'sldemo_lct_src'}; 
def.SrcPaths      = {'sldemo_lct_src'}; 
defs = [defs; def];

% rtwdemo_sfun_st_fixed
def = legacy_code('initialize');
def.SFunctionName = 'rtwdemo_sfun_st_fixed';
def.OutputFcnSpec = 'single y1 = gainScalar(single u1, single p1)';
def.HeaderFiles   = {'gain.h'};
def.SourceFiles   = {'gainScalar.c'};
def.IncPaths      = {'sldemo_lct_src'}; 
def.SrcPaths      = {'sldemo_lct_src'}; 
def.SampleTime    = [2 1];
defs = [defs; def];

% rtwdemo_sfun_st_parameterized
def = legacy_code('initialize');
def.SFunctionName = 'rtwdemo_sfun_st_parameterized';
def.OutputFcnSpec = 'single y1 = gainScalar(single u1, single p1)';
def.HeaderFiles   = {'gain.h'};
def.SourceFiles   = {'gainScalar.c'};
def.IncPaths      = {'sldemo_lct_src'}; 
def.SrcPaths      = {'sldemo_lct_src'}; 
def.SampleTime    = 'parameterized';
defs = [defs; def];

%% Generating S-Functions for Use During Simulation
% The function legacy_code() is called again with the first input set to 
% 'sfcn_cmex_generate' in order to automatically generate C-MEX S-functions
% according to the description provided by the input argument 'defs'.
% The S-functions are used to call the legacy functions in simulation.
% The source code for the S-functions is found in the files
% <matlab:rtwdemo_lct_util('edit','rtwdemo_sfun_st_inherited.c') rtwdemo_sfun_st_inherited.c> and
% <matlab:rtwdemo_lct_util('edit','rtwdemo_sfun_st_fixed.c') rtwdemo_sfun_st_fixed.c>.
% <matlab:rtwdemo_lct_util('edit','rtwdemo_sfun_st_parameterized.c') rtwdemo_sfun_st_parameterized.c>.

legacy_code('sfcn_cmex_generate', defs);

%% Compiling the Generated S-Function for Simulation
% After the C-MEX S-function source files are generated, the function 
% legacy_code() is called again with the first input set to 'compile' in order
% to compile the S-function for simulation with Simulink(R).

legacy_code('compile', defs);

%% Generating a TLC Block File for Code Generation
% After the S-function is compiled and used in simulation, the function
% legacy_code() can be called again with the first input set to 
% 'sfcn_tlc_generate' in order to generate a TLC block file to support
% code generation through Real Time Workshop. Code generation will fail 
% if the TLC block file is not created and you try to generate code for a model
% that includes the S-function. The TLC block file for the S-function is:
% <matlab:rtwdemo_lct_util('edit','rtwdemo_sfun_st_inherited.tlc') rtwdemo_sfun_st_inherited.tlc> and
% <matlab:rtwdemo_lct_util('edit','rtwdemo_sfun_st_fixed.tlc') rtwdemo_sfun_st_fixed.tlc>.
% <matlab:rtwdemo_lct_util('edit','rtwdemo_sfun_st_parameterized.tlc') rtwdemo_sfun_st_parameterized.tlc>.

legacy_code('sfcn_tlc_generate', defs);

%% Generating an rtwmakecfg.m File for Code Generation
% After the TLC block file is created, the function
% legacy_code() can be called again with the first input set to 
% 'rtwmakecfg_generate' in order to generate an rtwmakecfg.m file to support
% code generation through Real Time Workshop. The file is needed only if 
% the required source and header files for the S-functions are not in the 
% same directory as the S-functions, and you want to add these 
% dependencies in the makefile produced during code generation.

legacy_code('rtwmakecfg_generate', defs);

%% Generating a masked S-Function block for calling the generated S-Function
% After the C-MEX S-function source is compiled, the function 
% legacy_code() can be called again with the first input set to 'slblock_generate' in order
% to generate a masked S-function block that is configured to call that
% S-function.  The block is placed in a new model and can be copied to an
% existing model.

% legacy_code('slblock_generate', defs);

%% Demoing the Generated Integration with Legacy Code
% The model <matlab:rtwdemo_lct_sampletime rtwdemo_lct_sampletime> 
% shows integration with the legacy
% code. The subsystem sample_time serves as a harness for the calls to the
% legacy C functions, with unit delays serving to store the previous 
% output values.

open_system('rtwdemo_lct_sampletime')
open_system('rtwdemo_lct_sampletime/sample_time')
sim('rtwdemo_lct_sampletime')

displayEndOfDemoMessage(mfilename)

##### SOURCE END #####
--></body></html>