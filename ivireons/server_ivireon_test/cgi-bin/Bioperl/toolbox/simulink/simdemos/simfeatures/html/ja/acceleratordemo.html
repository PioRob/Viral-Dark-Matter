
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>モデルの高速化の紹介</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="acceleratordemo.m"><link rel="stylesheet" type="text/css" href="../../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit acceleratordemo">エディターで acceleratordemo.m を開く</a></div><div class="right"><a href="matlab:echodemo acceleratordemo">コマンド ウィンドウで実行</a></div></div><div class="content"><h1>モデルの高速化の紹介</h1><!--introduction--><p>Simulink&reg; Accelerator™ は、Simulink&reg; がノーマル モードのとき (つまりアクセラレータ モードでないとき) に使用する解釈コードの代わりとなる C コードを作成してコンパイルすることにより、モデルの実行速度を向上させます。Simulink Accelerator は、Simulink モデルから C コードを生成し、MATLAB&reg; 関数 mex を呼び出して、生成されたコードをコンパイルして Simulink に動的にリンクします。このコード生成およびコンパイル処理は、初めてモデルを高速化したときと、再生成する必要があるほど大幅にモデルが変更されたとき (たとえばブロックの追加など) に実行されます。</p><p>次の例は、slAccelDemoF14 モデルを使用して、Simulink Accelerator の使用法を説明しています。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">高速化されていない時間の計測</a></li><li><a href="#2">アクセラレータをオンにする</a></li><li><a href="#3">一時作業ディレクトリの作成</a></li><li><a href="#4">高速化されたモデルの作成</a></li><li><a href="#5">高速化されたモデルのシミュレーション</a></li><li><a href="#6">調整可能なパラメーターの変更および高速化されたモデルのシミュレーション</a></li><li><a href="#7">クリーン アップ</a></li></ul></div><h2>高速化されていない時間の計測<a name="1"></a></h2><p>slAccelDemoF14 モデルを開き、終了時間を 300 秒に設定します。TIC/TOC を使用して、モデルとその所要時間をシミュレートします。</p><pre class="codeinput">modelName = <span class="string">'slAccelDemoF14'</span>;
open_system(modelName)
set_param(modelName,<span class="string">'stoptime'</span>,<span class="string">'300'</span>)
tic
sim(modelName)
toc
</pre><pre class="codeoutput">Elapsed time is 2.124734 seconds.
</pre><img vspace="5" hspace="5" src="../acceleratordemo_01.png" alt=""> <img vspace="5" hspace="5" src="../acceleratordemo_02.png" alt=""> <h2>アクセラレータをオンにする<a name="2"></a></h2><p>Simulink Accelerator は、[Simulink シミュレーション] メニューから [アクセラレータ] を選択するか、MATLAB コマンド プロンプトで set_param コマンドを発行すると、アクティブ化できます。</p><pre class="codeinput">set_param(modelName,<span class="string">'SimulationMode'</span>,<span class="string">'Accelerator'</span>)
</pre><h2>一時作業ディレクトリの作成<a name="3"></a></h2><p>高速モードで実行するといくつかのファイルが作成されるため、まず、一時領域に移動します。</p><pre class="codeinput">originalDir = pwd;
tempDir = tempname;
mkdir(tempDir)
cd(tempDir)
</pre><h2>高速化されたモデルの作成<a name="4"></a></h2><p>高速化されたモデルを作成してシミュレートします。アクセラレータ モードで実行している場合は、[シミュレーション] メニューから [開始] を選択するか、MATLAB プロンプトで次のコマンドを実行すると、モデルを起動できます。</p><pre>    sim(modelName)</pre><p> どちらの場合も、MATLAB コマンド ウィンドウにコード生成処理の進行状況が表示されます。この表示を抑制するには、sim コマンドを evalc 内にラップします。</p><pre class="codeinput">evalc(<span class="string">'sim(modelName);'</span>);
</pre><img vspace="5" hspace="5" src="../acceleratordemo_03.png" alt=""> <h2>高速化されたモデルのシミュレーション<a name="5"></a></h2><p>モデルを再度シミュレートします。後続の実行では、モデルのシミュレーションがはるかに高速に実行されます。</p><pre class="codeinput">tic
sim(modelName)
toc
</pre><pre class="codeoutput">Elapsed time is 0.666697 seconds.
</pre><img vspace="5" hspace="5" src="../acceleratordemo_04.png" alt=""> <h2>調整可能なパラメーターの変更および高速化されたモデルのシミュレーション<a name="6"></a></h2><p>モデル内調整可能なパラメーターのいずれかの値を変更し、モデルを再度シミュレートします。高速バージョンのモデルは再生成する必要がないため、高速モードにしても、ノーマル モードのときよりもシミュレーションが高速に実行されます。</p><pre class="codeinput">modelWorkspace = get_param(modelName,<span class="string">'ModelWorkspace'</span>);
evalin(modelWorkspace,<span class="string">'Mw=Mw*2;'</span>)
tic
sim(modelName)
toc
</pre><pre class="codeoutput">Elapsed time is 0.668317 seconds.
</pre><img vspace="5" hspace="5" src="../acceleratordemo_05.png" alt=""> <h2>クリーン アップ<a name="7"></a></h2><p>モデルを閉じて、生成されたファイルを削除します。</p><pre class="codeinput">bdclose(modelName)
clear([modelName,<span class="string">'_acc'</span>])
cd(originalDir)
rmdir(tempDir,<span class="string">'s'</span>)
</pre><p class="footer">Copyright 1990-2008 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Introduction to Accelerating Models % Simulink(R) Accelerator(TM) speeds up the execution of your model, by  % creating and compiling C code that takes the place of the interpretive  % code that Simulink uses when in  Normal mode (that is, when Simulink(R)  % is not in Accelerator mode). Simulink Accelerator generates the C  % code from your Simulink model and invokes the MATLAB(R) mex function to compile  % and dynamically link the generated code to Simulink. This code  % generation and compilation process happens the first time you  % accelerate the model and any time the model changes are significant % enough to require re-generation (for example, the addition of a block). % % The following example, with the slAccelDemoF14 model, illustrates % the use of Simulink Accelerator.  % Copyright 1990-2008 The MathWorks, Inc. % $Revision: 1.1.4.9.2.1 $ $Date: 2010/07/29 21:29:14 $   %% Measuring the Non-accelerated Time % Open the slAccelDemoF14 model and set the stop time to 300 seconds.  % Simulate the model and time how long it takes using TIC/TOC.  modelName = 'slAccelDemoF14'; open_system(modelName) set_param(modelName,'stoptime','300') tic sim(modelName) toc   %% Turning on the Accelerator % Simulink Accelerator can be activated by selecting Accelerator from the  % Simulink Simulation menu or by issuing a set_param command at the  % MATLAB command prompt.  set_param(modelName,'SimulationMode','Accelerator')   %% Creating a Temporary Working Directory % Since running in accelerated mode % creates some files, first move to a temporary area.  originalDir = pwd; tempDir = tempname; mkdir(tempDir) cd(tempDir)   %% Building the Accelerated Model % Build the accelerated model and simulate it. % When running in Accelerator mode, you can start the model by selecting  % Start from the Simulation Menu or by running the command: % %      sim(modelName) % % at the MATLAB prompt. In either case, the progress of the code generation % process will be displayed in the MATLAB command window. To suppress this % display wrap the sim command inside an evalc.   evalc('sim(modelName);');   %% Simulating the Accelerated Model % Simulate the model again.  Notice the model simulation runs much faster % on subsequent runs.  tic sim(modelName) toc  %% Changing a Tunable Parameter and Simulating the Accelerated Model % Change the value of one of the tunable parameters in the model and % simulate the model again.  Notice the accelerated version of the  % model does not have to be re-generated and so the simulation still  % runs more quickly in Accelerated mode than in Normal mode.  modelWorkspace = get_param(modelName,'ModelWorkspace'); evalin(modelWorkspace,'Mw=Mw*2;') tic sim(modelName) toc  %% Cleaning Up % Close the model and remove the generated files.  bdclose(modelName) clear([modelName,'_acc']) cd(originalDir) rmdir(tempDir,'s')   displayEndOfDemoMessage(mfilename)  ##### SOURCE END ##### --></body></html>