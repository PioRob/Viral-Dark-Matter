
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>Simulink と Stateflow の制御と論理設計</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="rtwdemo_fuelsys_publish.m"><link rel="stylesheet" type="text/css" href="../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit rtwdemo_fuelsys_publish">エディターで rtwdemo_fuelsys_publish.m を開く</a></div><div class="right"><a href="matlab:echodemo rtwdemo_fuelsys_publish">コマンド ウィンドウで実行</a></div></div><div class="content"><h1>Simulink と Stateflow の制御と論理設計</h1><!--introduction--><p>このデモでは、Simulink&reg; と Stateflow&reg; を使用して設計された燃料比制御装置のコードを生成します。モデルの詳細は、<a href="matlab:showdemo('sldemo_fuelsys')">sldemo_fuelsys</a> を参照してください。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">モデルの関連部分の理解</a></li><li><a href="#6">Real-Time Workshop の使用によるモデルの設定とビルド</a></li><li><a href="#8">Real-Time Workshop Embedded Coder の使用によるモデルの設定とビルド</a></li><li><a href="#13">おわりに</a></li></ul></div><h2>モデルの関連部分の理解<a name="1"></a></h2><p>図 1 ～ 4 は、&quot;プラント&quot; と &quot;コントローラー&quot; を含む閉ループ システムである sldemo_fuelsys モデルの関連部分を示しています。プラントは、設計の初期段階でのシミュレーション時にコントローラーを検証するために使用します。この例では、関連するコントローラー サブシステム &quot;fuel_rate_control&quot; のコードを生成します。図 1 は、最上位のシミュレーション モデルを示しています。</p><pre class="codeinput"><span class="comment">% open sldemo_fuelsys via rtwdemo_fuelsys and compile the diagram to see</span>
<span class="comment">% see the signal data types.</span>
rtwdemo_fuelsys

sldemo_fuelsys([],[],[],<span class="string">'compile'</span>);
sldemo_fuelsys([],[],[],<span class="string">'term'</span>);
</pre><img vspace="5" hspace="5" src="../rtwdemo_fuelsys_publish_01.png" alt=""> <p><b>図 1:&quot;プラント&quot; と &quot;コントローラー&quot; の最上位モデル</b></p><p>燃料比制御装置は Simulink および Stateflow ブロックで構成されており、これからコードを生成するモデルの一部分です。</p><pre class="codeinput">open_system(<span class="string">'sldemo_fuelsys/fuel_rate_control'</span>);
</pre><img vspace="5" hspace="5" src="../rtwdemo_fuelsys_publish_02.png" alt=""> <p><b>図 2:燃料比コントローラー サブシステム</b></p><p>制御ロジックは、さまざまな動作モードを指定する Stateflow チャートです。</p><pre class="codeinput">open_system(<span class="string">'sldemo_fuelsys/fuel_rate_control/control_logic'</span>);
</pre><img vspace="5" hspace="5" src="../rtwdemo_fuelsys_publish_03.png" alt=""> <p><b>図 3:燃料比コントローラー ロジック</b></p><p>ここで、たくさん表示されているウィンドウを閉じましょう。</p><pre class="codeinput">close_system(<span class="string">'sldemo_fuelsys/fuel_rate_control/airflow_calc'</span>);
close_system(<span class="string">'sldemo_fuelsys/fuel_rate_control/fuel_calc'</span>);
close_system(<span class="string">'sldemo_fuelsys/fuel_rate_control/control_logic'</span>);
hDemo.rt=sfroot;hDemo.m=hDemo.rt.find(<span class="string">'-isa'</span>,<span class="string">'Simulink.BlockDiagram'</span>);
hDemo.c=hDemo.m.find(<span class="string">'-isa'</span>,<span class="string">'Stateflow.Chart'</span>,<span class="string">'-and'</span>,<span class="string">'Name'</span>,<span class="string">'control_logic'</span>);
hDemo.c.visible=false;
close_system(<span class="string">'sldemo_fuelsys/fuel_rate_control'</span>);
</pre><h2>Real-Time Workshop の使用によるモデルの設定とビルド<a name="6"></a></h2><p>Real-Time Workshop&reg; と Stateflow Coder™ により、Generic Real-Time (GRT) ターゲットを介して Simulink および Stateflow モデルの一般的な ANSI-C コードが生成されます。コード生成のためのモデルの設定は、プログラムで実行できます。</p><pre class="codeinput">rtwconfiguredemo(<span class="string">'sldemo_fuelsys'</span>,<span class="string">'GRT'</span>);
</pre><p>この例で、燃料比制御装置のみをビルドしましょう。コード生成処理が完了すると、生成コードの詳細を示す HTML 形式のレポートが自動的に表示されます。コードの本体部分は fuel_rate_control.c にあります。</p><pre class="codeinput">rtwbuild(<span class="string">'sldemo_fuelsys/fuel_rate_control'</span>);
</pre><pre class="codeoutput">### Starting Real-Time Workshop build procedure for model:fuel_rate_control
### Successful completion of Real-Time Workshop build procedure for model:fuel_rate_control
</pre><h2>Real-Time Workshop Embedded Coder の使用によるモデルの設定とビルド<a name="8"></a></h2><p>Real-Time Workshop Embedded Coder を使用して、Embedded Real-Time (ERT) ターゲットを介して量産 ANSI-C/C++ コードが生成されます。コード生成のためのモデルの設定は、プログラムで実行できます。</p><pre class="codeinput">rtwconfiguredemo(<span class="string">'sldemo_fuelsys'</span>,<span class="string">'ERT'</span>);
</pre><p>ビルド プロセスを繰り返し、生成されたコードを調べます。図 4 は、生成された制御ロジックの一部を示しています。関連するコード セグメントに Real-Time Workshop Report で対話形式で移動できます。(Stateflow ブロックを右クリックして) チャートのコンテキスト メニューから <b>[Real-Time Workshop] &gt; [コードに移動...]</b> と選択し、<b>[戻る]</b> または <b>[次へ]</b> ボタンをクリックします。または、rtwtrace ユーティリティを使用してプログラムで移動します。</p><pre class="codeinput">rtwbuild(<span class="string">'sldemo_fuelsys/fuel_rate_control'</span>);
rtwtrace(<span class="string">'sldemo_fuelsys/fuel_rate_control/control_logic'</span>)
</pre><pre class="codeoutput">### Starting Real-Time Workshop build procedure for model:fuel_rate_control
### Successful completion of Real-Time Workshop build procedure for model:fuel_rate_control
</pre><p><img vspace="5" hspace="5" src="../rtwdemo_fuelsys_control_logic.jpg" alt=""> </p><p><b>図 4:燃料比コントローラー ロジックの生成コードの一部</b></p><p>デモを閉じます。</p><pre class="codeinput">clear <span class="string">hDemo</span>
close_system(<span class="string">'sldemo_fuelsys'</span>,0);
</pre><h2>おわりに<a name="13"></a></h2><p>sldemo_fuelsys を使用する関連の固定小数点デモについては、表 1 を参照してください。</p><p>
<TABLE>
<table border=2 CELLPADDING=10>
<TR>
<TD>固定小数点設計</TD>
<TD>
<a href="matlab:sldemo_fuelsys_data('fxpdemo_fuelsys','showdemo','fxpdemo_fuelsys_publish','Simulink&nbsp;Fixed&nbsp;Point')">fxpdemo_fuelsys</a>
</TD>
</TR>
<TR>
<TD>固定小数点の本番用 C/C++ コード生成</TD>
<TD>
<a href="matlab:sldemo_fuelsys_data('fxpdemo_fuelsys','showdemo','rtwdemo_fuelsys_fxp_publish','Real-Time&nbsp;Workshop')">rtwdemo_fuelsys_fxp</a>
</TD>
</TR>
</TABLE>
</p><p><b>表 1:</b>  sldemo_fuelsys を使用した関連製品のデモ</p><p class="footer">Copyright 1994-2009 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Control and Logic Design with Simulink and Stateflow % In this demonstration you will generate code for a fuel rate % control system designed using Simulink(R) and Stateflow(R).  See % <matlab:showdemo('sldemo_fuelsys') sldemo_fuelsys> for a detailed % explanation of the model.  % Copyright 1994-2009 The MathWorks, Inc. % $Revision: 1.1.4.10.2.1 $  $Date: 2010/07/29 21:28:58 $  %% Familiarize Yourself with the Relevant Portions of the Model % Figures 1-3 show relevant portions of the sldemo_fuelsys model, which is % a closed-loop system containing a "plant" and "controller".  The plant is % used to validate the controller in simulation early in the design cycle. % In this example, we'll generate code for the relevant controller % subsystem, "fuel_rate_control".  Figure 1 shows the top-level simulation % model.  % open sldemo_fuelsys via rtwdemo_fuelsys and compile the diagram to see % see the signal data types. rtwdemo_fuelsys  sldemo_fuelsys([],[],[],'compile'); sldemo_fuelsys([],[],[],'term');  %% % *Figure 1: Top-level model of the "plant" and "controller"* % % The fuel rate control system is comprised of Simulink and Stateflow blocks, % and is the portion of the model for which we'll generated code.  open_system('sldemo_fuelsys/fuel_rate_control');  %% % *Figure 2: The fuel rate controller subsystem* % % The control logic is a Stateflow chart that specifies the different % modes of operation.  open_system('sldemo_fuelsys/fuel_rate_control/control_logic');  %% % *Figure 3: Fuel rate controller logic* %  %% % Now let's remove the window clutter. close_system('sldemo_fuelsys/fuel_rate_control/airflow_calc'); close_system('sldemo_fuelsys/fuel_rate_control/fuel_calc'); close_system('sldemo_fuelsys/fuel_rate_control/control_logic'); hDemo.rt=sfroot;hDemo.m=hDemo.rt.find('-isa','Simulink.BlockDiagram'); hDemo.c=hDemo.m.find('-isa','Stateflow.Chart','-and','Name','control_logic'); hDemo.c.visible=false; close_system('sldemo_fuelsys/fuel_rate_control');  %% Configure and Build the Model Using Real-Time Workshop % Real-Time Workshop(R) and Stateflow Coder(TM) generate generic ANSI-C % code for Simulink and Stateflow models via the Generic Real-Time (GRT) % target. Configuring a model for code generation can be done % programmatically.  rtwconfiguredemo('sldemo_fuelsys','GRT');  %% % For this example, let's build the fuel rate control system only.  Once % the code generation process is complete, an HTML report detailing the generated % code is displayed automatically.  The main body of the code is located % in fuel_rate_control.c.  rtwbuild('sldemo_fuelsys/fuel_rate_control');  %% Configure and Build the Model Using Real-Time Workshop Embedded Coder % Real-Time Workshop Embedded Coder is used to generate production % ANSI-C/C++ code via the Embedded Real-Time (ERT) target. Configuring a % model for code generation can be done programmatically.   rtwconfiguredemo('sldemo_fuelsys','ERT');  %% % Repeat the build process and inspect the generated code.  Figure 4 shows % a portion of the generated control logic.  You can navigate to the % relevant code segments interactively in the Real-Time Workshop Report % using the *Previous* and *Next* buttons by selecting *Real-Time % Workshop > Navigate to Code ...* from the charts context menu (i.e., % right-click on the Stateflow block), or programmatically using the % rtwtrace utility.  rtwbuild('sldemo_fuelsys/fuel_rate_control'); rtwtrace('sldemo_fuelsys/fuel_rate_control/control_logic')  %% % % <<rtwdemo_fuelsys_control_logic.jpg>>  %% % *Figure 4: Portion of the generated code for the fuel rate controller logic*  %% % Close the demo. clear hDemo close_system('sldemo_fuelsys',0);  %% Closing Remarks % Refer to Table 1 for related fixed-point demos using sldemo_fuelsys. % % <html> % <TABLE> % <table border=2 CELLPADDING=10> % <TR> % <TD>Fixed-point design</TD> % <TD> % <a % href="matlab:sldemo_fuelsys_data('fxpdemo_fuelsys','showdemo','fxpdemo_fuelsys_publish','Simulink&nbsp;Fixed&nbsp;Point')"> % fxpdemo_fuelsys</a> % </TD> % </TR> % <TR> % <TD>Fixed-point production C/C++ code generation</TD> % <TD> % <a % href="matlab:sldemo_fuelsys_data('fxpdemo_fuelsys','showdemo','rtwdemo_fuelsys_fxp_publish','Real-Time&nbsp;Workshop')"> % rtwdemo_fuelsys_fxp</a> % </TD> % </TR> % </TABLE> % </html> %  % *Table 1:*  Related product demos using sldemo_fuelsys   displayEndOfDemoMessage(mfilename) ##### SOURCE END ##### --></body></html>