
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>IEEE 802.11n Channel Models</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-06-29"><meta name="DC.source" content="chandemo_802_11n.m"><link rel="stylesheet" type="text/css" href="../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit chandemo_802_11n">Open chandemo_802_11n.m in the Editor</a></div><div class="right"><a href="matlab:echodemo chandemo_802_11n">Run in the Command Window</a></div></div><div class="content"><h1>IEEE 802.11n Channel Models</h1><!--introduction--><p>This demo shows how to simulate multiple-input multiple-output (MIMO) multipath fading channels based on the IEEE&reg; 802.11n channel models for indoor wireless local area networks (WLAN). Two transmit antennas and two receive antennas are used. The demo uses the MIMO multipath fading channel and the bell Doppler spectrum objects.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">IEEE 802.11n Channel Models: Overview</a></li><li><a href="#2">Initialization of Simulation-Specific Parameters</a></li><li><a href="#3">Channel Model B</a></li><li><a href="#10">Selected Bibliography</a></li></ul></div><h2>IEEE 802.11n Channel Models: Overview<a name="1"></a></h2><p>The IEEE 802.11n channel models [ <a href="#10">1</a> ] are designed for indoor wireless local area networks for bandwidths of up to 100 MHz, at frequencies of 2 and 5 GHz. The channel models comprise a set of 6 profiles, labeled A to F, which cover the scenarios of flat fading, residential, residential/small office, typical office, large office, and large space (indoors and outdoors). Each channel model has a path loss model including shadowing, and a MIMO multipath fading model, which describes the multipath delay profile, the spatial properties, the K-factor distribution, and the Doppler spectrum.</p><p>Each channel model has a certain number of taps (one for model A, and 9 to 18 for models B-F). Each tap is characterized by a relative delay (with respect to the first path delay). Each model further comprises a number of clusters, which correspond to overlapping subsets of the tap delays. For example, model B has two clusters: cluster 1 corresponds to tap delays 0 to 40 ns (in steps of 10 ns), while cluster 2 corresponds to tap delays 20 to 80 ns (also in steps of 10 ns). Hence, clusters 1 and 2 comprise 5 and 7 tap delays, respectively, and they overlap in 3 tap delays (20, 30 and 40 ns). Each cluster is assigned a set of spatial properties: a mean angle of arrival (AoA), a mean angle of departure (AoD), an angular spread (AS) at the receiver, and an angular spread at the transmitter. These parameters assume the same values for all tap delays pertaining to a given cluster. These parameters determine the transmit and correlation matrices associated with each tap delay.</p><p>The IEEE 802.11n channel models make the following assumptions: 1) The power azimuth spectrum (PAS) and the power delay spectrum (PDS) are separable: each tap is modeled independently. 2) The PAS and the Doppler spectrum for each tap are separable: the spatial correlation (correlation matrices) and temporal correlation (Doppler spectrum) for each tap are modeled independently. 3) Each tap is modeled using the Kronecker model for Rician channels, hence it is assumed that the transmit and receive correlation matrices are separable for each tap.</p><h2>Initialization of Simulation-Specific Parameters<a name="2"></a></h2><p>The simulation sampling rate is specified, and kept the same for the remainder of the demo.  The input to the channel simulator is oversampled by a factor of four.</p><pre class="codeinput">S = RandStream(<span class="string">'swb2712'</span>, <span class="string">'Seed'</span>, 12345); <span class="comment">% Set a local random number stream</span>
M = 2;                      <span class="comment">% Modulation order</span>
hModem = modem.pskmod(M);   <span class="comment">% 2-PSK modulator object</span>

Rsym = 10e3;                <span class="comment">% Input symbol rate</span>
Rbit = Rsym * log2(M);      <span class="comment">% Input bit rate</span>
Nos = 4;                    <span class="comment">% Oversampling factor</span>
ts = (1/Rbit) / Nos;        <span class="comment">% Input sample period</span>
</pre><h2>Channel Model B<a name="3"></a></h2><p>The code below constructs a MIMO channel object according to channel model B of [ <a href="#10">1</a> ], in non-line-of-sight (NLOS) mode.</p><p>This channel model has 9 Rayleigh-fading paths, and each path has a bell Doppler spectrum, with a parameter as specified in the default doppler.bell object.</p><p>We use two transmit antennas and two receive antennas. For each path, the transmit and receive correlation matrices are calculated according to the procedure given in [ <a href="#10">1</a> ], [ <a href="#10">2</a> ].</p><pre class="codeinput">Nt = 2;                     <span class="comment">% Number of transmit antennas</span>
Nr = 2;                     <span class="comment">% Number of receive antennas</span>

fd = 3;                     <span class="comment">% Maximum Doppler shift for all paths (identical)</span>

dop = doppler.bell;         <span class="comment">% Bell doppler spectrum, with default parameters</span>

tau = [0 10 20 30 40 50 60 70 80] * 1e-9;   <span class="comment">% Path delays, in seconds</span>
Np = length(tau);                           <span class="comment">% Number of paths</span>

<span class="comment">% Average path gains of cluster 1, in dB</span>
pdb1 = [0 -5.4 -10.8 -16.2 -21.7 -inf -inf -inf -inf];
<span class="comment">% Average path gains of cluster 2, in dB</span>
pdb2 = [-inf -inf -3.2 -6.3 -9.4 -12.5 -15.6 -18.7 -21.8];
<span class="comment">% Total average path gains for both clusters, in dB</span>
pdb = 10*log10(10.^(pdb1/10)+10.^(pdb2/10));

<span class="comment">% Element spacing at the transmit and receive antennas (normalized by the</span>
<span class="comment">% wavelength)</span>
TxSpacing = 0.5;
RxSpacing = 0.5;

<span class="comment">% Spatial parameters on transmitter side:</span>
<span class="comment">%   Angular spreads - Cluster 1</span>
AS_Tx_C1 = [14.4 14.4 14.4 14.4 14.4 -inf -inf -inf -inf];
<span class="comment">%   Angular spreads - Cluster 2</span>
AS_Tx_C2 = [-inf -inf 25.4 25.4 25.4 25.4 25.4 25.4 25.4];
<span class="comment">%   Mean angles of departure - Cluster 1</span>
AoD_C1 = [225.1 225.1 225.1 225.1 225.1 -inf -inf -inf -inf];
<span class="comment">%   Mean angles of departure - Cluster 2</span>
AoD_C2 = [-inf -inf 106.5 106.5 106.5 106.5 106.5 106.5 106.5];

<span class="comment">% Spatial parameters on receiver side:</span>
<span class="comment">%   Angular spreads - Cluster 1</span>
AS_Rx_C1 = [14.4 14.4 14.4 14.4 14.4 -inf -inf -inf -inf];
<span class="comment">%   Angular spreads - Cluster 2</span>
AS_Rx_C2 = [-inf -inf 25.2 25.2 25.2 25.2 25.2 25.2 25.2];
<span class="comment">%   Mean angles of arrival - Cluster 1</span>
AoA_C1 = [4.3 4.3 4.3 4.3 4.3 -inf -inf -inf -inf];
<span class="comment">%   Mean angles of arrival - Cluster 2</span>
AoA_C2 = [-inf -inf 118.4 118.4 118.4 118.4 118.4 118.4 118.4];

<span class="comment">% Calculation of transmit and receive correlation arrays</span>
[TxCorrelationMatrix, RxCorrelationMatrix] = <span class="keyword">...</span>
    calculateCorrMatrix(Nt, Nr, pdb1, pdb2, TxSpacing, RxSpacing, <span class="keyword">...</span>
    AS_Tx_C1, AS_Tx_C2, AoD_C1, AoD_C2, <span class="keyword">...</span>
    AS_Rx_C1, AS_Rx_C2, AoA_C1, AoA_C2);

h = mimochan(Nt, Nr, ts, fd, tau, pdb);      <span class="comment">% MIMO channel object</span>
h.KFactor = 0;                               <span class="comment">% Rician K-factor on first path</span>
h.DopplerSpectrum = dop;                     <span class="comment">% Doppler spectrum of MIMO object</span>
h.TxCorrelationMatrix = TxCorrelationMatrix; <span class="comment">% Transmit correlation array</span>
h.RxCorrelationMatrix = RxCorrelationMatrix; <span class="comment">% Transmit correlation array</span>
</pre><p>The code below simulates the effect of the MIMO channel on a random input sequence.</p><pre class="codeinput"><span class="comment">% After each frame is processed, the channel is not reset: this is</span>
<span class="comment">% necessary to preserve continuity across frames.</span>
h.ResetBeforeFiltering = 0;
<span class="comment">% This setting is needed to store the path gains.</span>
h.StorePathGains = 1;

Nsamp = 1e6/2;                  <span class="comment">% Total number of channel samples</span>
Nsamp_f = 1000;                 <span class="comment">% Number of samples per frame</span>
Nframes = Nsamp/Nsamp_f;        <span class="comment">% Number of frames</span>

out = zeros(Nsamp, Nr);
link11 = zeros(Nsamp, Np);  link12 = zeros(Nsamp, Np);
link21 = zeros(Nsamp, Np);  link22 = zeros(Nsamp, Np);
<span class="keyword">for</span> iFrames = 1:Nframes
    inputSig = modulate(hModem, randi(S, [0 M-1], Nsamp_f, Nt));
    idx = (1:Nsamp_f)+(iFrames-1)*Nsamp_f;
    out(idx,:) = filter(h, inputSig);
    <span class="keyword">for</span> ip = 1:Np
        <span class="comment">% For each transmit-receive link, store gains of all paths</span>
        link11(idx,ip) = h.PathGains(:,ip,1,1);
        link12(idx,ip) = h.PathGains(:,ip,1,2);
        link21(idx,ip) = h.PathGains(:,ip,2,1);
        link22(idx,ip) = h.PathGains(:,ip,2,2);
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><p>The Doppler spectrum of the Tx1-Rx1 link of the first path is estimated from the complex path gains and plotted.</p><pre class="codeinput">Hs = spectrum.welch(<span class="string">'Hamming'</span>, Nsamp/5, 50);
figure;
psd(Hs, link11(:,1), <span class="string">'Fs'</span>, 1/ts, <span class="string">'SpectrumType'</span>, <span class="string">'twosided'</span>, <span class="string">'Centerdc'</span>, true)
axis([-0.01 0.01 -80 10]);
legend(<span class="string">'Simulation'</span>);
</pre><img vspace="5" hspace="5" src="chandemo_802_11n_01.png" alt=""> <p>The theoretical bell Doppler spectrum is overlaid to the estimated Doppler spectrum.  We observe a good fit between both.</p><pre class="codeinput">f = -fd: 0.01 :fd;
a = 9;    <span class="comment">% Parameters of the bell Doppler spectrum</span>
Sd = sqrt(a)/(pi*fd) * 1./(1 + a*(f/fd).^2 );
Sd = Sd * 1/2;  <span class="comment">% Each receive antenna is assigned half the power</span>

hold <span class="string">on</span>;
plot(f(Sd&gt;0)/1e3, 10*log10(Sd(Sd&gt;0)), <span class="string">'k--'</span>);
legend(<span class="string">'Simulation'</span>, <span class="string">'Theory'</span>);
</pre><img vspace="5" hspace="5" src="chandemo_802_11n_02.png" alt=""> <p>The Doppler spectrum for Tx1-Rx2 link of the first path is also estimated and compared to the theoretical spectrum. We also observe a good fit between both.</p><pre class="codeinput">figure;
psd(Hs, link12(:,1), <span class="string">'Fs'</span>, 1/ts, <span class="string">'SpectrumType'</span>, <span class="string">'twosided'</span>, <span class="string">'Centerdc'</span>, true)
axis([-0.01 0.01 -80 10]);
legend(<span class="string">'Simulation'</span>);
hold <span class="string">on</span>;
plot(f(Sd&gt;0)/1e3, 10*log10(Sd(Sd&gt;0)), <span class="string">'k--'</span>);
legend(<span class="string">'Simulation'</span>, <span class="string">'Theory'</span>);
</pre><img vspace="5" hspace="5" src="chandemo_802_11n_03.png" alt=""> <p>For Path 1, we plot the fading envelope waveforms for each transmit-receive link. We can observe a correlation between the fading envelopes</p><pre class="codeinput">figure;
semilogy(abs(link11(:,1)),<span class="string">'b'</span>);
hold <span class="string">on</span>; grid <span class="string">on</span>;
semilogy(abs(link21(:,1)),<span class="string">'r'</span>);
legend(<span class="string">'Link Tx1-Rx1'</span>, <span class="string">'Link Tx2-Rx1'</span>);
title(<span class="string">'Fading envelopes for the links Tx1-Rx1 and Tx2-Rx1, for Path 1'</span>);

figure;
semilogy(abs(link12(:,1)),<span class="string">'b'</span>);
hold <span class="string">on</span>; grid <span class="string">on</span>;
semilogy(abs(link22(:,1)),<span class="string">'r'</span>);
legend(<span class="string">'Link Tx1-Rx2'</span>, <span class="string">'Link Tx2-Rx2'</span>);
title(<span class="string">'Fading envelopes for the links Tx1-Rx2 and Tx2-Rx2, for Path 1'</span>);

figure;
semilogy(abs(link11(:,1)),<span class="string">'b'</span>);
hold <span class="string">on</span>; grid <span class="string">on</span>;
semilogy(abs(link12(:,1)),<span class="string">'r'</span>);
legend(<span class="string">'Link Tx1-Rx1'</span>, <span class="string">'Link Tx1-Rx2'</span>);
title(<span class="string">'Fading envelopes for the links Tx1-Rx1 and Tx1-Rx2, for Path 1'</span>);

figure;
semilogy(abs(link21(:,1)),<span class="string">'b'</span>);
hold <span class="string">on</span>; grid <span class="string">on</span>;
semilogy(abs(link22(:,1)),<span class="string">'r'</span>);
legend(<span class="string">'Link Tx2-Rx1'</span>, <span class="string">'Link Tx2-Rx2'</span>);
title(<span class="string">'Fading envelopes for the links Tx2-Rx1 and Tx2-Rx2, for Path 1'</span>);
</pre><img vspace="5" hspace="5" src="chandemo_802_11n_04.png" alt=""> <img vspace="5" hspace="5" src="chandemo_802_11n_05.png" alt=""> <img vspace="5" hspace="5" src="chandemo_802_11n_06.png" alt=""> <img vspace="5" hspace="5" src="chandemo_802_11n_07.png" alt=""> <p>We compute the transmit and receive correlation matrices for the first path. They show a good match with the theoretical values (compare with TxCorrelationMatrix(:,:,1) and RxCorrelationMatrix(:,:,1) calculated earlier).</p><pre class="codeinput">TxCorrMatrixPath1a = corrcoef(link11(:,1),link21(:,1)).'   <span class="comment">% Rx antenna 1</span>
TxCorrMatrixPath1b = corrcoef(link12(:,1),link22(:,1)).'   <span class="comment">% Rx antenna 2</span>
RxCorrMatrixPath1a = corrcoef(link11(:,1),link12(:,1)).'   <span class="comment">% Tx antenna 1</span>
RxCorrMatrixPath1b = corrcoef(link21(:,1),link22(:,1)).'   <span class="comment">% Tx antenna 2</span>
</pre><pre class="codeoutput">
TxCorrMatrixPath1a =

   1.0000            -0.4840 - 0.7190i
  -0.4840 + 0.7190i   1.0000          


TxCorrMatrixPath1b =

   1.0000            -0.5103 - 0.7236i
  -0.5103 + 0.7236i   1.0000          


RxCorrMatrixPath1a =

   1.0000             0.7868 + 0.1394i
   0.7868 - 0.1394i   1.0000          


RxCorrMatrixPath1b =

   1.0000             0.7472 + 0.1078i
   0.7472 - 0.1078i   1.0000          

</pre><h2>Selected Bibliography<a name="10"></a></h2><div><ol><li>IEEE P802.11 Wireless LANs, "TGn Channel Models", IEEE 802.11-03/940r4, 2004-05-10.</li><li>L. Schumacher, K. I. Pedersen, and P. E. Mogensen, "From antenna spacings to theoretical capacities - Guidelines for simulating MIMO systems", Proc. PIMRC Conf., vol. 2, Sep. 2002, pp. 587-592.</li></ol></div><p class="footer">Copyright 2008-2009 The MathWorks, Inc.<br>
          Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!--
##### SOURCE BEGIN #####
%% IEEE 802.11n Channel Models
% This demo shows how to simulate multiple-input multiple-output (MIMO)
% multipath fading channels based on the IEEE(R) 802.11n channel models for 
% indoor wireless local area networks (WLAN). Two transmit antennas and two
% receive antennas are used. The demo uses the MIMO multipath fading
% channel and the bell Doppler spectrum objects.

% Copyright 2008-2009 The MathWorks, Inc.
% $Revision: 1.1.6.3 $ $Date: 2009/05/23 07:50:06 $

%% IEEE 802.11n Channel Models: Overview
% The IEEE 802.11n channel models [ <#10 1> ] are designed for indoor wireless 
% local area networks for bandwidths of up to 100 MHz, at frequencies of 2
% and 5 GHz. The channel models comprise a set of 6 profiles, labeled A to 
% F, which cover the scenarios of flat fading, residential, residential/small
% office, typical office, large office, and large space (indoors and
% outdoors). Each channel model has a path loss model including shadowing,
% and a MIMO multipath fading model, which describes the multipath delay
% profile, the spatial properties, the K-factor distribution, and the
% Doppler spectrum.
%
% Each channel model has a certain number of taps (one for model A, and 9
% to 18 for models B-F). Each tap is characterized by a relative delay
% (with respect to the first path delay). Each model further comprises a
% number of clusters, which correspond to overlapping subsets of the tap
% delays. For example, model B has two clusters: cluster 1 corresponds to
% tap delays 0 to 40 ns (in steps of 10 ns), while cluster 2 corresponds to
% tap delays 20 to 80 ns (also in steps of 10 ns). Hence, clusters 1 and 2
% comprise 5 and 7 tap delays, respectively, and they overlap in 3 tap
% delays (20, 30 and 40 ns). Each cluster is assigned a set of spatial
% properties: a mean angle of arrival (AoA), a mean angle of departure
% (AoD), an angular spread (AS) at the receiver, and an angular spread at
% the transmitter. These parameters assume the same values for all tap
% delays pertaining to a given cluster. These parameters determine the
% transmit and correlation matrices associated with each tap delay.
%
% The IEEE 802.11n channel models make the following assumptions: 1) The 
% power azimuth spectrum (PAS) and the power delay spectrum (PDS) are 
% separable: each tap is modeled independently. 2) The PAS and the Doppler
% spectrum for each tap are separable: the spatial correlation (correlation
% matrices) and temporal correlation (Doppler spectrum) for each tap are
% modeled independently. 3) Each tap is modeled using the Kronecker model
% for Rician channels, hence it is assumed that the transmit and receive
% correlation matrices are separable for each tap.

%% Initialization of Simulation-Specific Parameters 
% The simulation sampling rate is specified, and kept the same for the
% remainder of the demo.  The input to the channel simulator is oversampled
% by a factor of four.

S = RandStream('swb2712', 'Seed', 12345); % Set a local random number stream
M = 2;                      % Modulation order
hModem = modem.pskmod(M);   % 2-PSK modulator object

Rsym = 10e3;                % Input symbol rate
Rbit = Rsym * log2(M);      % Input bit rate
Nos = 4;                    % Oversampling factor
ts = (1/Rbit) / Nos;        % Input sample period

%% Channel Model B
% The code below constructs a MIMO channel object according to channel
% model B of [ <#10 1> ], in non-line-of-sight (NLOS) mode.
%
% This channel model has 9 Rayleigh-fading paths, and each path has a bell
% Doppler spectrum, with a parameter as specified in the default
% doppler.bell object. 
%
% We use two transmit antennas and two receive antennas. For each path, the
% transmit and receive correlation matrices are calculated according to the
% procedure given in [ <#10 1> ], [ <#10 2> ]. 

Nt = 2;                     % Number of transmit antennas
Nr = 2;                     % Number of receive antennas

fd = 3;                     % Maximum Doppler shift for all paths (identical)

dop = doppler.bell;         % Bell doppler spectrum, with default parameters

tau = [0 10 20 30 40 50 60 70 80] * 1e-9;   % Path delays, in seconds
Np = length(tau);                           % Number of paths

% Average path gains of cluster 1, in dB
pdb1 = [0 -5.4 -10.8 -16.2 -21.7 -inf -inf -inf -inf];      
% Average path gains of cluster 2, in dB
pdb2 = [-inf -inf -3.2 -6.3 -9.4 -12.5 -15.6 -18.7 -21.8];
% Total average path gains for both clusters, in dB
pdb = 10*log10(10.^(pdb1/10)+10.^(pdb2/10));

% Element spacing at the transmit and receive antennas (normalized by the
% wavelength)
TxSpacing = 0.5;
RxSpacing = 0.5;

% Spatial parameters on transmitter side:
%   Angular spreads - Cluster 1
AS_Tx_C1 = [14.4 14.4 14.4 14.4 14.4 -inf -inf -inf -inf];        
%   Angular spreads - Cluster 2
AS_Tx_C2 = [-inf -inf 25.4 25.4 25.4 25.4 25.4 25.4 25.4];        
%   Mean angles of departure - Cluster 1
AoD_C1 = [225.1 225.1 225.1 225.1 225.1 -inf -inf -inf -inf];     
%   Mean angles of departure - Cluster 2
AoD_C2 = [-inf -inf 106.5 106.5 106.5 106.5 106.5 106.5 106.5];   

% Spatial parameters on receiver side:
%   Angular spreads - Cluster 1
AS_Rx_C1 = [14.4 14.4 14.4 14.4 14.4 -inf -inf -inf -inf];        
%   Angular spreads - Cluster 2
AS_Rx_C2 = [-inf -inf 25.2 25.2 25.2 25.2 25.2 25.2 25.2];        
%   Mean angles of arrival - Cluster 1
AoA_C1 = [4.3 4.3 4.3 4.3 4.3 -inf -inf -inf -inf];               
%   Mean angles of arrival - Cluster 2
AoA_C2 = [-inf -inf 118.4 118.4 118.4 118.4 118.4 118.4 118.4];   

% Calculation of transmit and receive correlation arrays
[TxCorrelationMatrix, RxCorrelationMatrix] = ...
    calculateCorrMatrix(Nt, Nr, pdb1, pdb2, TxSpacing, RxSpacing, ...
    AS_Tx_C1, AS_Tx_C2, AoD_C1, AoD_C2, ...
    AS_Rx_C1, AS_Rx_C2, AoA_C1, AoA_C2);

h = mimochan(Nt, Nr, ts, fd, tau, pdb);      % MIMO channel object
h.KFactor = 0;                               % Rician K-factor on first path
h.DopplerSpectrum = dop;                     % Doppler spectrum of MIMO object
h.TxCorrelationMatrix = TxCorrelationMatrix; % Transmit correlation array
h.RxCorrelationMatrix = RxCorrelationMatrix; % Transmit correlation array

%%
% The code below simulates the effect of the MIMO channel on a random 
% input sequence.

% After each frame is processed, the channel is not reset: this is 
% necessary to preserve continuity across frames.
h.ResetBeforeFiltering = 0;
% This setting is needed to store the path gains.
h.StorePathGains = 1;

Nsamp = 1e6/2;                  % Total number of channel samples
Nsamp_f = 1000;                 % Number of samples per frame
Nframes = Nsamp/Nsamp_f;        % Number of frames

out = zeros(Nsamp, Nr);  
link11 = zeros(Nsamp, Np);  link12 = zeros(Nsamp, Np);
link21 = zeros(Nsamp, Np);  link22 = zeros(Nsamp, Np);
for iFrames = 1:Nframes
    inputSig = modulate(hModem, randi(S, [0 M-1], Nsamp_f, Nt));
    idx = (1:Nsamp_f)+(iFrames-1)*Nsamp_f;
    out(idx,:) = filter(h, inputSig);
    for ip = 1:Np
        % For each transmit-receive link, store gains of all paths
        link11(idx,ip) = h.PathGains(:,ip,1,1);
        link12(idx,ip) = h.PathGains(:,ip,1,2);
        link21(idx,ip) = h.PathGains(:,ip,2,1);
        link22(idx,ip) = h.PathGains(:,ip,2,2);        
    end    
end

%%
% The Doppler spectrum of the Tx1-Rx1 link of the first path is estimated
% from the complex path gains and plotted.

Hs = spectrum.welch('Hamming', Nsamp/5, 50);
figure;
psd(Hs, link11(:,1), 'Fs', 1/ts, 'SpectrumType', 'twosided', 'Centerdc', true)
axis([-0.01 0.01 -80 10]);
legend('Simulation');

%%
% The theoretical bell Doppler spectrum is overlaid to the estimated
% Doppler spectrum.  We observe a good fit between both.

f = -fd: 0.01 :fd;      
a = 9;    % Parameters of the bell Doppler spectrum
Sd = sqrt(a)/(pi*fd) * 1./(1 + a*(f/fd).^2 );
Sd = Sd * 1/2;  % Each receive antenna is assigned half the power

hold on;
plot(f(Sd>0)/1e3, 10*log10(Sd(Sd>0)), 'kREPLACE_WITH_DASH_DASH');
legend('Simulation', 'Theory');

%%
% The Doppler spectrum for Tx1-Rx2 link of the first path is also estimated
% and compared to the theoretical spectrum. We also observe a good fit
% between both.

figure;
psd(Hs, link12(:,1), 'Fs', 1/ts, 'SpectrumType', 'twosided', 'Centerdc', true)
axis([-0.01 0.01 -80 10]);
legend('Simulation');
hold on;
plot(f(Sd>0)/1e3, 10*log10(Sd(Sd>0)), 'kREPLACE_WITH_DASH_DASH');
legend('Simulation', 'Theory');

%%
% For Path 1, we plot the fading envelope waveforms for each
% transmit-receive link. We can observe a correlation between the fading
% envelopes

figure;
semilogy(abs(link11(:,1)),'b');
hold on; grid on;
semilogy(abs(link21(:,1)),'r');
legend('Link Tx1-Rx1', 'Link Tx2-Rx1');
title('Fading envelopes for the links Tx1-Rx1 and Tx2-Rx1, for Path 1');

figure;
semilogy(abs(link12(:,1)),'b');
hold on; grid on;
semilogy(abs(link22(:,1)),'r');
legend('Link Tx1-Rx2', 'Link Tx2-Rx2');
title('Fading envelopes for the links Tx1-Rx2 and Tx2-Rx2, for Path 1');

figure;
semilogy(abs(link11(:,1)),'b');
hold on; grid on;
semilogy(abs(link12(:,1)),'r');
legend('Link Tx1-Rx1', 'Link Tx1-Rx2');
title('Fading envelopes for the links Tx1-Rx1 and Tx1-Rx2, for Path 1');

figure;
semilogy(abs(link21(:,1)),'b');
hold on; grid on;
semilogy(abs(link22(:,1)),'r');
legend('Link Tx2-Rx1', 'Link Tx2-Rx2');
title('Fading envelopes for the links Tx2-Rx1 and Tx2-Rx2, for Path 1');

%%
% We compute the transmit and receive correlation matrices for the first
% path. They show a good match with the theoretical values (compare with
% TxCorrelationMatrix(:,:,1) and RxCorrelationMatrix(:,:,1) calculated 
% earlier).

TxCorrMatrixPath1a = corrcoef(link11(:,1),link21(:,1)).'   % Rx antenna 1
TxCorrMatrixPath1b = corrcoef(link12(:,1),link22(:,1)).'   % Rx antenna 2
RxCorrMatrixPath1a = corrcoef(link11(:,1),link12(:,1)).'   % Tx antenna 1
RxCorrMatrixPath1b = corrcoef(link21(:,1),link22(:,1)).'   % Tx antenna 2

%% Selected Bibliography
% # IEEE P802.11 Wireless LANs, "TGn Channel Models", IEEE 802.11-03/940r4, 
% 2004-05-10.
% # L. Schumacher, K. I. Pedersen, and P. E. Mogensen, "From antenna
% spacings to theoretical capacities - Guidelines for simulating MIMO
% systems", Proc. PIMRC Conf., vol. 2, Sep. 2002, pp. 587-592.

displayEndOfDemoMessage(mfilename)

##### SOURCE END #####
--></body></html>