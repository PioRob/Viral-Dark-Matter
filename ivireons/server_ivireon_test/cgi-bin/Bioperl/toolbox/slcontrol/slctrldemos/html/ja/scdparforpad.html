
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML is auto-generated from an M-file. To make changes, update the M-file and republish this document.       --><title>並列計算を使用した周波数応答推定の高速化</title><meta name="generator" content="MATLAB 7.10"><meta name="date" content="2009-08-21"><meta name="m-file" content="scdparforpad"><link rel="stylesheet" type="text/css" href="../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit scdparforpad">エディターで scdparforpad.m を開く</a></div><div class="right"><a href="matlab:echodemo scdparforpad">コマンド ウィンドウで実行</a></div></div><div class="content"><h1>並列計算を使用した周波数応答推定の高速化</h1><!--introduction--><p>このデモでは、並行計算を使用して、Simulink&reg; モデルの周波数応答推定を高速化する方法を説明します。状況により、コマンド FRESTIMATE は、複数の Simulink&reg; シミュレーションを実行して、Simulink&reg; モデルの周波数応答を推定する場合もあります。これらのシミュレーションは、Parallel Computing Toolbox™ を使用して、MATLAB&reg; ワーカーのプールに配布できます。</p><p>このデモでは、Parallel Computing Toolbox™ が必要です。オプションで MATLAB Distributed Computing Server™ を使用して、コンピューター クラスターでシミュレーションを実行できます。このデモでは、Parallel Computing Toolbox™ で使用できるローカル ワーカーの機能を使用します。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">FRESTIMATE で実行される Simulink&reg; シミュレーションの高速化</a></li><li><a href="#2">MATLAB&reg; プールの設定</a></li><li><a href="#3">Sinestream の入力における各周波数の Simulink&reg; シミュレーションの配布</a></li><li><a href="#6">入力チャネルの Simulink&reg; シミュレーションの配布</a></li></ul></div><h2>FRESTIMATE で実行される Simulink&reg; シミュレーションの高速化<a name="1"></a></h2><p>FRESTIMATE コマンドを使用して周波数応答を計算する場合、計算時間のほとんどは通常、Simulink&reg; シミュレーションに費やされます。シミュレーションの合計時間を短縮するには、次のようにします。</p><p><b>1.</b> ラピッド アクセラレータ モードを使用する。FRESTIMATE コマンドを使用したラピッド アクセラレータ モードの使用例として、<a href="scdskyhoggpad.html">線形化の検証デモ</a>を参照してください。この方法は、ＦRESTIMATE で Simulink&reg; シミュレーションを 1 つだけを実行するときに使用します。</p><p><b>2.</b> MATLAB&reg; プールのワーカー間でシミュレーションを配布する。この方法は、FRESTIMATE で複数の Simulink&reg; シミュレーションを実行するときに使用します。FRESTIMATE は、以下を指定すると、複数の Simulink&reg; シミュレーションを実行します。</p><div><ul><li>&quot;SimulationOrder&quot; パラメーターが &quot;OneAtATime&quot; に設定されている Sinestream の入力信号。この場合、Sinestream 信号の各周波数は別々にシミュレートされます。</li></ul></div><div><ul><li>複数の入力点または非スカラーの入力点を持つ線形化 I/O 点。この場合、各線形化入力点または非スカラー線形化入力点の各チャネルで、個別の Simulink&reg; シミュレーションを実行します。</li></ul></div><p>並行計算オプションを使用した FRESTIMATE コマンドは、ノーマル モード、アクセラレータ モード、ラピッド アクセラレータ モードもサポートしています。</p><h2>MATLAB&reg; プールの設定<a name="2"></a></h2><p>並行計算を使用して、周波数応答推定を高速化するには、FRESTIMATE コマンドを実行する前に MATLAB&reg; ワーカーのプールを設定して開始します。</p><p><tt>matlabpool</tt> コマンドを使用して、MATLAB&reg; プールが開いていることを確認し、マルチコア デスクトップでローカル プールを開きます。これには、Parallel Computing Toolbox™ が必要です。</p><pre class="codeinput"><span class="keyword">if</span> matlabpool(<span class="string">'size'</span>) == 0
<span class="comment">%The matlabpool is not open, so open one</span>
matlabpool <span class="string">open</span> <span class="string">local</span>
<span class="keyword">end</span>
</pre><pre class="codeoutput">Starting matlabpool using the 'local' configuration ... connected to 8 labs.
</pre><h2>Sinestream の入力における各周波数の Simulink&reg; シミュレーションの配布<a name="3"></a></h2><p>FRESTIMATE コマンドで Sinestream の入力信号を使用し、&quot;SimulationOrder&quot; パラメーターを &quot;OneAtATime&quot; に設定すると、Sinestream 信号の各周波数は個別の Simulink&reg; シミュレーションでシミュレートされます。並行計算オプションを有効にすると、個々の周波数に対応するシミュレーションが MATLAB&reg; プールのワーカー間で配布されます。</p><pre class="codeinput">scdengine
mdl = <span class="string">'scdengine'</span>;
io = getlinio(mdl);
in = frest.Sinestream(<span class="string">'Frequency'</span>,logspace(-1,1,50),<span class="string">'Amplitude'</span>,1e-3,<span class="keyword">...</span>
    <span class="string">'SimulationOrder'</span>,<span class="string">'OneAtATime'</span>);
</pre><img vspace="5" hspace="5" src="../scdparforpad_01.png" alt=""> <p>上記のエンジン モデルには、単一の線形化入力点と単一の線形化出力点があります。 Sinestream 信号には 50 の周波数があり、&quot;SimulationOrder&quot; パラメーターが &quot;OneAtATime&quot; に設定されているため、FRESTIMATE コマンドは 50 の個別の Simulink&reg; シミュレーションを実行します。 FRESTIMATE の並列計算オプションを有効にして、これらのシミュレーションをワーカー間で配布するには、<tt>frestimateOptions</tt> コマンドを使用して周波数応答推定オプション オブジェクトを作成し、&quot;UseParallel&quot; パラメーターを &quot;on&quot; に設定します。 このオブジェクトを FRESTIMATE の入力引数として使用します。</p><pre class="codeinput">opt = frestimateOptions(<span class="string">'UseParallel'</span>,<span class="string">'on'</span>);
sysest = frestimate(mdl,io,in,opt);
bode(sysest,<span class="string">'r*'</span>)
</pre><img vspace="5" hspace="5" src="../scdparforpad_02.png" alt=""> <p>FRESTIMATE コマンドが、有効にされた並列計算オプションを使用した場合と使用しない場合で完全に最後まで実行するのに要する時間は次のとおりです。Intel&reg; Core(TM)2 Quad 2.4GHz プロセッサーを搭載した、RAM が 4GB の PC を使用しているとします。</p><p>
<table border=1><tr BGCOLOR="#CCCCCC"><td>並行計算オプション</td><td>時間 (秒)</td><td>速度向上</td></tr>
<tr><td>無効</td><td align="center">43.69</td><td align="center">1</td></tr>
<tr><td>2 人のワーカーで有効</td><td align="center">25.34</td><td align="center">1.72</td></tr>
<tr><td>3 人のワーカーで有効</td><td align="center">15.46</td><td align="center">2.83</td></tr>
<tr><td>4 人のワーカーで有効</td><td align="center">11.52</td><td align="center">3.79</td></tr>
</table>
</p><p>並行計算によって、周波数応答推定が著しく高速化されます。クライアントとワーカー間のデータおよびコード転送のオーバーヘッドやワーカー プロセスと OS プロセス間のリソース競合などのさまざまな要因によって、不完全な高速化が発生する場合があります。最初のシミュレーションの場合 (つまり、MATLAB&reg; ワーカーのプールを開いた直後)、Simulink&reg; の起動時間がオーバーヘッドに追加されます。</p><pre class="codeinput">bdclose(mdl);
</pre><h2>入力チャネルの Simulink&reg; シミュレーションの配布<a name="6"></a></h2><p>線形化入力点の数または線形化入力点のチャネル数が複数である場合、FRESTIMATE コマンドは、これらの入力チャネルに対応する個々の Simulink&reg; シミュレーションを MATLAB&reg; プールのワーカー間で配布します。</p><pre class="codeinput">scdmechconveyor
mdl = <span class="string">'scdmechconveyor'</span>;

io(1) = linio(<span class="string">'scdmechconveyor/Constant'</span>,1,<span class="string">'in'</span>);
io(2) = linio(<span class="string">'scdmechconveyor/Position Controller'</span>,1,<span class="string">'in'</span>);
io(3) = linio(<span class="string">'scdmechconveyor/Joint Sensor'</span>,1,<span class="string">'out'</span>);

<span class="comment">% Find the steady state operating point</span>
op = findop(mdl,20);
<span class="comment">% Linearize the system and create input signal using linearization result</span>
sys = linearize(mdl,io,op);
in = frest.Sinestream(sys);
</pre><img vspace="5" hspace="5" src="../scdparforpad_03.png" alt=""> <p><tt>linio</tt> コマンドを使用して、2 つの線形化入力点を指定します。これはどちらもスカラーの Simulink&reg; 信号にあります。FRESTIMATE コマンドを実行して、このモデルの周波数応答を推定すると、2 つの Simulink&reg; シミュレーションが各入力に対して 1 つずつ実行されます。並行計算オプションを有効にすると、シミュレーションはワーカー間で配布されます。並行計算オプションが有効である FRESTIMATE コマンドを実行し、解析的な線形化に対して推定結果をプロットします。</p><pre class="codeinput">opt = frestimateOptions(<span class="string">'UseParallel'</span>,<span class="string">'on'</span>);
sysest = frestimate(mdl,io,in,op,opt);
bodeopts = bodeoptions;
bodeopts.PhaseMatching = <span class="string">'on'</span>;
bodeplot(sys,sysest,<span class="string">'r*'</span>,bodeopts)
</pre><img vspace="5" hspace="5" src="../scdparforpad_04.png" alt=""> <p>FRESTIMATE コマンドが、有効にされた並列計算オプションを使用した場合と使用しない場合で完全に最後まで実行するのに要する時間は次のとおりです。Intel&reg; Core(TM)2 Quad 2.4GHz プロセッサーを搭載した、RAM が 4GB の PC を使用しているとします。</p><p>
<table border=1><tr BGCOLOR="#CCCCCC"><td>並行計算オプション</td><td>時間 (秒)</td><td>速度向上</td></tr>
<tr><td>無効</td><td align="center">56.99</td><td align="center">1</td></tr>
<tr><td>2 人のワーカーで有効</td><td align="center">31.94</td><td align="center">1.78</td></tr>
</table>
</p><p>周波数のシミュレーションを配布する場合と同様に、並行計算オプションを有効にすると、速度が 2 倍近く向上することが表に示されています。前述のように、いくつかの要因によって、クライアントとワーカー間のデータおよびコード転送やワーカー プロセスと OS プロセス間のリソース競合などの不完全な高速化が発生する場合があります。</p><p>モデルと MATLAB&reg; プールを閉じます。</p><pre class="codeinput">bdclose(mdl);
matlabpool <span class="string">close</span>;
</pre><pre class="codeoutput">Sending a stop signal to all the labs ... stopped.
</pre><p class="footer">Copyright 2005-2009 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.10</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Speeding Up Frequency Response Estimation Using Parallel Computing % Copyright 2005-2009 The MathWorks, Inc. % $Revision: 1.1.4.2.2.1 $ $Date: 2010/07/29 21:29:23 $ % % This demo illustrates how to use parallel computing for speeding up frequency % response estimation of Simulink(R) models. In some scenarios, the command  % FRESTIMATE performs multiple Simulink(R) simulations to estimate the % frequency response of a Simulink(R) model. You can % distribute these simulations to a pool of MATLAB(R) workers by % using Parallel Computing Toolbox(TM). % % This demo requires Parallel Computing Toolbox(TM). You can optionally use % MATLAB Distributed Computing Server(TM) to run simulations on a computer % cluster. This demo uses the local worker functionality available in % Parallel Computing Toolbox(TM).  %% Speeding up Simulink(R) Simulations Performed by FRESTIMATE % When you compute frequency response using the FRESTIMATE % command, the majority of computation time is usually spent in Simulink(R) simulations. To % reduce the total simulation time, you can: % % *1.* Use rapid accelerator mode. See the <scdskyhoggpad.html % "linearization validation demonstration"> as an example of using rapid % accelerator mode with the FRESTIMATE command. Use this method when % FRESTIMATE performs only one Simulink(R) simulation. % % *2.* Distribute simulations among workers in a MATLAB(R) pool. Use % this method when FRESTIMATE performs multiple Simulink(R) simulations. % FRESTIMATE performs more than one Simulink(R) simulation when you specify % the following: % % * A Sinestream input signal with "SimulationOrder" parameter set to % "OneAtATime". In this case, each frequency in the Sinestream signal is % simulated separately. % % * Linearization I/O points with more than one input point or a non-scalar input % point. In this case, each linearization input point or each channel in a % non-scalar linearization input point yields a separate Simulink(R) % simulation. % % Note that FRESTIMATE command using parallel computing option also supports % normal, accelerator and rapid accelerator modes.    %% Configuring a MATLAB(R) Pool % To use parallel computing to speed up frequency response estimation, % configure and start a pool of MATLAB(R) workers before you run the FRESTIMATE command. % % Use the |matlabpool| command to check if a MATLAB(R) % pool is open, and then open a local pool on your multicore desktop. This % requires Parallel Computing Toolbox(TM).  if matlabpool('size') == 0    %The matlabpool is not open, so open one    matlabpool open local end  %% Distributing Simulink(R) Simulations for Each Frequency in Sinestream Input % When you use a Sinestream input signal with FRESTIMATE command and you % set the "SimulationOrder" parameter to "OneAtATime", each % frequency in the Sinestream signal simulates in a separate % Simulink(R) simulation. If you enable the parallel computing option, the simulations % corresponding to individual frequencies are distributed among workers in % the MATLAB(R) pool.   scdengine mdl = 'scdengine'; io = getlinio(mdl); in = frest.Sinestream('Frequency',logspace(-1,1,50),'Amplitude',1e-3,...     'SimulationOrder','OneAtATime');  %% % In the engine model above, there is a single linearization input point and % a single linearization output point. There are 50 % frequencies in the Sinestream signal and the FRESTIMATE command performs % 50 separate Simulink(R) simulations, because the "SimulationOrder" parameter is % set to "OneAtATime". To enable the parallel computing option for FRESTIMATE to % distribute these simulations among workers, create a frequency % response estimation options object using the command |frestimateOptions| % and set the "UseParallel" parameter to "on". Use this object as input % argument for FRESTIMATE.  opt = frestimateOptions('UseParallel','on'); sysest = frestimate(mdl,io,in,opt); bode(sysest,'r*')  %% % The time it takes for the FRESTIMATE command to run to completion with % and without parallel computing option enabled is shown below. A PC with % Intel(R) Core(TM)2 Quad 2.4GHz processor and 4GB of RAM is used. % % <html> % <table border=1><tr BGCOLOR="#CCCCCC"><td>Parallel Computing Option</td><td>Time(secs)</td><td>Speedup</td></tr> % <tr><td>Disabled</td><td align="center">43.69</td><td align="center">1</td></tr> % <tr><td>Enabled with 2 workers</td><td align="center">25.34</td><td align="center">1.72</td></tr> % <tr><td>Enabled with 3 workers</td><td align="center">15.46</td><td align="center">2.83</td></tr> % <tr><td>Enabled with 4 workers</td><td align="center">11.52</td><td align="center">3.79</td></tr> % </table> % </html> %  % Parallel computing significantly speeds up the frequency response % estimation. The imperfect speedup can be caused by various factors % including the overhead from data and code transfer between client and % workers and resource competition between worker processes and OS % processes. For first simulation (i.e. immediately after opening the pool % of MATLAB(R) workers), Simulink(R) start-up time can add to the overhead.  bdclose(mdl);  %% Distributing Simulink(R) Simulations for Input Channels % When the number of linearization input points or the number of channels % in a linearization input point is greater than one, the FRESTIMATE command distributes % individual Simulink(R) simulations corresponding to these input channels % among workers in the MATLAB(R) pool. scdmechconveyor mdl = 'scdmechconveyor';  io(1) = linio('scdmechconveyor/Constant',1,'in'); io(2) = linio('scdmechconveyor/Position Controller',1,'in'); io(3) = linio('scdmechconveyor/Joint Sensor',1,'out');  % Find the steady state operating point op = findop(mdl,20); % Linearize the system and create input signal using linearization result sys = linearize(mdl,io,op); in = frest.Sinestream(sys);  %% % With the |linio| commands, you specify two linearization input % points, which are both located on scalar Simulink(R) signals. If you % run the FRESTIMATE command to estimate the frequency response for this % model, two Simulink(R) simulations occur, one for each input. If you % enable the parallel computing option, the simulations are distributed among % workers. Run FRESTIMATE command with parallel computing option enabled and % plot the estimation result against analytical linearization: opt = frestimateOptions('UseParallel','on'); sysest = frestimate(mdl,io,in,op,opt); bodeopts = bodeoptions; bodeopts.PhaseMatching = 'on'; bodeplot(sys,sysest,'r*',bodeopts)   %% % The time it takes for the FRESTIMATE command to run to completion with % and without parallel computing option enabled is shown below. A PC with % Intel(R) Core(TM)2 Quad 2.4GHz processor and 4GB of RAM is used. % % <html> % <table border=1><tr BGCOLOR="#CCCCCC"><td>Parallel Computing Option</td><td>Time(secs)</td><td>Speedup</td></tr> % <tr><td>Disabled</td><td align="center">56.99</td><td align="center">1</td></tr> % <tr><td>Enabled with 2 workers</td><td align="center">31.94</td><td align="center">1.78</td></tr> % </table> % </html> % % As in the case of distributing simulations for frequencies, the table % shows nearly a two-fold speedup with the parallel computing option % enabled. As mentioned before, several factors may contribute to imperfect % speedup including data and code transfer between client and workers and % resource competition between worker processes and OS processes.  %% % Close the model and the MATLAB(R) pool: bdclose(mdl); matlabpool close; displayEndOfDemoMessage(mfilename) ##### SOURCE END ##### --></body></html>