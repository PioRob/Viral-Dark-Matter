
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>熱交換器内の温度制御</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="heatexdemo.m"><link rel="stylesheet" type="text/css" href="../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit heatexdemo">エディターで heatexdemo.m を開く</a></div><div class="right"><a href="matlab:echodemo heatexdemo">コマンド ウィンドウで実行</a></div></div><div class="content"><h1>熱交換器内の温度制御</h1><!--introduction--><p>このデモは、フィードバック補償器およびフィードフォワード補償器を設計し、熱交換器により化学反応器の温度を調整する方法を示します。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">熱交換器のプロセス</a></li><li><a href="#3">測定データを使用した熱交換器ダイナミクスのモデル化</a></li><li><a href="#8">フィードバック制御</a></li><li><a href="#17">フィードフォワード制御</a></li><li><a href="#20">フィードフォワード/フィードバック結合型制御</a></li><li><a href="#26">対話型シミュレーション</a></li></ul></div><h2>熱交換器のプロセス<a name="1"></a></h2><p>以下に、「攪拌タンク」と呼ばれる化学反応器を示しています。上部の入口からは、水槽内で混合する液体が送られます。水槽の液体は、制御バルブを経由して熱交換器 (下部のパイプ) に供給される流量を調節することで、一定の温度を維持しなければなりません。入口の流れの温度の変動は、このプロセスの外乱の主な原因となります。</p><p><img vspace="5" hspace="5" src="../../Figures/heatex_01.png" alt=""> </p><p><b>図 1:</b> 熱交換器を含む攪拌反応器</p><h2>測定データを使用した熱交換器ダイナミクスのモデル化<a name="3"></a></h2><p>むだ時間を付加した 1 次モデルを熱交換器の特性から導出するには、バルブ電圧 <tt>V</tt> にステップ外乱を加え、時間の経過に伴う水槽の温度 <tt>T</tt> に対する影響を記録します。以下に、測定した応答を正規化された単位で示します。</p><pre class="codeinput">heatex_plotdata
title(<span class="string">'Measured response to step change in steam valve voltage'</span>);
</pre><img vspace="5" hspace="5" src="../heatexdemo_01.png" alt=""> <p>値 t1 および t2 は、応答が最終値の 28.3% および 63.2% に到達した時間です。これらの値を使用すると、熱交換器の時間定数 <tt>tau</tt> とむだ時間 <tt>theta</tt> を推定できます。</p><pre class="codeinput">t1 = 21.8; t2 = 36.0;
tau = 3/2 * ( t2 - t1 )
theta = t2 - tau
</pre><pre class="codeoutput">
tau =

   21.3000


theta=

   14.7000

</pre><p>むだ時間を付加した 1 次応答を測定した応答と比較して、これらの計算を検証します。</p><pre class="codeinput">s = tf(<span class="string">'s'</span>);
Gp = exp(-theta*s)/(1+tau*s)
</pre><pre class="codeoutput"> 
Transfer function:
                   1
exp(-14.7*s) * ----------
               21.3 s + 1
 
</pre><pre class="codeinput">hold <span class="string">on</span>, step(Gp), hold <span class="string">off</span>
title(<span class="string">'Experimental vs. simulated response to step change'</span>);
</pre><img vspace="5" hspace="5" src="../heatexdemo_02.png" alt=""> <p>モデル応答と実験データは非常によく一致しています。流入温度のステップ外乱に対する 1 次応答を推定するには、似たようなバンプ テスト実験を実施できます。熱交換器と流入外乱に対するモデルを用意したので、これで制御アルゴリズムを設計する準備が整いました。</p><h2>フィードバック制御<a name="8"></a></h2><p>次のブロック線図は、開ループ プロセスを示しています。</p><p><img vspace="5" hspace="5" src="../../Figures/heatex_02.png" alt=""> </p><p><b>図 2:</b> 開ループ プロセス</p><p>次の伝達関数</p><p><img src="../heatexdemo_eq49594.png" alt="$$ G_p(s) = {e^{-14.7 s} \over 21.3s+1} $$"></p><p>は、蒸気バルブを開く電圧 <tt>V</tt> の変化が水槽の温度 <tt>T</tt> にどのように影響を及ぼすかをモデル化したもので、次の伝達関数</p><p><img src="../heatexdemo_eq25607.png" alt="$$ G_d(s) = {e^{-35 s} \over 25s+1}  $$"></p><p>は、流入温度の変化 <tt>d</tt> が <tt>T</tt> に及ぼす影響をモデル化したものです。与えられた設定点 <tt>Tsp</tt> 付近の水槽の温度 <tt>T</tt> を調節するには、次のフィードバック アーキテクチャを使用してバルブの開口 (電圧 <tt>V</tt>) を制御できます。</p><p><img vspace="5" hspace="5" src="../../Figures/heatex_03.png" alt=""> </p><p><b>図 3:</b> フィードバック制御</p><p>この設定では、比例積分 (PI) コントローラ</p><p><img src="../heatexdemo_eq49345.png" alt="$$ C(s) = K_c (1 + {1 \over \tau_c s} ) $$"></p><p>が、望ましい温度と測定温度間のギャップ <tt>Tsp-T</tt> に基づいて電圧 <tt>V</tt> を計算します。コントローラのパラメーターに適した値を選択するには、ITAE 式を使用できます。</p><p><img src="../heatexdemo_eq84612.png" alt="$$ K_c =  0.859 (\theta / \tau)^{-0.977} , \;\;\; \tau_c = ( \theta / \tau )^{0.680} \tau / 0.674 $$"></p><pre class="codeinput">Kc = 0.859 * (theta / tau)^(-0.977)
tauc = ( tau / 0.674 ) * ( theta / tau )^0.680
C = Kc * (1 + 1/(tauc*s));
</pre><pre class="codeoutput">
Kc =

    1.2341


tauc =

   24.5582

</pre><p>ITAE コントローラの動作を確認するには、フィードバック ループを閉じ、設定点の変化に対する応答をシミュレートします。</p><pre class="codeinput">Tfb = feedback(ss(Gp*C),1);
step(Tfb), grid <span class="string">on</span>
title(<span class="string">'Response to step change in temperature setpoint T_{sp}'</span>)
ylabel(<span class="string">'Tank temperature'</span>)
</pre><img vspace="5" hspace="5" src="../heatexdemo_03.png" alt=""> <p>応答は比較的速く、一部にオーバーシュートが見られます。安定余裕を見てみると、ゲイン余裕が弱いことがわかります。</p><pre class="codeinput">margin(Gp*C), grid
</pre><img vspace="5" hspace="5" src="../heatexdemo_04.png" alt=""> <p>比率ゲイン <tt>Kc</tt> を削減すると、性能は低下しますが、安定性は強化されます。</p><pre class="codeinput">C1 = 0.9 * (1 + 1/(tauc*s));  <span class="comment">% reduce Kc from 1.23 to 0.9</span>
margin(Gp*C1), grid
</pre><img vspace="5" hspace="5" src="../heatexdemo_05.png" alt=""> <pre class="codeinput">step(Tfb,<span class="string">'b'</span>, feedback(ss(Gp*C1),1),<span class="string">'r'</span>)
legend(<span class="string">'Kc = 1.23'</span>,<span class="string">'Kc = 0.9'</span>)
</pre><img vspace="5" hspace="5" src="../heatexdemo_06.png" alt=""> <h2>フィードフォワード制御<a name="17"></a></h2><p>流入温度の変化は水槽内の温度が変動する主な原因であることを思い出してください。このような外乱を避けるために、フィードバック制御に代わるものとして、以下に示すフィードフォワード アーキテクチャがあります。</p><p><img vspace="5" hspace="5" src="../../Figures/heatex_04.png" alt=""> </p><p><b>図 4:</b> フィードフォワード制御</p><p>この設定では、フィードフォワード コントローラ <tt>F</tt> は流入温度の測定値を使用して、蒸気バルブの開口 (電圧 <tt>V</tt>) を調整します。したがって、フィードフォワード制御では流入温度の変化の影響を予期し、事前に回避します。</p><p>簡単な計算により、温度の外乱 <tt>d</tt> は水槽の温度 <tt>T</tt> に次のように総合的に伝達されることが示されます。</p><p><img src="../heatexdemo_eq85320.png" alt="$$ T = (G_p F + G_d) d $$"></p><p>完全に外乱を除去するには以下が必要です。</p><p><img src="../heatexdemo_eq37696.png" alt="$$ G_p F + G_d = 0  \rightarrow F = -{G_d \over G_p} = - {21.3s+1 \over 25s+1} e^{-20.3 s}$$"></p><p>実際には、モデル化が不正確であると外乱を正確に除去できなくなりますが、フィードフォワード制御を行うと、流入外乱による温度の変動を最小限に抑えることができます。フィードフォワード方法がどのように機能するかを詳しく理解するには、理想的なフィードフォワードの遅れを 5 秒増加し、流入温度のステップ変化に対する応答をシミュレートします。</p><pre class="codeinput">Gd = exp(-35*s)/(25*s+1);
F = -(21.3*s+1)/(25*s+1) * exp(-25*s);
Tff = Gp * ss(F) + Gd;   <span class="comment">% d-&gt;T transfer with feedforward control</span>

step(Tff), grid
title(<span class="string">'Effect of a step disturbance in inflow temperature'</span>)
ylabel(<span class="string">'Tank temperature'</span>)
</pre><img vspace="5" hspace="5" src="../heatexdemo_07.png" alt=""> <h2>フィードフォワード/フィードバック結合型制御<a name="20"></a></h2><p>フィードバック制御は一般的に設定値のトラッキングに適しています。一方、フィードフォワード制御は測定された外乱の除去に役立ちます。次に、両方の方法を組み合わせることの利点を見ていきます。対応する制御アーキテクチャを以下に示します。</p><p><img vspace="5" hspace="5" src="../../Figures/heatex_05.png" alt=""> </p><p><b>図 5:</b> フィードフォワード/フィードバック制御</p><p><tt>CONNECT</tt> を使用して、<tt>Tsp,d</tt> から <tt>T</tt> への対応する閉ループ モデルを作成します。はじめに、各ブロックの入力および出力チャンネルに名前を付けます。次に <tt>CONNECT</tt> によってブロック線図の線が自動的に結合されます。</p><pre class="codeinput">Gd.InputName = <span class="string">'d'</span>;  Gd.OutputName = <span class="string">'Td'</span>;
Gp.InputName = <span class="string">'V'</span>;  Gp.OutputName = <span class="string">'Tp'</span>;
F.InputName = <span class="string">'d'</span>;  F.OutputName = <span class="string">'Vf'</span>;
C.InputName = <span class="string">'e'</span>;  C.OutputName = <span class="string">'Vc'</span>;
Sum1 = sumblk(<span class="string">'e'</span>,<span class="string">'Tsp'</span>,<span class="string">'T'</span>,<span class="string">'+-'</span>);
Sum2 = sumblk(<span class="string">'V'</span>,<span class="string">'Vf'</span>,<span class="string">'Vc'</span>,<span class="string">'++'</span>);
Sum3 = sumblk(<span class="string">'T'</span>,<span class="string">'Tp'</span>,<span class="string">'Td'</span>,<span class="string">'++'</span>);
Tffb = connect(ss(Gp),Gd,C,F,Sum1,Sum2,Sum3,{<span class="string">'Tsp'</span>,<span class="string">'d'</span>},<span class="string">'T'</span>);
</pre><p>フィードフォワード制御を使用した閉ループ応答と使用しない閉ループ応答を比較するために、フィードバックのみの設定に対し、対応する閉ループ伝達関数を計算します。</p><pre class="codeinput">C.InputName = <span class="string">'e'</span>;  C.OutputName = <span class="string">'V'</span>;
Tfb = connect(ss(Gp),Gd,C,Sum1,Sum3,{<span class="string">'Tsp'</span>,<span class="string">'d'</span>},<span class="string">'T'</span>);
</pre><p>次に、2 つの設計を比較します。</p><pre class="codeinput">step(Tfb,<span class="string">'b'</span>,Tffb,<span class="string">'r--'</span>), grid
title(<span class="string">'Closed-loop response to setpoint and disturbance step change'</span>)
ylabel(<span class="string">'Tank temperature'</span>)
legend(<span class="string">'Feedback only'</span>,<span class="string">'Feedforward + feedback'</span>)
</pre><img vspace="5" hspace="5" src="../heatexdemo_08.png" alt=""> <p>設定値のトラッキング性能はどちらの設計でも同じですが、フィードフォワード制御を使用した場合の外乱の除去は明らかに向上しています。これは、閉ループ ボード線図を見ても明確です。</p><pre class="codeinput">bodemag(Tfb,<span class="string">'b'</span>,Tffb,<span class="string">'r--'</span>,{1e-3,1e1})
legend(<span class="string">'Feedback only'</span>,<span class="string">'Feedforward + feedback'</span>,<span class="string">'Location'</span>,<span class="string">'SouthEast'</span>)
</pre><img vspace="5" hspace="5" src="../heatexdemo_09.png" alt=""> <h2>対話型シミュレーション<a name="26"></a></h2><p>さらに洞察を深め、フィードフォワード ゲインとフィードバック ゲインを対話形式で調整するには、あらかじめビルドされた GUI および Simulink&reg; モデルを使用します。次のリンクをクリックして GUI を起動します。</p><p><a href="matlab:heatex">熱交換器モデルおよび GUI を開く</a></p><pre class="codeinput">heatex
</pre><nobr><img vspace="5" hspace="5" src="../heatexdemo_10.png" alt=""> <img vspace="5" hspace="5" src="../heatexdemo_11.png" alt=""></nobr> <p class="footer">Copyright 1986-2009 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Temperature Control in a Heat Exchanger % This demo shows how to design  feedback and feedforward  % compensators to regulate the temperature of a chemical  % reactor through a heat exchanger.  %   Copyright 1986-2009 The MathWorks, Inc. %   $Revision: 1.1.4.2.2.1 $  $Date: 2010/07/29 21:28:40 $  %% Heat Exchanger Process % A chemical reactor called "stirring tank" is depicted below. The top inlet % delivers liquid to be mixed in the tank. The tank liquid must be  % maintained at a constant temperature by varying the amount of % steam supplied to the heat exchanger (bottom pipe) via its control valve.  % Variations in the temperature of the inlet flow are the main source % of disturbances in this process. % % <<../Figures/heatex_01.png>>  %% % *Figure 1*: Stirring Reactor with Heat Exchanger.  %% Using Measured Data to Model The Heat Exchanger Dynamics % % To derive a first-order-plus-deadtime model of the heat exchanger % characteristics, inject a step disturbance in valve voltage |V| and record % the effect on the tank temperature |T| over time. The measured response in % normalized units is shown below: heatex_plotdata title('Measured response to step change in steam valve voltage');  %% % The values t1 and t2 are the times where the response attains 28.3% and % 63.2% of its final value. You can use these values to estimate the time  % constant |tau| and dead time |theta| for the heat exchanger: t1 = 21.8; t2 = 36.0; tau = 3/2 * ( t2 - t1 ) theta = t2 - tau  %% % Verify these calculations by comparing the first-order-plus-deadtime % response with the measured response: s = tf('s'); Gp = exp(-theta*s)/(1+tau*s)  %% hold on, step(Gp), hold off title('Experimental vs. simulated response to step change');  %% % The model response and the experimental data are in good agreement. % A similar bump test experiment could be conducted to estimate the % first-order response to a step disturbance in inflow temperature. % Equipped with models for the heat exchanger and inflow disturbance, we % are ready to design the control algorithm.  %% Feedback Control % A block diagram representation of the open-loop process is shown below. % % <<../Figures/heatex_02.png>>  %% % *Figure 2*: Open-Loop Process.  %% % The transfer function  % % $$ G_p(s) = {e^{-14.7 s} \over 21.3s+1} $$ % % models how a change in the voltage |V| driving the  % steam valve opening affects the tank temperature |T|, while the transfer function % % $$ G_d(s) = {e^{-35 s} \over 25s+1}  $$ % % models how a change |d| in inflow temperature affects |T|. % To regulate the tank temperature |T| around a given setpoint |Tsp|, % we can use the following feedback architecture to control the valve  % opening (voltage |V|):  % % <<../Figures/heatex_03.png>>  %% % *Figure 3*: Feedback Control.  %% % In this configuration, the proportional-integral (PI) controller % % $$ C(s) = K_c (1 + {1 \over \tau_c s} ) $$  % % calculates the voltage |V| based on the gap |Tsp-T| between the desired % and measured temperatures. You can use the ITAE formulas to pick adequate % values for the controller parameters: % % $$ K_c =  0.859 (\theta / \tau)^{-0.977} , \;\;\; \tau_c = ( \theta / \tau )^{0.680} \tau / 0.674 $$  % Kc = 0.859 * (theta / tau)^(-0.977) tauc = ( tau / 0.674 ) * ( theta / tau )^0.680 C = Kc * (1 + 1/(tauc*s));  %% % To see how well the ITAE controller performs, close the feedback loop and % simulate the response to a set point change: Tfb = feedback(ss(Gp*C),1); step(Tfb), grid on title('Response to step change in temperature setpoint T_{sp}') ylabel('Tank temperature')  %% % The response is fairly fast with some overshoot. Looking at the stability % margins confirms that the gain margin is weak: margin(Gp*C), grid  %%  % Reducing the proportional gain |Kc| strengthens stability at the expense % of performance: C1 = 0.9 * (1 + 1/(tauc*s));  % reduce Kc from 1.23 to 0.9 margin(Gp*C1), grid  %% step(Tfb,'b', feedback(ss(Gp*C1),1),'r') legend('Kc = 1.23','Kc = 0.9')  %% Feedforward Control % Recall that changes in inflow temperature are the main source of temperature  % fluctuations in the tank. To reject such disturbances, an alternative to % feedback control is the feedforward architecture shown below: % % <<../Figures/heatex_04.png>>  %% % *Figure 4*: Feedforward Control.  %% % In this configuration, the feedforward controller |F| uses measurements % of the inflow temperature to adjust the steam valve opening (voltage % |V|). Feedforward control thus anticipates and preempts the effect of % inflow temperature changes. % % Straightforward calculation shows that the overall transfer from % temperature disturbance |d| to tank temperature |T| is  % % $$ T = (G_p F + G_d) d $$ % % Perfect disturbance rejection requires  % % $$ G_p F + G_d = 0  \rightarrow F = -{G_d \over G_p} = - {21.3s+1 \over 25s+1} e^{-20.3 s}$$ % % In reality, modeling inaccuracies prevent exact disturbance rejection, % but feedforward control will help minimize temperature fluctuations due % to inflow disturbances. To get a better sense of how the feedforward % scheme would perform, increase the ideal feedforward delay by 5 seconds % and simulate the response to a step change in inflow temperature: Gd = exp(-35*s)/(25*s+1); F = -(21.3*s+1)/(25*s+1) * exp(-25*s); Tff = Gp * ss(F) + Gd;   % d->T transfer with feedforward control  step(Tff), grid title('Effect of a step disturbance in inflow temperature') ylabel('Tank temperature')   %% Combined Feedforward-Feedback Control % Feedback control is good for setpoint tracking in general, while  % feedforward control can help with rejection of measured disturbances. % Next we look at the benefits of combining both schemes. The corresponding % control architecture is shown below: % % <<../Figures/heatex_05.png>>  %% % *Figure 5*: Feedforward-Feedback Control.  %% % Use |CONNECT| to build the corresponding closed-loop model from |Tsp,d| % to |T|. First name the input and output channels of each block, then let % |CONNECT| automatically wire the diagram: Gd.InputName = 'd';  Gd.OutputName = 'Td'; Gp.InputName = 'V';  Gp.OutputName = 'Tp'; F.InputName = 'd';  F.OutputName = 'Vf'; C.InputName = 'e';  C.OutputName = 'Vc'; Sum1 = sumblk('e','Tsp','T','+-'); Sum2 = sumblk('V','Vf','Vc','++'); Sum3 = sumblk('T','Tp','Td','++'); Tffb = connect(ss(Gp),Gd,C,F,Sum1,Sum2,Sum3,{'Tsp','d'},'T');  %% % To compare the closed-loop responses with and without feedforward % control, calculate the corresponding closed-loop transfer function for the % feedback-only configuration: C.InputName = 'e';  C.OutputName = 'V'; Tfb = connect(ss(Gp),Gd,C,Sum1,Sum3,{'Tsp','d'},'T');  %% % Now compare the two designs: step(Tfb,'b',Tffb,'rREPLACE_WITH_DASH_DASH'), grid title('Closed-loop response to setpoint and disturbance step change') ylabel('Tank temperature') legend('Feedback only','Feedforward + feedback')  %% % The two designs have identical performance for setpoint tracking,  % but the addition of feedforward control is clearly beneficial for % disturbance rejection. This is also visible on the closed-loop Bode plot bodemag(Tfb,'b',Tffb,'rREPLACE_WITH_DASH_DASH',{1e-3,1e1}) legend('Feedback only','Feedforward + feedback','Location','SouthEast')  %% Interactive Simulation % To gain additional insight and interactively tune the feedforward and % feedback gains, use the companion GUI and Simulink(R) model. Click on the % link below to launch the GUI. % % <matlab:heatex Open the Heat Exchanger model and GUI> heatex  displayEndOfDemoMessage(mfilename) ##### SOURCE END ##### --></body></html>