
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>モデル参照のバリアント</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="sldemo_mdlref_variants.m"><link rel="stylesheet" type="text/css" href="../../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left">sldemo_mdlref_variants.mdl</div><div class="right"><a href="matlab:sldemo_mdlref_variants">このモデルを開く</a></div></div><div class="content"><h1>モデル参照のバリアント</h1><!--introduction--><p>このデモでは、モデル参照のバリアントについて説明します。Model ブロックは、ある Simulink&reg; モデルを別の Simulink モデルから参照するために使用されます。1 つの Model ブロックが、さまざまなバリアントを持つことができます。<i></i>バリアントは、1 つの Model ブロックが動作できる N 個のモードのうちの 1 つを表します。Model ブロックの各バリアントは、オプションのモデル固有の引数を使用して特定のモデルを参照します。シミュレーションでは、1 つのバリアントのみがアクティブになります。Model ブロックのアクティブ バリアントは、ベース ワークスペース内の変数の値を変更するか、[Model ブロック] ダイアログを使用してバリアントの選択を手動でオーバーライドして切り替えることができます。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">デモの要件</a></li><li><a href="#2">モデル バリアントの概要</a></li><li><a href="#3">Model ブロックのバリアントの指定</a></li><li><a href="#5">アクティブ バリアントの切り替え</a></li><li><a href="#8">列挙と再利用</a></li></ul></div><h2>デモの要件<a name="1"></a></h2><p>このデモの実行中、現在の作業ディレクトリ内に作成された Simulink プロジェクト ディレクトリにコードが生成される場合があります。このディレクトリにファイルを生成したくない場合 (あるいは生成できない場合) は、作業ディレクトリを適切なディレクトリに変更してください。</p><h2>モデル バリアントの概要<a name="2"></a></h2><p>Model ブロックは、ある Simulink モデル <i></i><i></i>(子モデル) を別の Simulink モデル <i></i><i></i>(親モデル) から参照するために使用されます。1 つの Model ブロックが、さまざまなバリアントを持つことができます。バリアントは、その Model ブロックに参照される可能性があるモデルのセットで構成されます。この例では、Controller という名の Model ブロックに参照される可能性があるモデルが 2 つあります。</p><p>Model ブロック内の各<i></i>バリアントは、<tt>Simulink.Variant</tt> オブジェクトに関連付けられています。<tt>Simulink.Variant</tt> オブジェクトは、MATLAB&reg; ベース ワークスペースで作成されます。以下に例を示します。</p><p><tt>V_NONLINEAR_CONTROLLER=Simulink.Variant('CTRL=1');</tt></p><p>ここで、コンストラクター引数 <tt>('CTRL=1')</tt> は、そのバリアントがアクティブになる場合の条件を定義します。この場合、ベース ワークスペースで</p><p><tt>CTRL=1</tt></p><p>を定義すると、<tt>V_NONLINEAR_CONTROLLER</tt> バリアントがアクティブ化されます。条件引数は、スカラー変数、列挙、等値、非等値、&amp;&amp;、|| および ~ で構成される<i></i>単純な <i></i>式にすることができます。かっこ () を使用すると、優先順位をグループ化できます。</p><p>シミュレーション中は、任意の Model ブロックについて 1 つのバリアントがアクティブになります。<i></i><i></i>アクティブ バリアントは、MATLAB ベース ワークスペース内のバリアント オブジェクトの条件を評価することによって決定されます。あるいは、<b>[バリアントの条件をオーバーライドして以下のバリアントを使用]</b> チェック ボックスをオンにして、Model ブロックに特定のバリアントを使用するように指示することもできます。</p><h2>Model ブロックのバリアントの指定<a name="3"></a></h2><p>このデモで使用されるモデルには、MATLAB ベース ワークスペースで以下の変数を定義する必要があります。</p><p><tt>V_NONLINEAR_CONTROLLER=Simulink.Variant('CTRL==1');</tt></p><p><tt>V_SECOND_ORDER_CONTROLLER=Simulink.Variant('CTRL==2');</tt></p><p><tt>CTRL=1;</tt></p><p>デモ モデル <a href="matlab:open_system('sldemo_mdlref_variants')"><tt>sldemo_mdlref_variants</tt></a> を開くと、<tt>[ファイル] -&gt; [ModelProperties] -&gt; [コールバック]</tt> で定義された <b>PreLoadFcn</b> が実行されます。これにより、ベース ワークスペースに Controller という名の Model ブロックの変数が入力されます。</p><pre class="codeoutput"> 
V_NONLINEAR_CONTROLLER =
 
Simulink.Variant
Condition:'CTRL==1'

 
V_SECOND_ORDER_CONTROLLER =
 
Simulink.Variant
Condition:'CTRL==2'


CTRL =

     1

</pre><img vspace="5" hspace="5" src="../sldemo_mdlref_variants_01.png" alt=""> <img vspace="5" hspace="5" src="../sldemo_mdlref_variants_02.png" alt=""> <p><b>図 1:</b> デモ モデル <tt>sldemo_mdlref_variants</tt></p><p>Model ブロック Controller を右クリックして、<b>[ModelReference パラメーター...]</b> メニュー項目を選択し、<a href="matlab:open_system('sldemo_mdlref_variants/Controller','parameter');">[Model ブロック] ダイアログを開きます</a>。</p><p>このダイアログで、可能なバリアントが 2 つ指定されます。それらの 2 つのバリアントが、<tt>V_NONLINEAR_CONTROLLER</tt> と <tt>V_SECOND_ORDER_CONTROLLER</tt> という 2 つの <tt>Simulink.Variant</tt> オブジェクトに関連付けられます。これらのオブジェクトはベース ワークスペース内に存在しています。これらのオブジェクトには、boolean として評価され、どのバリアントがアクティブになるのかを特定する式である、<b>条件</b>という名のプロパティがあります。<b>条件</b>は、[Model ブロック] ダイアログにも表示されます。この例では、<tt>V_NONLINEAR_CONTROLLER</tt> と <tt>V_SECOND_ORDER_CONTROLLER</tt> の<b>条件</b>は、それぞれ <tt>CTRL == 1</tt> と <tt>CTRL == 2</tt> です。変数 <tt>CTRL</tt> はベース ワークスペース内に存在し、標準の MATLAB 変数または <tt>Simulink.Parameter</tt> にすることができます。</p><h2>アクティブ バリアントの切り替え<a name="5"></a></h2><p><tt>sldemo_mrv_nonlinear_controller</tt> を使用してシミュレートするには、ベース ワークスペースで</p><p><tt>CTRL=1</tt></p><p>を定義してから、モデルをシミュレートします。</p><img vspace="5" hspace="5" src="../sldemo_mdlref_variants_03.png" alt=""> <p><b>図 2:</b> <tt>sldemo_mrv_nonlinear_controller</tt> バリアントを使用したシミュレーション</p><p><tt>sldemo_second_order_controller</tt> を使用してシミュレートするには、ベース ワークスペースで</p><p><tt>CTRL=2</tt></p><p>を定義してから、モデルをシミュレートします。</p><img vspace="5" hspace="5" src="../sldemo_mdlref_variants_04.png" alt=""> <p><b>図 3:</b> <tt>sldemo_mrv_second_order_controller</tt> バリアントを使用したシミュレーション</p><h2>列挙と再利用<a name="8"></a></h2><p>sldemo_mdlref_variants_enum モデルで、以下の <tt>Simulink.Variant</tt> の機能を説明します。</p><p>1. <b>列挙:</b> MATLAB 列挙クラスを使用すると、バリアント オブジェクトの条件を読みやすくすることができます。</p><p>2. <b>再利用:</b> <tt>Simulink.Variant</tt> オブジェクトは、別の Model ブロックで再利用できます。</p><p>このデモでは、MATLAB ベース ワークスペースで以下の変数を定義する必要があります。</p><p><tt>VE_NONLINEAR_CONTROLLER=Simulink.Variant('E_CTRL==sldemo_mrv_CONTROLLER_TYPE.NONLINEAR')</tt></p><p><tt>VE_SECOND_ORDER_CONTROLLER=Simulink.Variant('E_CTRL==sldemo_mrv_CONTROLLER_TYPE.SECOND_ORDER')</tt></p><p><tt>E_CTRL=sldemo_mrv_CONTROLLER_TYPE.SECOND_ORDER</tt></p><p><tt>VE_PROTOTYPE=Simulink.Variant('E_CURRENT_BUILD==sldemo_mrv_BUILD_TYPE.PROTOTYPE')</tt></p><p><tt>VE_PRODUCTION=Simulink.Variant('E_CURRENT_BUILD==sldemo_mrv_BUILD_TYPE.PRODUCTION')</tt></p><p><tt>E_CURRENT_BUILD=sldemo_mrv_BUILD_TYPE.PRODUCTION</tt></p><p>これらの Simulink.Variant では、読みやすくするために、<tt>Simulink.Variant</tt> の<b>条件</b>プロパティ内で <a href="matlab:edit('sldemo_mrv_BUILD_TYPE.m');">sldemo_mrv_BUILD_TYPE.m</a> と <a href="matlab:edit('sldemo_mrv_CONTROLLER_TYPE.m');">sldemo_mrv_CONTROLLER_TYPE.m</a> という列挙クラスを使用します。</p><p><tt>VE_PROTOTYPE</tt> と <tt>VE_PRODUCTION</tt> という <tt>Simulink.Variant</tt> オブジェクトは、Filter1、Filter2 および Filter3 という 3 つの Filter Model ブロック間で再利用されます。</p><p>デモ モデル <a href="matlab:open_system('sldemo_mdlref_variants_enum')"><tt>sldemo_mdlref_variants_enum</tt></a> を開くと、<tt>[ファイル] -&gt; [ModelProperties] -&gt; [コールバック]</tt> で定義された <b>PreLoadFcn</b> が実行されます。これにより、ベース ワークスペースに Model ブロックの変数が入力されます。これらの変数は、MATLAB コマンド ウィンドウに表示されます。</p><pre class="codeoutput"> 
VE_NONLINEAR_CONTROLLER =
 
Simulink.Variant
Condition:'E_CTRL==sldemo_mrv_CONTROLLER_TYPE.NONLINEAR'

 
VE_SECOND_ORDER_CONTROLLER =
 
Simulink.Variant
Condition:'E_CTRL==sldemo_mrv_CONTROLLER_TYPE.SECOND_ORDER'


E_CTRL = 

SECOND_ORDER

 
VE_PROTOTYPE =
 
Simulink.Variant
Condition:'E_CURRENT_BUILD==sldemo_mrv_BUILD_TYPE.PROTOTYPE'

 
VE_PRODUCTION =
 
Simulink.Variant
Condition:'E_CURRENT_BUILD==sldemo_mrv_BUILD_TYPE.PRODUCTION'


E_CURRENT_BUILD = 

PRODUCTION

</pre><p class="footer">Copyright 2009 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Model Reference Variants % This demo illustrates model reference variants. A Model block is used to % reference one Simulink(R) model from another Simulink model. A Model block can % have different variants. A _variant_ describes one of N possible modes a Model % block can operate in. Each variant of the Model block references a specific % model with optional model-specific arguments. Only one variant is active for % simulation. You can switch the active variant of a Model block by changing the % values of variables in the base workspace, or by manually overriding variant % selection using the Model block dialog. %  % Copyright 2009 The MathWorks, Inc. % $Revision: 1.1.4.9.2.1 $  $Date: 2010/07/29 21:29:17 $  %% Demo Requirements % During this demo, Simulink and Real-Time Workshop(R) may generate code in a % Simulink project directory created in the current working directory.  If you % do not want to (or cannot) generate files in this directory, you should change % the working directory to a suitable directory.  startdir = pwd; tempdir = tempname; addpath(startdir) mkdir(tempdir) cd(tempdir)   %% Overview of Model Variants % A Model block is used to reference one Simulink model (the _child_ _model_) % from another Simulink model (the _parent_ _model_).  A Model block can have % different variants.  The variants comprise a set of models that have the % potential to be referenced by the Model block. In this example, there are two % models that are potentially referenced by the Model block named Controller. % % Each _variant_ in a Model block is associated with a |Simulink.Variant| object. % |Simulink.Variant| objects are created in the MATLAB(R) base workspace. For example: % % |V_NONLINEAR_CONTROLLER=Simulink.Variant('CTRL=1');| % % where the constructor argument |('CTRL=1')| defines the condition when the % variant is active. In this case, defining: % % |CTRL=1| % % in the base workspace would activate the |V_NONLINEAR_CONTROLLER| variant. The % condition argument can be a _simple_ _expression_ consisting of scalar variables, % enumerations, equality, inequality, &&, ||, and ~.  Parenthesis () can be used % for precedence grouping. % % For a given Model block, one variant is active during simulation. The % _active_ _variant_ is determined by evaluating the variant object conditions % in the MATLAB base workspace. Alternatively, you can instruct the Model block % to use a specific variant by selecting the *Override variant conditions and % use following variant* checkbox. %  %% Specifying Variants for a Model Block % % The model used in this demo requires the following variables be defined % in the MATLAB base workspace: % % |V_NONLINEAR_CONTROLLER=Simulink.Variant('CTRL==1');| % % |V_SECOND_ORDER_CONTROLLER=Simulink.Variant('CTRL==2');| % % |CTRL=1;| % % Opening the demo model <matlab:open_system('sldemo_mdlref_variants') % |sldemo_mdlref_variants|> will run the *PreLoadFcn* defined in |File -> % ModelProperties -> Callbacks|. This will populate the base workspace with the % variables for the Model block named Controller: % open_system('sldemo_mdlref_variants')  %% % *Figure 1:* The demo model, |sldemo_mdlref_variants| % % Right-click the model block Controller and select the menu item % *ModelReference Parameters...* to % <matlab:open_system('sldemo_mdlref_variants/Controller','parameter'); % open the Model block dialog>. % % The dialog specifies two potential variants.  The two variants are in turn % associated with the two |Simulink.Variant| objects |V_NONLINEAR_CONTROLLER| % and |V_SECOND_ORDER_CONTROLLER|, which exist in the base workspace.  These % objects have a property named *Condition*, an expression that evaluates to a % boolean and that determines which variant is active.  The *Condition* is also % shown in the Model block dialog.  In this example, the *Condition*'s of % |V_NONLINEAR_CONTROLLER| and |V_SECOND_ORDER_CONTROLLER| are |CTRL == 1| and % |CTRL == 2|, respectively.  The variable |CTRL| resides in the base workspace, % and may be a standard MATLAB variable or a |Simulink.Parameter|. %  %% Switching Active Variants % % To simulate using the |sldemo_mrv_nonlinear_controller|, define: % % |CTRL=1| % % in the base workspace and then simulate the model. % open_system('sldemo_mdlref_variants/Controller','parameter'); close_system('sldemo_mdlref_variants/Controller') CTRL=1; %#ok (used by sldemo_mdlref_variants) sim sldemo_mdlref_variants; %% % *Figure 2:* Simulation using the |sldemo_mrv_nonlinear_controller| variant % % To simulate using the |sldemo_second_order_controller|, define % % |CTRL=2| % % in the base workspace and then simulate the model. % CTRL=2; %#ok (used by sldemo_mdlref_variants) sim sldemo_mdlref_variants;  %% % *Figure 3:* Simulation using the |sldemo_mrv_second_order_controller| variant %  %% Enumerations and Reuse % The sldemo_mdlref_variants_enum model illustrates |Simulink.Variant| % capabilities: % % 1. *Enumerations:* MATLAB enumeration classes can be used to improve %    readability in the conditions of the variant object. % % 2. *Reuse:* |Simulink.Variant| objects can be reused in different Model blocks. % % This demo requires the following variables be defined in the MATLAB base % workspace: % % |VE_NONLINEAR_CONTROLLER=Simulink.Variant('E_CTRL==sldemo_mrv_CONTROLLER_TYPE.NONLINEAR')| % % |VE_SECOND_ORDER_CONTROLLER=Simulink.Variant('E_CTRL==sldemo_mrv_CONTROLLER_TYPE.SECOND_ORDER')| % % |E_CTRL=sldemo_mrv_CONTROLLER_TYPE.SECOND_ORDER| % % |VE_PROTOTYPE=Simulink.Variant('E_CURRENT_BUILD==sldemo_mrv_BUILD_TYPE.PROTOTYPE')| % % |VE_PRODUCTION=Simulink.Variant('E_CURRENT_BUILD==sldemo_mrv_BUILD_TYPE.PRODUCTION')| % % |E_CURRENT_BUILD=sldemo_mrv_BUILD_TYPE.PRODUCTION| % % In these Simulink.Variant's, we use the enumeration classes, % <matlab:edit('sldemo_mrv_BUILD_TYPE.m'); sldemo_mrv_BUILD_TYPE.m>, and % <matlab:edit('sldemo_mrv_CONTROLLER_TYPE.m'); % sldemo_mrv_CONTROLLER_TYPE.m> within the |Simulink.Variant| *Condition* properties % to improve readability. % % The |VE_PROTOTYPE| and |VE_PRODUCTION| |Simulink.Variant| objects are reused across the % three filter Model blocks, Filter1, Filter2, and Filter3. % % Opening the demo model <matlab:open_system('sldemo_mdlref_variants_enum') % |sldemo_mdlref_variants_enum|> will run the *PreLoadFcn* defined in |File -> % ModelProperties -> Callbacks|. This will populate the base workspace with % variables for the Model blocks, which are displayed in the MATLAB Command % Window:  open_system('sldemo_mdlref_variants_enum')  %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-% % Cleanup % %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-%  % Close models close_system('sldemo_mdlref_variants',0); close_system('sldemo_mrv_nonlinear_controller',0) close_system('sldemo_mrv_second_order_controller',0) close_system('sldemo_mdlref_variants_enum',0); close_system('sldemo_mrv_sig_filter1_production',0); close_system('sldemo_mrv_sig_filter1_prototype',0); close_system('sldemo_mrv_sig_filter2_production',0); close_system('sldemo_mrv_sig_filter2_prototype',0); close_system('sldemo_mrv_sig_filter3_production',0); close_system('sldemo_mrv_sig_filter3_prototype',0);  % Clear variables created by models clear CTRL E_CTRL E_CURRENT_BUILD VE_NONLINEAR_CONTROLLER VE_PRODUCTION  clear VE_PROTOTYPE VE_SECOND_ORDER_CONTROLLER V_NONLINEAR_CONTROLLER clear V_SECOND_ORDER_CONTROLLER tout  % Clear demo MEX files that may have been created when referencing % models with the Simulation Mode parameter set to Accelerated. % This need to be done before attempting to remove the tempdir % which contains the generated MEX files. clear mex  % Remove tempdir and restore path cd(startdir); rmpath(startdir); rmdir(tempdir,'s'); clear startdir tempdir  ##### SOURCE END ##### --></body></html>