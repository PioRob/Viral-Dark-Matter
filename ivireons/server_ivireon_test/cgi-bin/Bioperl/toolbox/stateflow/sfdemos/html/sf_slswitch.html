
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Using Simulink&reg; Functions in Stateflow&reg; to Design Switching Controllers</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-07-08"><meta name="DC.source" content="sf_slswitch.m"><link rel="stylesheet" type="text/css" href="../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left">sf_slswitch.mdl</div><div class="right"><a href="matlab:sf_slswitch">Open this model</a></div></div><div class="content"><h1>Using Simulink&reg; Functions in Stateflow&reg; to Design Switching Controllers</h1><p>This model demonstrates how you can design switching controllers by combining the power of Stateflow and Simulink functions.</p><img vspace="5" hspace="5" src="sf_slswitch_01.png" alt=""> <p>The Stateflow chart <tt>SwitchingController</tt> implements a simple switching controller which switches between three states: <tt>STEADY</tt>, <tt>P</tt> and <tt>PID</tt>. When in <tt>STEADY</tt> state, we produce zero control output. When in <tt>P</tt> or <tt>PID</tt>, we delegate to Simulink function call subsystems in order to compute the required control effort.</p><p>The "Output State Activity" for the state <tt>PID</tt> is checked. Therefore, in addition to the control output <tt>u</tt>, the Stateflow chart also produces a logging output with the same name as the state <tt>PID</tt>.</p><p>The condition for switching from <tt>P</tt> to <tt>PID</tt> is based on the error being low enough <tt>[e &lt; PID_TRESH]</tt>. <tt>PID_TRESH</tt> is a variable defined in the Model Workspace with a value of 0.3.</p><img vspace="5" hspace="5" src="sf_slswitch_02.png" alt=""> <p>The Simulink subsystem <tt>SwitchingController/P.p_control</tt> implements a very simple proportional control with a gain of 3. If we had continued to stay in the state <tt>P</tt>, the steady state gain of the closed-loop system would be 3/4 = 0.75. Therefore, we would get an error of 0.25.</p><img vspace="5" hspace="5" src="sf_slswitch_03.png" alt=""> <p>The Simulink subsystem <tt>SwitchingController/PID.pid_control</tt> implements a simple PID control strategy. The proportional gain is the same as in <tt>P</tt> thereby ensuring a smooth transition in the control effort.</p><img vspace="5" hspace="5" src="sf_slswitch_04.png" alt=""> <p>When we simulate the model, we notice that the steady state error approaches zero.</p><img vspace="5" hspace="5" src="sf_slswitch_05.png" alt=""> <p>In the absence of the PID control, we would have had a steady state error of 0.25. If we change <tt>PID_TRESH</tt> to 0.1, we will <i>never</i> get to <tt>PID</tt>, because the error will never get below 0.25 as long as we are in state <tt>P</tt>.</p><img vspace="5" hspace="5" src="sf_slswitch_06.png" alt=""> <p class="footer">Copyright 2009 The MathWorks, Inc.<br>
          Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!--
##### SOURCE BEGIN #####
%% Using Simulink(R) Functions in Stateflow(R) to Design Switching Controllers
% 
% This model demonstrates how you can design switching controllers by
% combining the power of Stateflow and Simulink functions.

%   Copyright 2009 The MathWorks, Inc.

clear all
close all
bdclose all

model = 'sf_slswitch';

open_system(model);

ws = get_param(model, 'ModelWorkspace');
r = sfroot;
m = r.find('-isa', 'Stateflow.Machine', 'Name', model);
c = m.find('-isa', 'Stateflow.Chart', 'Name', 'SwitchingController');

c.Visible = 0;
% close all scopes
close_system(find_system(gcs, 'BlockType', 'Scope'));

%% 
% The Stateflow chart |SwitchingController| implements a simple switching
% controller which switches between three states: |STEADY|, |P| and |PID|.
% When in |STEADY| state, we produce zero control output. When in |P| or
% |PID|, we delegate to Simulink function call subsystems in order to
% compute the required control effort.
% 
% The "Output State Activity" for the state |PID| is checked. Therefore, in
% addition to the control output |u|, the Stateflow chart also produces a
% logging output with the same name as the state |PID|. 
% 
% The condition for switching from |P| to |PID| is based on the error being
% low enough |[e < PID_TRESH]|. |PID_TRESH| is a variable defined in the
% Model Workspace with a value of 0.3.

c.Visible = 1;
c.editor.ZoomFactor = 1; 

%% 
% The Simulink subsystem |SwitchingController/P.p_control| implements a
% very simple proportional control with a gain of 3. If we had continued to
% stay in the state |P|, the steady state gain of the closed-loop system
% would be 3/4 = 0.75. Therefore, we would get an error of 0.25.

open_system([model '/SwitchingController/P.p_control']);

%% 
% The Simulink subsystem |SwitchingController/PID.pid_control| implements a
% simple PID control strategy. The proportional gain is the same as in |P|
% thereby ensuring a smooth transition in the control effort.

open_system([model '/SwitchingController/PID.pid_control']);

%% 
% When we simulate the model, we notice that the steady state error
% approaches zero.

ws.assignin('PID_TRESH', 0.3);
evalc('sim(model)');
open_system([model '/Scope']);


%% 
close_system([model '/Scope']);
c.Visible = 0;

%% 
% In the absence of the PID control, we would have had a steady state error
% of 0.25. If we change |PID_TRESH| to 0.1, we will _never_ get to |PID|,
% because the error will never get below 0.25 as long as we are in state
% |P|.

s = c.find('-isa', 'Stateflow.State', 'Name', 'PID');
t = c.find('-isa', 'Stateflow.Transition', 'Destination', s);
ws.assignin('PID_TRESH', 0.1);
evalc('sim(model)');
open_system([model '/Scope']);

%% 

bdclose all;
clear all;
close all;

##### SOURCE END #####
--></body></html>