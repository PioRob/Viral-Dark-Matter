
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Building and Estimating Process Models Using System Identification Toolbox&#8482;</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-06-29"><meta name="DC.source" content="iddemopr.m"><link rel="stylesheet" type="text/css" href="../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit iddemopr">Open iddemopr.m in the Editor</a></div><div class="right"><a href="matlab:echodemo iddemopr">Run in the Command Window</a></div></div><div class="content"><h1>Building and Estimating Process Models Using System Identification Toolbox&#8482;</h1><!--introduction--><p>This demo describes how to build simple process models using System Identification Toolbox&#8482;. Techniques for creating these models and estimating their parameters using experimental data is described. The demo requires Simulink&reg;.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Introduction</a></li><li><a href="#2">Representation of Process Models using IDPROC Objects</a></li><li><a href="#3">Creating an IDPROC Object (using a Simulink&reg; Model as Example)</a></li><li><a href="#7">Estimating Parameters of IDPROC Models</a></li><li><a href="#13">Computing Time and Frequency Response of IDPROC Models</a></li><li><a href="#18">Accommodating the Effect of Intersample Behavior in Estimation</a></li><li><a href="#24">Modeling a System Operating in Closed Loop</a></li><li><a href="#33">Fixing Known Parameters During Estimation</a></li><li><a href="#37">Additional Information</a></li></ul></div><h2>Introduction<a name="1"></a></h2><p>This demo illustrates how to build simple process models often used in process industry. Simple, low-order continuous-time transfer functions are usually employed to describe process behavior. Such models are described by IDPROC objects in System Identification Toolbox.</p><p>These models are of the basic type 'Static Gain + Time Constant + Time Delay'. They may be represented as:</p><p><img src="iddemopr_eq79542.png" alt="$$P(s) = K.e^{-T_d*s}.\frac{1 + T_z*s}{(1 +  T_{p1}*s)(1 + T_{p2}*s)} $$"></p><p>or as an integrating process:</p><p><img src="iddemopr_eq30677.png" alt="$$P(s) = K.e^{-T_d*s}.\frac{1 + T_z*s}{s(1 +  T_{p1}*s)(1 + T_{p2}*s)} $$"></p><p>where the user can determine the number of real poles (0, 1, 2 or 3), as well as the presence of a zero in the numerator, the presence of an integrator term (<tt>1/s</tt>) and the presence of a time delay (<tt>Td</tt>). In addition, an underdamped (complex) pair of poles may replace the real poles.</p><h2>Representation of Process Models using IDPROC Objects<a name="2"></a></h2><p>IDPROC objects define process models by using the letters <tt>P</tt> (for process model), <tt>D</tt> (for time delay), <tt>Z</tt> (for a zero) and <tt>I</tt> (for integrator). An integer will denote the number of poles. The models are generated by calling <tt>idproc</tt> with a string identifier using these letters.</p><p>This should be clear from the following examples.</p><pre class="codeinput">idproc(<span class="string">'P1'</span>) <span class="comment">% transfer function with only one pole (no zeros or delay)</span>
idproc(<span class="string">'P2DIZ'</span>) <span class="comment">% model with 2 poles, delay integrator and delay</span>
idproc(<span class="string">'P0ID'</span>) <span class="comment">% model with no poles, but an integrator and a delay</span>
</pre><pre class="codeoutput">Process model with transfer function   
           Kp                          
G(s) = ----------                      
         1+Tp1*s                       
                                       
with  Kp = NaN                         
     Tp1 = NaN                         
                                       
This model was not estimated from data.
                                       
Process model with transfer function        
                 1+Tz*s                     
G(s) = Kp * ------------------- * exp(-Td*s)
            s(1+Tp1*s)(1+Tp2*s)             
                                            
                                            
with   Kp = NaN                             
      Tp1 = NaN                             
      Tp2 = NaN                             
       Td = NaN                             
       Tz = NaN                             
                                            
This model was not estimated from data.     
                                            
Process model with transfer function   
        Kp                             
G(s) = --- * exp(-Td*s)                
        s                              
                                       
with  Kp = NaN                         
      Td = NaN                         
                                       
This model was not estimated from data.
                                       
</pre><h2>Creating an IDPROC Object (using a Simulink&reg; Model as Example)<a name="3"></a></h2><p>Consider the system described by the following SIMULINK model:</p><pre class="codeinput">open_system(<span class="string">'iddempr1'</span>)
set_param(<span class="string">'iddempr1/Random Number'</span>,<span class="string">'seed'</span>,<span class="string">'0'</span>)
</pre><img vspace="5" hspace="5" src="iddemopr_01.png" alt=""> <p>The red part is the system, the blue part is the controller and the reference signal is a swept sinusoid (a chirp signal). The data sampling time is set to 0.5 seconds. As observed, the system is a continuous-time transfer function, and can hence be described using model objects in System Identification Toolbox, such as <tt>idss</tt>, <tt>idpoly</tt> or <tt>idproc</tt>.</p><p>Let us describe the system using <tt>idpoly</tt> and <tt>idproc</tt> objects. Using <tt>idpoly</tt> object, the system may be described as:</p><pre class="codeinput">m0 = idpoly(1,0.1,1,1,[1 0.5],<span class="string">'Ts'</span>,0,<span class="string">'InputDelay'</span>,1.57,<span class="string">'NoiseVariance'</span>,0.01);
</pre><p>The IDPOLY form used above is useful for describing transfer functions of arbitrary orders. Since the system we are considering here is quite simple (one pole and no zeros), and is continuous-time, we may use the simpler IDPROC object to capture its dynamics:</p><pre class="codeinput">m0p = idproc(<span class="string">'p1d'</span>,<span class="string">'Kp'</span>,0.2,<span class="string">'Tp1'</span>,2,<span class="string">'Td'</span>,1.57) <span class="comment">% one pole+delay, with initial values</span>
                                               <span class="comment">% for gain, pole and delay specified.</span>
</pre><pre class="codeoutput">Process model with transfer function   
           Kp                          
G(s) = ---------- * exp(-Td*s)         
         1+Tp1*s                       
                                       
with  Kp = 0.2                         
     Tp1 = 2                           
      Td = 1.57                        
                                       
This model was not estimated from data.
                                       
</pre><h2>Estimating Parameters of IDPROC Models<a name="7"></a></h2><p>Once a system is described by a model object, such as IDPROC, it may be used for estimation of its parameters using measurement data. As an example, we consider the problem of estimation of parameters of the Simulink model's system (red portion) using simulation data. We begin by acquiring data for estimation:</p><pre class="codeinput">sim(<span class="string">'iddempr1'</span>)
dat1e = iddata(y,u,0.5); <span class="comment">% The IDDATA object for storing measurement data</span>
</pre><p>Let us look at the data:</p><pre class="codeinput">plot(dat1e)
</pre><img vspace="5" hspace="5" src="iddemopr_02.png" alt=""> <p>We can estimate the model using <tt>pem</tt>, by providing the same structure information specified to create IDPROC models. For example, the 1-pole+delay model may be estimated by calling <tt>pem</tt> as follows:</p><pre class="codeinput">m1 = pem(dat1e,<span class="string">'p1d'</span>); <span class="comment">% estimation of idproc model using data 'dat1e'.</span>
</pre><pre class="codeoutput">Warning: The 'max' field of the "Td" property has been set to 15 sec (50
samples). 
</pre><pre>The warning about maximum value of delay suggests that it is necessary
to give an upper bound for the delay. That can be done as follows:</pre><pre class="codeinput">m1 = pem(dat1e,<span class="string">'p1d'</span>,<span class="string">'Td'</span>,{<span class="string">'max'</span>,2}); <span class="comment">%set maximum delay to 2 sec.</span>
<span class="comment">%</span>
<span class="comment">% Check the result of estimation:</span>
m1
</pre><pre class="codeoutput">Process model with transfer function                             
           Kp                                                    
G(s) = ---------- * exp(-Td*s)                                   
         1+Tp1*s                                                 
                                                                 
with  Kp = 0.20026                                               
     Tp1 = 1.9721                                                
      Td = 1.5701                                                
                                                                 
Estimated using PEM using SearchMethod = Auto from data set dat1e
Loss function 0.0106352 and FPE 0.0106989                        
                                                                 
</pre><pre>To get information about uncertainties, use</pre><pre class="codeinput">present(m1)
</pre><pre class="codeoutput">Process model with transfer function                                                   
           Kp                                                                          
G(s) = ---------- * exp(-Td*s)                                                         
         1+Tp1*s                                                                       

with  Kp = 0.20026+-0.00076972
     Tp1 = 1.9721+-0.074722
      Td = 1.5701+-0.062115
                                                                                       
Estimated using PEM using SearchMethod = Auto from data set dat1e                      
Loss function 0.0106352 and FPE 0.0106989                                              
Created:       29-Jun-2010 23:35:23                                                    
Last modified: 29-Jun-2010 23:35:25                                                    
                                                                                       
</pre><p>The model parameters, <tt>K</tt>, <tt>Tp1</tt> and <tt>Td</tt> are now shown with one standard deviation uncertainty range.</p><h2>Computing Time and Frequency Response of IDPROC Models<a name="13"></a></h2><p>The model <tt>m1</tt> estimated above is an IDPROC model object to which all of the toolbox's model commands can be applied:</p><pre class="codeinput">step(m1,m0) <span class="comment">%step response of models m1 (estimated) and m0 (actual)</span>
legend(<span class="string">'m1 (estimated parameters)'</span>,<span class="string">'m0 (known parameters)'</span>,<span class="string">'location'</span>,<span class="string">'northwest'</span>)
</pre><img vspace="5" hspace="5" src="iddemopr_03.png" alt=""> <p>Bode response with confidence region corresponding to 5 s.d. may be computed by doing:</p><pre class="codeinput">bode(m1,m0,<span class="string">'sd'</span>,5,<span class="string">'fill'</span>) <span class="comment">% 'fill' option fills the uncertainty region</span>
</pre><img vspace="5" hspace="5" src="iddemopr_04.png" alt=""> <p>Similarly, the measurement data may be compared to the models outputs using <tt>compare</tt> as follows:</p><pre class="codeinput">compare(dat1e,m0,m1)
</pre><img vspace="5" hspace="5" src="iddemopr_05.png" alt=""> <p>Other operations such as <tt>sim</tt>, <tt>impulse</tt>, <tt>c2d</tt> are also available, just as they are for other model objects.</p><pre class="codeinput">bdclose(<span class="string">'iddempr1'</span>)
</pre><h2>Accommodating the Effect of Intersample Behavior in Estimation<a name="18"></a></h2><p>It may be important (at least for slow sampling) to consider the intersample behavior of the input data. To illustrate this, let us study the same system as before, but without the sample-and-hold circuit:</p><pre class="codeinput">open_system(<span class="string">'iddempr5'</span>)
</pre><img vspace="5" hspace="5" src="iddemopr_06.png" alt=""> <p>Simulate this system with the same sampling interval:</p><pre class="codeinput">sim(<span class="string">'iddempr5'</span>)
dat1f = iddata(y,u,0.5); <span class="comment">% The IDDATA object for the simulated data</span>
</pre><p>We estimate an IDPROC model using <tt>data1f</tt>:</p><pre class="codeinput">m2 = pem(dat1f,<span class="string">'p1d'</span>,<span class="string">'Td'</span>,{<span class="string">'max'</span>,2});
m2
</pre><pre class="codeoutput">Process model with transfer function                             
           Kp                                                    
G(s) = ---------- * exp(-Td*s)                                   
         1+Tp1*s                                                 
                                                                 
with  Kp = 0.20038                                               
     Tp1 = 2.0102                                                
      Td = 1.3101                                                
                                                                 
Estimated using PEM using SearchMethod = Auto from data set dat1f
Loss function 0.0106262 and FPE 0.0106899                        
                                                                 
</pre><p>This model has a slightly less precise estimate of the delay than the previous one, m1:</p><pre class="codeinput">[m0p.td.value, m1.td.value, m2.td.value]
step(m0,m1,m2)
legend(<span class="string">'m0 (actual)'</span>,<span class="string">'m1 (estimated with ZOH)'</span>,<span class="string">'m2 (estimated without ZOH)'</span>,<span class="string">'location'</span>,<span class="string">'southeast'</span>)
</pre><pre class="codeoutput">
ans =

    1.5700    1.5701    1.3101

</pre><img vspace="5" hspace="5" src="iddemopr_07.png" alt=""> <p>However, by telling the estimation process that the intersample behavior is first-order-hold (an approximation to the true continuous) input, we do better:</p><pre class="codeinput">dat1f.InterSample = <span class="string">'foh'</span>;
m3 = pem(dat1f,<span class="string">'p1d'</span>,<span class="string">'Td'</span>,{<span class="string">'max'</span>,2})
</pre><pre class="codeoutput">Process model with transfer function                             
           Kp                                                    
G(s) = ---------- * exp(-Td*s)                                   
         1+Tp1*s                                                 
                                                                 
with  Kp = 0.20038                                               
     Tp1 = 2.0084                                                
      Td = 1.5571                                                
                                                                 
Estimated using PEM using SearchMethod = Auto from data set dat1f
Loss function 0.0106368 and FPE 0.0107005                        
                                                                 
</pre><p>Compare the four models m0 (true) m1 (obtained from zoh input) m2 (obtained for continuous input, with zoh assumption) and m3 (obtained for the same input, but with foh assumption)</p><pre class="codeinput">[m0p.td.value, m1.td.value, m2.td.value, m3.td.value]
compare(dat1e,m0,m1,m2,m3)
step(m0,m1,m2,m3)
legend(<span class="string">'m0'</span>,<span class="string">'m1'</span>,<span class="string">'m2'</span>,<span class="string">'m3'</span>)
bdclose(<span class="string">'iddempr5'</span>)
</pre><pre class="codeoutput">
ans =

    1.5700    1.5701    1.3101    1.5571

</pre><img vspace="5" hspace="5" src="iddemopr_08.png" alt=""> <h2>Modeling a System Operating in Closed Loop<a name="24"></a></h2><p>Let us now consider a more complex process, with integration, that is operated in closed loop:</p><pre class="codeinput">open_system(<span class="string">'iddempr2'</span>)
</pre><img vspace="5" hspace="5" src="iddemopr_09.png" alt=""> <p>The true system can be represented by:</p><pre class="codeinput">m0 = idproc(<span class="string">'p2zdi'</span>,<span class="string">'Kp'</span>,1,<span class="string">'Tp1'</span>,1,<span class="string">'Tp2'</span>,5,<span class="string">'Tz'</span>,3,<span class="string">'Td'</span>,2.2);
</pre><p>The process is controlled by a PD regulator with limited input amplitude and a zero order hold device. The sampling interval is 1 second.</p><pre class="codeinput">set_param(<span class="string">'iddempr2/Random Number'</span>,<span class="string">'seed'</span>,<span class="string">'0'</span>)
sim(<span class="string">'iddempr2'</span>)
dat2 = iddata(y,u,1); <span class="comment">% IDDATA object for estimation</span>
</pre><p>Two different simulations are made, the first for estimation and the second one for validation purposes.</p><pre class="codeinput">set_param(<span class="string">'iddempr2/Random Number'</span>,<span class="string">'seed'</span>,<span class="string">'13'</span>)
sim(<span class="string">'iddempr2'</span>)
dat2v = iddata(y,u,1); <span class="comment">% IDDATA object for validation purpose</span>
</pre><p>Let us look at the data (estimation and validation).</p><pre class="codeinput">plot(dat2,dat2v)
legend(<span class="string">'dat2 (estimation)'</span>,<span class="string">'dat2v (validation)'</span>)
</pre><img vspace="5" hspace="5" src="iddemopr_10.png" alt=""> <p>Let us now perform estimation using <tt>dat2</tt>. To estimate the model use:</p><pre class="codeinput">m2 = pem(dat2,<span class="string">'p2zdi'</span>,<span class="string">'td'</span>,{<span class="string">'max'</span>,5},<span class="string">'cov'</span>,<span class="string">'none'</span>)
compare(dat2v,m2,m0) <span class="comment">% Gives very good agreement with data</span>
bode(m2,m0), legend(<span class="string">'m2 (est)'</span>,<span class="string">'m0 (actual)'</span>)
impulse(m2,m0,<span class="string">'plot'</span>), legend(<span class="string">'m2 (est)'</span>,<span class="string">'m0 (actual)'</span>)
</pre><pre class="codeoutput">Process model with transfer function                            
                 1+Tz*s                                         
G(s) = Kp * ------------------- * exp(-Td*s)                    
            s(1+Tp1*s)(1+Tp2*s)                                 
                                                                
                                                                
with   Kp = 1.002                                               
      Tp1 = 5.7793                                              
      Tp2 = 1.2147                                              
       Td = 2.1154                                              
       Tz = 3.7733                                              
                                                                
Estimated using PEM using SearchMethod = Auto from data set dat2
Loss function 0.101909 and FPE 0.103943                         
                                                                
</pre><img vspace="5" hspace="5" src="iddemopr_11.png" alt=""> <p>Compare also with the parameters of the true system:</p><pre class="codeinput">present(m2)
m0
[m0.par m2.par] <span class="comment">% zero estimation is not good, although it does not seem</span>
                <span class="comment">% to affect quality of the response plots</span>
</pre><pre class="codeoutput">Process model with transfer function                            
                 1+Tz*s                                         
G(s) = Kp * ------------------- * exp(-Td*s)                    
            s(1+Tp1*s)(1+Tp2*s)                                 
                                                                
                                                                
with   Kp = 1.002                                               
      Tp1 = 5.7793                                              
      Tp2 = 1.2147                                              
       Td = 2.1154                                              
       Tz = 3.7733                                              
                                                                
Estimated using PEM using SearchMethod = Auto from data set dat2
Loss function 0.101909 and FPE 0.103943                         
Created:       29-Jun-2010 23:35:41                             
Last modified: 29-Jun-2010 23:35:46                             
                                                                
Process model with transfer function        
                 1+Tz*s                     
G(s) = Kp * ------------------- * exp(-Td*s)
            s(1+Tp1*s)(1+Tp2*s)             
                                            
                                            
with   Kp = 1                               
      Tp1 = 1                               
      Tp2 = 5                               
       Td = 2.2                             
       Tz = 3                               
                                            
This model was not estimated from data.     
                                            

ans =

    1.0000    1.0020
    1.0000    5.7793
    5.0000    1.2147
    2.2000    2.1154
    3.0000    3.7733

</pre><p>A word of caution. Identification of several real time constants may sometimes be an ill-conditioned problem, especially if the data are collected in closed loop.</p><p>To illustrate this, let us estimate a model based on the validation data:</p><pre class="codeinput">m2v = pem(dat2v,<span class="string">'p2diz'</span>,<span class="string">'td'</span>,{<span class="string">'max'</span>,5})
</pre><pre class="codeoutput">Process model with transfer function                             
                 1+Tz*s                                          
G(s) = Kp * ------------------- * exp(-Td*s)                     
            s(1+Tp1*s)(1+Tp2*s)                                  
                                                                 
                                                                 
with   Kp = 1.0147                                               
      Tp1 = 61.608                                               
      Tp2 = 3.4229                                               
       Td = 1.6736                                               
       Tz = 60.734                                               
                                                                 
Estimated using PEM using SearchMethod = Auto from data set dat2v
Loss function 0.100105 and FPE 0.102103                          
                                                                 
</pre><p>This model has much worse parameter values. On the other hand, it performs nearly identically to the true system m0 when tested on the other data set dat2:</p><pre class="codeinput">compare(dat2,m0,m2,m2v)
</pre><img vspace="5" hspace="5" src="iddemopr_12.png" alt=""> <h2>Fixing Known Parameters During Estimation<a name="33"></a></h2><p>Suppose we know from other sources that one time constant is 1:</p><pre class="codeinput">m2v.Tp1 = 1;
m2v.Tp1.status=<span class="string">'fix'</span>;
</pre><p>We can fix  this value, while estimating the other parameters by: ('display','full' means full info about the iterations to the screen)</p><pre class="codeinput">m2v = pem(dat2v,m2v,<span class="string">'cov'</span>,<span class="string">'none'</span>,<span class="string">'display'</span>,<span class="string">'full'</span>) <span class="comment">%cov='none' would expedite the estimation</span>
<span class="comment">%</span>
</pre><pre class="codeoutput">--------------------------------------------------------------------------------
Criterion: Determinant minimization
   Scheme: Nonlinear least squares with automatically chosen line search method
--------------------------------------------------------------------------------
Initial Estimate:
   Current cost: 148.272
   Parameters:
   Kp  :         1.015
   Tp1 :             1
   Tp2 :         3.423
   Td  :         1.674
   Tz  :         60.73
 
Iteration 1:
   Current cost: 0.108585   Previous cost: 148.272
   Param         New value       Prev. value    Direction 
   Kp  :         1.005          1.015      -0.009263
   Tp1 :             1              1              0
   Tp2 :         3.392          3.423       -0.03049
   Td  :         1.692          1.674        0.01839
   Tz  :         1.405          60.73         -59.33
   Step-size: 59.3292
   First-order optimality: 249.931
   Expected improvement: 99.9341%
   Achieved improvement: 99.9268%

Iteration 2:
   Current cost: 0.0983852   Previous cost: 0.108585
   Param         New value       Prev. value    Direction 
   Kp  :         1.007          1.005       0.001836
   Tp1 :             1              1              0
   Tp2 :         4.809          3.392          1.417
   Td  :         2.638          1.692         0.9462
   Tz  :         3.202          1.405          1.797
   Step-size: 2.47663
   First-order optimality: 124.879
   Expected improvement: 10.4272%
   Achieved improvement: 9.39332%

Iteration 3:
   Current cost: 0.0972376   Previous cost: 0.0983852
   Param         New value       Prev. value    Direction 
   Kp  :         1.009          1.007       0.001684
   Tp1 :             1              1              0
   Tp2 :         4.616          4.809        -0.1935
   Td  :         2.159          2.638        -0.4792
   Tz  :         2.525          3.202        -0.6772
   Step-size: 0.851898
   First-order optimality: 35.7589
   Expected improvement: 1.30555%
   Achieved improvement: 1.16641%

Iteration 4:
   Current cost: 0.0971525   Previous cost: 0.0972376
   Param         New value       Prev. value    Direction 
   Kp  :          1.01          1.009       0.000761
   Tp1 :             1              1              0
   Tp2 :         5.018          4.616          0.402
   Td  :         2.253          2.159        0.09399
   Tz  :         3.004          2.525         0.4793
   Step-size: 0.632633
   First-order optimality: 8.91676
   Expected improvement: 0.103371%
   Achieved improvement: 0.08753%

Iteration 5:
   Current cost: 0.0971502   Previous cost: 0.0971525
   Param         New value       Prev. value    Direction 
   Kp  :          1.01           1.01     -0.0001706
   Tp1 :             1              1              0
   Tp2 :         4.974          5.018       -0.04419
   Td  :         2.234          2.253       -0.01878
   Tz  :         2.944          3.004       -0.05984
   Step-size: 0.0767257
   First-order optimality: 0.166292
   Expected improvement: 0.00271023%
   Achieved improvement: 0.00234559%

Estimation complete.
Last improvement: 0.00234559
First-order optimality (largest slope): 0.166292
Final cost: 0.0971502
 
Process model with transfer function                             
                 1+Tz*s                                          
G(s) = Kp * ------------------- * exp(-Td*s)                     
            s(1+Tp1*s)(1+Tp2*s)                                  
                                                                 
                                                                 
with   Kp = 1.0095                                               
      Tp1 = 1                                                    
      Tp2 = 4.9737                                               
       Td = 2.2342                                               
       Tz = 2.9445                                               
                                                                 
Estimated using PEM using SearchMethod = Auto from data set dat2v
Loss function 0.0983398 and FPE 0.0999101                        
                                                                 
</pre><p>As observed, fixing <tt>Tp1</tt> to its known value dramatically improves the estimates of the remaining parameters in model <tt>m2v</tt>.</p><p>This also indicates that simple approximation should do well on the data:</p><pre class="codeinput">m1x = pem(dat2v,<span class="string">'p2d'</span>,<span class="string">'Td'</span>,{<span class="string">'max'</span>,2})
compare(dat2,m0,m2,m2v,m1x)
</pre><pre class="codeoutput">Process model with transfer function                             
               Kp                                                
G(s) = ------------------ * exp(-Td*s)                           
        (1+Tp1*s)(1+Tp2*s)                                       
                                                                 
                                                                 
with   Kp = 37452                                                
      Tp1 = 37250                                                
      Tp2 = 3.6172                                               
       Td = 1.5758                                               
                                                                 
Estimated using PEM using SearchMethod = Auto from data set dat2v
Loss function 0.100349 and FPE 0.101951                          
                                                                 
</pre><img vspace="5" hspace="5" src="iddemopr_13.png" alt=""> <p>Thus, the simpler model is able to estimate system output pretty well. However, <tt>m1x</tt> does not contain any integration, so the open loop long time range behavior will be quite different:</p><pre class="codeinput">step(m0,m2,m2v,m1x)
legend(<span class="string">'m0'</span>,<span class="string">'m2'</span>,<span class="string">'m2v'</span>,<span class="string">'m1x'</span>)
bdclose(<span class="string">'iddempr2'</span>)
</pre><img vspace="5" hspace="5" src="iddemopr_14.png" alt=""> <h2>Additional Information<a name="37"></a></h2><p>For more information on identification of dynamic systems with System Identification Toolbox visit the <a href="http://www.mathworks.com/products/sysid/">System Identification Toolbox</a> product information page.</p><p class="footer">Copyright 1986-2009 The MathWorks, Inc.<br>
          Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!--
##### SOURCE BEGIN #####
%% Building and Estimating Process Models Using System Identification Toolbox(TM)
%
% This demo describes how to build simple process models using System
% Identification Toolbox(TM). Techniques for creating these models and
% estimating their parameters using experimental data is described. The
% demo requires Simulink(R).

%  Copyright 1986-2009 The MathWorks, Inc.
%  $Revision: 1.7.4.12 $ $Date: 2009/10/16 04:54:17 $

%% Introduction
% This demo illustrates how to build simple process models often used in
% process industry. Simple, low-order continuous-time transfer functions
% are usually employed to describe process behavior. Such models are
% described by IDPROC objects in System Identification Toolbox.
%
% These models are of the basic type 'Static Gain + Time Constant + Time
% Delay'. They may be represented as:
%                            
% $$P(s) = K.e^{-T_d*s}.\frac{1 + T_z*s}{(1 +  T_{p1}*s)(1 + T_{p2}*s)} $$
%                            
% or as an integrating process:
%
% $$P(s) = K.e^{-T_d*s}.\frac{1 + T_z*s}{s(1 +  T_{p1}*s)(1 + T_{p2}*s)} $$
%                               
% where the user can determine the number of real poles (0, 1, 2 or 3), as
% well as the presence of a zero in the numerator, the presence of an
% integrator term (|1/s|) and the presence of a time delay (|Td|). In
% addition, an underdamped (complex) pair of poles may replace the real
% poles. 

%% Representation of Process Models using IDPROC Objects
% IDPROC objects define process models by using the letters |P| (for
% process model), |D| (for time delay), |Z| (for a zero) and |I| (for
% integrator). An integer will denote the number of poles. The models are
% generated by calling |idproc| with a string identifier using these
% letters.
%
% This should be clear from the following examples.
idproc('P1') % transfer function with only one pole (no zeros or delay)
idproc('P2DIZ') % model with 2 poles, delay integrator and delay
idproc('P0ID') % model with no poles, but an integrator and a delay

%% Creating an IDPROC Object (using a Simulink(R) Model as Example) 
% Consider the system described by the following SIMULINK model:
open_system('iddempr1')
set_param('iddempr1/Random Number','seed','0')
 
%%
% The red part is the system, the blue part is the controller and the
% reference signal is a swept sinusoid (a chirp signal). 
% The data sampling time is set to 0.5 seconds. As observed, the system is
% a continuous-time transfer function, and can hence be described using
% model objects in System Identification Toolbox, such as |idss|,
% |idpoly| or |idproc|.

%%
% Let us describe the system using |idpoly| and |idproc| objects. Using
% |idpoly| object, the system may be described as:
m0 = idpoly(1,0.1,1,1,[1 0.5],'Ts',0,'InputDelay',1.57,'NoiseVariance',0.01);

%%
% The IDPOLY form used above is useful for describing transfer functions of
% arbitrary orders. Since the system we are considering here is quite
% simple (one pole and no zeros), and is continuous-time, we may use the
% simpler IDPROC object to capture its dynamics:
m0p = idproc('p1d','Kp',0.2,'Tp1',2,'Td',1.57) % one pole+delay, with initial values 
                                               % for gain, pole and delay specified.

%% Estimating Parameters of IDPROC Models
% Once a system is described by a model object, such as IDPROC, it may be
% used for estimation of its parameters using measurement data. As an
% example, we consider the problem of estimation of parameters of the
% Simulink model's system (red portion) using simulation data. We begin by
% acquiring data for estimation: 
sim('iddempr1') 
dat1e = iddata(y,u,0.5); % The IDDATA object for storing measurement data

%%
% Let us look at the data:
plot(dat1e)

%%
% We can estimate the model using |pem|, by providing the same structure
% information specified to create IDPROC models. For example, the
% 1-pole+delay model may be estimated by calling |pem| as follows: 
m1 = pem(dat1e,'p1d'); % estimation of idproc model using data 'dat1e'.

%%
%  The warning about maximum value of delay suggests that it is necessary
%  to give an upper bound for the delay. That can be done as follows: 
m1 = pem(dat1e,'p1d','Td',{'max',2}); %set maximum delay to 2 sec.
%
% Check the result of estimation:
m1
%%
%  To get information about uncertainties, use
present(m1)
%%
% The model parameters, |K|, |Tp1| and |Td| are now shown with one standard
% deviation uncertainty range.

%% Computing Time and Frequency Response of IDPROC Models
% The model |m1| estimated above is an IDPROC model object to which all of
% the toolbox's model commands can be applied:

%%
step(m1,m0) %step response of models m1 (estimated) and m0 (actual)
legend('m1 (estimated parameters)','m0 (known parameters)','location','northwest')
%%
% Bode response with confidence region corresponding to 5 s.d. may be
% computed by doing:
bode(m1,m0,'sd',5,'fill') % 'fill' option fills the uncertainty region
%%
% Similarly, the measurement data may be compared to the models outputs
% using |compare| as follows:
compare(dat1e,m0,m1)
%%
% Other operations such as |sim|, |impulse|, |c2d| are also available, just
% as they are for other model objects. 
bdclose('iddempr1')

%% Accommodating the Effect of Intersample Behavior in Estimation
% It may be important (at least for slow sampling) to consider the
% intersample behavior of the input data. To illustrate this, let
% us study the same system as before, but without the sample-and-hold
% circuit: 
%
open_system('iddempr5')

%%
% Simulate this system with the same sampling interval:
sim('iddempr5') 
dat1f = iddata(y,u,0.5); % The IDDATA object for the simulated data
%%
% We estimate an IDPROC model using |data1f|:
m2 = pem(dat1f,'p1d','Td',{'max',2});
m2

%%
% This model has a slightly less precise estimate of the delay than
% the previous one, m1:
[m0p.td.value, m1.td.value, m2.td.value]
step(m0,m1,m2) 
legend('m0 (actual)','m1 (estimated with ZOH)','m2 (estimated without ZOH)','location','southeast')

%%
% However, by telling the estimation process that the intersample
% behavior is first-order-hold (an approximation to the true
% continuous) input, we do better:
dat1f.InterSample = 'foh';
m3 = pem(dat1f,'p1d','Td',{'max',2})

%%
% Compare the four models
% m0 (true) 
% m1 (obtained from zoh input)
% m2 (obtained for continuous input, with zoh assumption) and
% m3 (obtained for the same input, but with foh assumption)

[m0p.td.value, m1.td.value, m2.td.value, m3.td.value]
compare(dat1e,m0,m1,m2,m3)
step(m0,m1,m2,m3)
legend('m0','m1','m2','m3')
bdclose('iddempr5')

%% Modeling a System Operating in Closed Loop
% Let us now consider a more complex process, with integration, that is 
% operated in closed loop:
open_system('iddempr2')

%%
% The true system can be represented by:
m0 = idproc('p2zdi','Kp',1,'Tp1',1,'Tp2',5,'Tz',3,'Td',2.2);
%%
% The process is controlled by a PD regulator with limited input amplitude
% and a zero order hold device. The sampling interval is 1 second.
set_param('iddempr2/Random Number','seed','0')
sim('iddempr2')
dat2 = iddata(y,u,1); % IDDATA object for estimation

%%
% Two different simulations are made, the first for estimation and the
% second one for validation purposes.
%
set_param('iddempr2/Random Number','seed','13')
sim('iddempr2') 
dat2v = iddata(y,u,1); % IDDATA object for validation purpose

%%
% Let us look at the data (estimation and validation).
plot(dat2,dat2v)
legend('dat2 (estimation)','dat2v (validation)')

%%
% Let us now perform estimation using |dat2|. To estimate the model use:
m2 = pem(dat2,'p2zdi','td',{'max',5},'cov','none') 
compare(dat2v,m2,m0) % Gives very good agreement with data
bode(m2,m0), legend('m2 (est)','m0 (actual)')
impulse(m2,m0,'plot'), legend('m2 (est)','m0 (actual)')
%%
% Compare also with the parameters of the true system:
present(m2)
m0   
[m0.par m2.par] % zero estimation is not good, although it does not seem
                % to affect quality of the response plots

%%
% A word of caution. Identification of several real time constants may
% sometimes be an ill-conditioned problem, especially if the data are
% collected in closed loop. 
%
% To illustrate this, let us estimate a model based on the validation data:
%
m2v = pem(dat2v,'p2diz','td',{'max',5})

%%
% This model has much worse parameter values. On the other hand, it
% performs nearly identically to the true system m0 when tested on the
% other data set dat2: 
compare(dat2,m0,m2,m2v)

%% Fixing Known Parameters During Estimation
% Suppose we know from other sources that one time constant is 1:
m2v.Tp1 = 1;
m2v.Tp1.status='fix';

%%
% We can fix  this value, while estimating the other parameters by: 
% ('display','full' means full info about the iterations to the screen)
%
m2v = pem(dat2v,m2v,'cov','none','display','full') %cov='none' would expedite the estimation
%
%% 
% As observed, fixing |Tp1| to its known value dramatically improves the
% estimates of the remaining parameters in model |m2v|. 
%
% This also indicates that simple approximation should do well on the data:
m1x = pem(dat2v,'p2d','Td',{'max',2})
compare(dat2,m0,m2,m2v,m1x)

%%
% Thus, the simpler model is able to estimate system output pretty well.
% However, |m1x| does not contain any integration, so the open loop long 
% time range behavior will be quite different:
%
step(m0,m2,m2v,m1x)
legend('m0','m2','m2v','m1x')
bdclose('iddempr2')

%% Additional Information
% For more information on identification of dynamic systems with System
% Identification Toolbox visit the
% <http://www.mathworks.com/products/sysid/ System Identification Toolbox>
% product information page.

displayEndOfDemoMessage(mfilename)

##### SOURCE END #####
--></body></html>