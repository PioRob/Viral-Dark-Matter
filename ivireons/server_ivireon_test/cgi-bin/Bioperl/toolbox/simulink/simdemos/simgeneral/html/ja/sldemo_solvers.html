
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>スティッフなモデルを使った可変ステップ ソルバーの調査</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="sldemo_solvers.m"><link rel="stylesheet" type="text/css" href="../../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left">sldemo_solvers.mdl</div><div class="right"><a href="matlab:sldemo_solvers">このモデルを開く</a></div></div><div class="content"><h1>スティッフなモデルを使った可変ステップ ソルバーの調査</h1><!--introduction--><p>このデモでは、フーコーの振り子モデルの可変ステップ ソルバーの動作について調べます。Simulink&reg; ソルバー <tt>ode45</tt>、<tt>ode15s</tt>、<tt>ode23</tt>、および <tt>ode23t</tt> がテスト ケースとして使用されます。スティッフな微分方程式が、この問題を解くために使用されます。方程式のスティッフ性の厳密な定義は存在しません。数値法を使用してスティッフな方程式を解く場合、一部の数値法は不安定なため、ステップサイズをかなり小さくしなければ、数値的に安定した解を得ることができません。スティッフな問題には、すぐに変化する要素と、ゆっくりと変化する要素が含まれていることがあります。</p><p>フーコーの振り子は、スティッフな問題の一例です。振り子が 2 ～ 3 秒で振動を終える (すぐに変化する要素) のに対し、地球が 1 回 自転するのには 1 日かかります (ゆっくりと変化する要素)。振り子の振動面は、地球の自転のため、ゆっくりと回転します。フーコーの振り子の物理的作用の詳細は、「フーコーの振り子のモデル化」<a href="matlab:showdemo('sldemo_foucault')">デモ</a>を参照してください。</p><p>シミュレーションにより、地球上の観測者から見た x-y 平面における振り子の振り玉の位置が計算されます。次に、振り子のエネルギーの総量が計算され、さまざまな Simulink ソルバーの性能の評価に使用されます。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">フーコーの振り子モデル</a></li><li><a href="#3">可変ステップ ソルバー</a></li><li><a href="#4">ソルバーの性能の評価</a></li><li><a href="#5">エネルギーの総量の保存</a></li><li><a href="#8">まとめ</a></li></ul></div><h2>フーコーの振り子モデル<a name="1"></a></h2><p>フーコーの振り子は、以下に示す連立微分方程式系で説明されます。摩擦と空気抵抗は考慮されません (考慮しないことで方程式が大幅に単純化されます)。これらの方程式の全微分を、フーコーの振り子の<a href="matlab:showdemo('sldemo_foucault')">デモ</a>で示します。</p><p><img src="../sldemo_solvers_eq81196.png" alt="$$
\ddot{x} = 2\Omega \sin{\lambda} \dot{y} - \frac{g}{L} x
$$"></p><p><img src="../sldemo_solvers_eq79643.png" alt="$$
\ddot{y} = - 2\Omega\sin{\lambda} \dot{x} - \frac{g}{L} y
$$"></p><p><img src="../sldemo_solvers_eq16903.png" alt="$$\Omega = \mbox{ Earth's angular velocity of rotation around its axis}$$"></p><p><img src="../sldemo_solvers_eq73584.png" alt="$$\lambda = \mbox{ geographic latitude}$$"></p><p><img src="../sldemo_solvers_eq91180.png" alt="$$g = \mbox{ acceleration of gravity}$$"></p><p><img src="../sldemo_solvers_eq37375.png" alt="$$x \mbox{ and } y = \mbox{ coordinates of the pendulum bob}$$"></p><p>図 1 に示すモデルは、フーコーの振り子を説明する微分方程式を解くために使用されています。MATLAB&reg; コマンド ウィンドウで <tt>sldemo_solvers</tt> と入力してこのモデルを開きます。フーコーの振り子が 86400 秒にわたってシミュレートされます。制約と初期条件は、モデル ワークスペースに保存されます。</p><img vspace="5" hspace="5" src="../sldemo_solvers_01.png" alt=""> <p><b>図 1:</b> フーコーの振り子モデルの使用によるソルバーの性能の評価</p><h2>可変ステップ ソルバー<a name="3"></a></h2><p>このデモでは、<tt>ode45</tt>、<tt>ode15s</tt>、<tt>ode23</tt>、および <tt>ode23t</tt> 可変ステップ ソルバーの性能を調べます。特定のソルバー、たとえば <tt>ode45</tt> の詳細を参照するには、MATLAB コマンド ウィンドウで <tt>help ode45</tt> と入力します。</p><p><b>表 1:</b> Simulink で使用可能な可変ステップ ソルバーの一覧</p><p><img vspace="5" hspace="5" src="../sldemo_solvers_figure1.png" alt=""> </p><h2>ソルバーの性能の評価<a name="4"></a></h2><p>ソルバーの性能を評価するにはさまざまな方法があります。問題が閉じた形の解を持つ場合は、ソルバーの結果を、期待される理論上の結果と比較できます。特定のソルバーを使用して、モデルのシミュレーションの所要時間をモニターすることもできます。</p><p>残念ながら、フーコーの振り子には厳密な理論解がありません。閉じた形の近似解はありますが、ソルバーの性能の評価には使用できません (フーコーの振り子の<a href="matlab:showdemo('sldemo_foucault')">デモ</a>を参照)。</p><h2>エネルギーの総量の保存<a name="5"></a></h2><p>このデモでは、エネルギー保存の法則を検証することによってソルバーの性能を評価します。摩擦のない環境では、振り子のエネルギーの総量は一定に保たれるはずです。しかし、振り子のエネルギーの計算値は一定ではありません。これは、数値の精度が限られているためです。</p><p>このデモでは、振り子の正規化エネルギーの総量が、タイム ステップごとに計算されます。エネルギーの相対誤差は、シミュレーション中のエネルギーの総量の変化に等しくなります。エネルギーは保存されるため、理想的には、エネルギーの相対誤差はゼロでなければなりません。エネルギーの総量は、位置エネルギーと運動エネルギーの和です。&quot;NormalizeEnergy&quot; ブロックでは、振り子の正規化エネルギーが以下の式で計算されます。</p><p><img src="../sldemo_solvers_eq44465.png" alt="$$ E = \frac{v_x^2 + v_y^2}{2} + g( L - \sqrt{L^2 - x^2 - y^2} ) $$"></p><p><img src="../sldemo_solvers_eq49680.png" alt="$$E_{normalized}(t) = \frac{E(t)}{E(0)}$$"></p><p><img src="../sldemo_solvers_eq34741.png" alt="$$E(0) = \mbox{ initial total energy}$$"></p><img vspace="5" hspace="5" src="../sldemo_solvers_02.png" alt=""> <p><b>図 3:</b> 時間に対する正規化エネルギー</p><p>図 3 は、<tt>ode23</tt> と <tt>ode23t</tt> を使用して計算された、時間に対する正規化エネルギーをプロットしたものです。この問題に関して <tt>ode23t</tt> が <tt>ode23</tt> よりもはるかに正確であることは明らかです。<tt>ode23</tt> を使用したシミュレーションでは、振り子の正規化エネルギーは 60% 以上減少しました。振り子の持つエネルギーが小さいと、振動も小さくなります。この影響は図 4 を見るとわかります。<tt>ode23</tt> で計算された振り子の振幅は、振動面が回転すると小さくなっています。</p><p><img vspace="5" hspace="5" src="../sldemo_solvers_figure2.png" alt=""> </p><p><b>図 4:</b> <tt>ode23</tt> と <tt>ode23t</tt> を使用して計算された振り子の位置</p><p>図 4 は、スティッフ ソルバーとノンスティッフ ソルバーの違いを示しています。各プロットは、1 日のうちの振り子の振り玉の位置を示しています (データ点は 15 番目ごとに青色でプロットされています)。黒い点は振り子の振り玉の初期位置を示し、青い線は振り子の初期振動面を示します。グレーの点は振り子の振り玉の最終位置を示し、グレーの線は 1 日の終わりの振動面を示します。青い線は、中間時点における振動面を示します。振り子の振動面が 1 周するには、1 日では足りません。振動面の回転の速さは、地理緯度によって異なります (フーコーの振り子の<a href="matlab:showdemo('sldemo_foucault')">デモ</a>を参照)。左のプロットでは振り子の振幅は小さくなっているのに対し、右のプロットでは振幅は一定です。相対許容誤差 <tt>RelTol=1e-5</tt> が同じ場合、スティッフ ソルバーの方が結果の精度は高くなりますが、実行時間が長くなります。</p><p>図 5 では、Simulink ソルバーの性能をさらに詳しく調べています。4 つのソルバーを選び、相対許容誤差の関数としての相対誤差とシミュレーションの実行時間の変動を示しています。ソルバーをより広範囲にテストするなら、<tt>sldemo_solvers_mcode.m</tt> スクリプトを使用できます (<a href="matlab:edit('sldemo_solvers_mcode')">このファイル</a>を参照)。このスクリプトを使用すると、シミュレーションをスピードアップする C コードがモデルから生成されます。ただし、このスクリプトの実行には数分かかることがあります。</p><p><img vspace="5" hspace="5" src="../sldemo_solvers_figure3.png" alt=""> </p><p><b>図 5:</b> さまざまなソルバー設定での相対誤差と実行時間</p><p>この例では、相対許容誤差が 1e-6 未満の場合に相対誤差が減少していません。これは、特定のモデルに依存する数値ソルバーの限界です。ソルバーの相対誤差を小さくしたからといって、精度が上がるとは限りません。問題に必要な最低限の精度を推定し、シミュレーション コストが最小限に抑えられるようにソルバーを選択する必要があります。たとえば、フーコーの振り子の振り玉の位置を数センチの範囲内で知りたいとします。その場合は、振り子の位置を数ミクロンの範囲内で計算する必要はありません。そこまで正確に測定することはできないからです。</p><h2>まとめ<a name="8"></a></h2><p>シミュレーションの数値結果は、ソルバーの設定によって異なる場合があります。スティッフな問題の場合、これは非常に重要な意味を持ちます。スティッフなモデルを扱う場合は、最小コストで正確な結果を出すソルバーを選択してください。相対許容誤差 (可変ステップ ソルバー) またはステップ サイズ (固定ステップ ソルバー) は十分に小さくし、数値的に安定した結果が得られるようにする必要があります。ソルバーの中には特に効率的なものもありますが、スティッフな問題により適しているのはスティッフ ソルバーです。可変ステップ ソルバーは、固定ステップ ソルバーよりもロバストです。</p><p class="footer">Copyright 2006-2008 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Exploring Variable-Step Solvers Using a Stiff Model % % This demo explores the behaviour of variable-step solvers in a Foucault % pendulum model. Simulink(R) solvers |ode45|, |ode15s|, |ode23|, and |ode23t| are % used as test cases. Stiff differential equations are used to solve this % problem. There is no exact definition of stiffness for equations.  Some % numerical methods are unstable when used to solve stiff equations and very % small step-sizes are required to obtain a numerically stable solution to a % stiff problem. A stiff problem may have a fast changing component and a slow % changing component. % % Foucault pendulum is an example of a stiff problem. The pendulum completes an % oscillation in a few seconds (fast changing component) whereas the Earth % completes a rotation about its axis in a day (slow changing component). The % oscillation plane of the pendulum slowly rotates because of Earth's axial % rotation. Read more about the physics of a Foucault pendulum in the "Modelling % a Foucault Pendulum" <matlab:showdemo('sldemo_foucault') demo>. % % The simulation calculates the position of the pendulum bob in the x-y plane as % viewed by an observer on the surface of Earth.  The total energy of the % pendulum is then calculated and used to assess the performance of various % Simulink solvers.  % Copyright 2006-2008 The MathWorks, Inc.  %% Foucault Pendulum Model % % The Foucault pendulum is described by the system of coupled differential % equations given below. Friction and air drag are not taken into consideration % (this greatly simplifies the equations). A full derivation of these equations % is given in the Foucault Pendulum <matlab:showdemo('sldemo_foucault') demo>. % % $$ % \ddot{x} = 2\Omega \sin{\lambda} \dot{y} - \frac{g}{L} x % $$ % % $$ % \ddot{y} = - 2\Omega\sin{\lambda} \dot{x} - \frac{g}{L} y % $$ % % $$\Omega = \mbox{ Earth's angular velocity of rotation around its axis}$$ % % $$\lambda = \mbox{ geographic latitude}$$ % % $$g = \mbox{ acceleration of gravity}$$ % % $$x \mbox{ and } y = \mbox{ coordinates of the pendulum bob}$$ % % The model shown in Figure 1 is used to solve the differential equations % describing a Foucault pendulum. Type |sldemo_solvers| in MATLAB(R) Command Window % to open the model. The demo simulates a Foucault pendulum for 86400 % seconds. The constants and initial conditions are saved the model workspace.  open_system('sldemo_solvers');  %% %  % *Figure 1:* Foucault pendulum model used top assess solver performance  %% Variable Step Solvers % % This demo investigates the performance of |ode45|, |ode15s|, |ode23|, and % |ode23t| variable-step solvers. To read more about a particular solver, for % example |ode45|, type |help ode45| in MATLAB Command Window. % % *Table 1:* List of variable-step solvers available in Simulink % % <<../sldemo_solvers_figure1.png>>  %% Assessing Solver Performance % % There a different ways to assess the performance of a solver. If a problem has % a closed form solution, you could compare the solver results with the expected % theoretical result. You could also monitor the time it takes to simulate a % model using a particular solver. % % Unfortunately there is no exact theoretical solution for the Foucault Pendulum % problem. There is an approximate closed form solution, however it cannot be % used to assess solver performance (see the Foucault pendulum % <matlab:showdemo('sldemo_foucault') demo>). %  %% Total Energy Conservation % % This demo assesses solver performance by verifying the energy conservation % law. In a frictionless environment, the total energy of the pendulum must % remain constant. The calculated energy of the pendulum, however, will not % remain constant as a result of limited numeric accuracy. % % This demo calculates the normalized total energy of the pendulum at every % time-step. The relative error in energy equals the change in total energy over % the course of the simulation. Ideally, the relative error in energy must be % zero because energy is conserved. Total energy is the sum of potential and % kinetic energy.  "NormalizeEnergy" block calculates normalized pendulum energy % using the expressions given below. %  % $$ E = \frac{v_x^2 + v_y^2}{2} + g( L - \sqrt{L^2 - x^2 - y^2} ) $$ %  % $$E_{normalized}(t) = \frac{E(t)}{E(0)}$$ % % $$E(0) = \mbox{ initial total energy}$$  % Run the simulation with ode23 and ode23t and compare results H = get_param('sldemo_solvers','Handle'); set(H,'SolverName','ode23','RelTol','1e-5','StopTime','86400'); evalc('sim(''sldemo_solvers'')'); NormEnergy.ode23 = E; set(H,'SolverName','ode23t','RelTol','1e-5','StopTime','86400'); evalc('sim(''sldemo_solvers'')'); NormEnergy.ode23t = E;  figure('Tag','CloseMe','units','pixels','position',[100 100 600 300]); plot(NormEnergy.ode23.time, NormEnergy.ode23.signals.values,...      NormEnergy.ode23t.time, NormEnergy.ode23t.signals.values); axis([0 86400 0 1.1]); legend('ode23','ode23t','Location','SW'); ylabel('Normalized Energy'); xlabel('Time (sec)'); title('Comparing Solver Performance at RelTol=''1e-5''');  %% % % *Figure 3:* Normalized energy versus time % % Figure 3 shows a plot of normalized energy versus time as calculated using % |ode23| and |ode23t|. It is clear that in this particular problem |ode23t| is % much more accurate than |ode23|. In the simulation that used |ode23|, the % normalized pendulum energy decreased by more than 60%. A % pendulum with lower energy has a lower oscillation amplitude. You can see this % effect in Figure 4, where the amplitude of the pendulum calculated by |ode23| % decreases as the oscillation plane rotates. % % <<../sldemo_solvers_figure2.png>> % % *Figure 4:* Pendulum position as calculated using |ode23| and |ode23t| % % Figure 4 illustrates the difference between a stiff and a non-stiff % solver. Each plot shows the position of the pendulum bob throughout a day % (every 15th data point is plotted as a blue point). The black dot marks the % initial position of the pendulum bob and the black line marks the initial % pendulum oscillation plane. The gray dot marks the final position of the % pendulum bob and the gray line indicates the oscillation plane after a % day. The blue line shows the oscillation plane at some intermediate point in % time. Note that the oscillation plane of the pendulum does not complete a full % rotation within a day. How fast the oscillation plane rotates depends on the % geographical latitude (see details in the Foucault pendulum % <matlab:showdemo('sldemo_foucault') demo> ). Observe that the pendulum % amplitude in the left plot decreases whereas the amplitude in the right plot % remains constant. For the same relative tolerance, |RelTol=1e-5|, the stiff % solver gives a more accurate result, but requires more execution time.  close_system('sldemo_solvers',0); close(findobj(0,'Tag','CloseMe')); % close created figures  %% %  % Figure 5 shows a more detailed performance study of Simulink solvers. Four % solvers were chosen to illustrate how relative error and simulation execution % time vary as a function of relative tolerance. You can use the % |sldemo_solvers_mcode.m| script for more extensive solver tests (see % <matlab:edit('sldemo_solvers_mcode') this file>). This script generates C code % from the model to speed up the simulations. Note that the script can take % several minutes to execute. % % <<../sldemo_solvers_figure3.png>> % % *Figure 5:* Relative error and execution time for various solver settings % % Observe that in this example relative error does not decrease for relative % tolerances below 1e-6. This is a numeric solver limitation that depends on the % particular model. Reducing the solver relative tolerance does not necessarily % improve accuracy. You need to estimate the minimal accuracy that is required % for your problem and choose the solver accordingly to minimize simulation % costs. For example you may want to know the position of the Foucault pendulum % bob within a few centimeters.  It is unnecessary to calculate the position of % a pendulum within a few microns because you cannot measure the position that % accurately.  %% Conclusions % % The numeric results of a simulation can behave differently depending on solver % settings. This is crucial in the case of stiff problems. When working with % stiff models, choose a solver that will give an accurate result at a minimal % price. The relative tolerance (variable-step solvers) or step size (fixed-step % solvers) have to be small enough that the result is numerically % stable. Although some solvers are more efficient than others, stiff solvers % are better suited for solving stiff problems. Variable step solvers are more % robust than fixed-step solvers.  ##### SOURCE END ##### --></body></html>