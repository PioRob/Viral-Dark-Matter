
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>AUTOSAR コードの生成</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="rtwdemo_autosar_legacy_script.m"><link rel="stylesheet" type="text/css" href="../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit rtwdemo_autosar_legacy_script">エディターで rtwdemo_autosar_legacy_script.m を開く</a></div><div class="right"><a href="matlab:echodemo rtwdemo_autosar_legacy_script">コマンド ウィンドウで実行</a></div></div><div class="content"><h1>AUTOSAR コードの生成</h1><!--introduction--><p>このデモでは、AUTOSAR 準拠のコードを生成し、Simulink&reg; モデルから AUTOSAR ソフトウェア コンポーネントの記述 XML ファイルをエクスポートする方法を示します。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">モデルの準備</a></li><li><a href="#2">既定の AUTOSAR ポート設定の変更</a></li><li><a href="#3">既定の AUTOSAR ポート設定の変更: AUTOSAR インターフェイスのダイアログの使用</a></li><li><a href="#4">AUTOSAR 準拠コードの生成</a></li><li><a href="#7">ソフトウェアインザループ テストを使用した AUTOSAR コードの検証</a></li><li><a href="#9">詳細情報</a></li></ul></div><h2>モデルの準備<a name="1"></a></h2><p>rtwdemo_autosar_counter デモ モデルを使用して、AUTOSAR 準拠コードの生成に必要な手順を確認できます。</p><div><ol><li>rtwdemo_autosar_counter モデルを開きます。</li><li>[<b></b>ツール] メニューをクリックし、[<b></b>Real-Time Workshop]、[<b></b>オプション] を選択します。</li><li>システム ターゲット ファイルを AUTOSAR ターゲット (<tt>autosar.tlc</tt>) に変更します。</li></ol></div><p>このほか、システム ターゲット ファイルを変更する方法として、次のコマンドを実行することもできます。</p><pre class="codeinput"><span class="comment">% Model defines</span>
modelName = <span class="string">'rtwdemo_autosar_counter'</span>;

<span class="comment">% open the model</span>
open_system( modelName );

<span class="comment">% Programmatically set the system target file to autosar.tlc</span>
set_param( modelName, <span class="string">'SystemTargetFile'</span>, <span class="string">'autosar.tlc'</span> );
</pre><img vspace="5" hspace="5" src="../rtwdemo_autosar_legacy_script_01.png" alt=""> <h2>既定の AUTOSAR ポート設定の変更<a name="2"></a></h2><p>既定の設定では、AUTOSAR のポート名、データ要素名、およびインターフェイス名は Simulink&reg; のポート名と同じです。これらの既定の設定を変更するには、AUTOSAR インターフェイスのダイアログまたはコマンドライン オブジェクトを使用します。</p><h2>既定の AUTOSAR ポート設定の変更: AUTOSAR インターフェイスのダイアログの使用<a name="3"></a></h2><p><a href="matlab:helpview([docroot,'/toolbox/ecoder/helptargets.map'],'autosar_interface_dialog_box')">AUTOSAR インターフェイスのダイアログの概要</a></p><div><ol><li>[<b></b>ツール] メニューをクリックし、[<b></b>Real-Time Workshop]、[<b></b>AUTOSAR コンポーネントとしてモデルを設定] を選択します。</li><li>AUTOSAR インターフェイスのダイアログ ボックスで、[<b></b>既定の設定を取得] をクリックして、モデルのインターフェイス ダイアログを既定値に設定します。</li><li>変更したら、[<b></b>検証] ボタンをクリックして、変更内容が AUTOSAR 識別子の命名規則に従っていることを確認します。</li></ol></div><p>このほか、AUTOSAR ポート設定を変更する方法として、<tt>RTW.AutosarInterface</tt> オブジェクトを使用して既存の設定をプログラムによって変更することもできます。</p><pre class="codeinput"><span class="comment">% Retrieve the RTW.AutosarInterface object</span>
autosarInterface = RTW.getFunctionSpecification( modelName );

autosarInterface.getDefaultConf;
autosarInterface.setIOAutosarPortName( <span class="string">'Output'</span>, <span class="string">'Counter'</span> );
autosarInterface.setIODataAccessMode(  <span class="string">'Output'</span>, <span class="string">'ImplicitSend'</span> );
autosarInterface.setIODataElement(     <span class="string">'Output'</span>, <span class="string">'data'</span> );
autosarInterface.setIOInterfaceName(   <span class="string">'Output'</span>, <span class="string">'genericInterface'</span> );

[success, errmsg] = autosarInterface.runValidation();
<span class="keyword">if</span> ~success
    error(<span class="string">'rtwdemo:AUTOSAR'</span>, errmsg);
<span class="keyword">end</span>
</pre><h2>AUTOSAR 準拠コードの生成<a name="4"></a></h2><p>Ctrl + B キーを押すか、次のコマンドを使用して、モデルから AUTOSAR 準拠コードを生成します。</p><pre class="codeinput">rtwbuild( modelName );
</pre><pre class="codeoutput">### Starting Real-Time Workshop build procedure for model:rtwdemo_autosar_counter
### Generating XML files description for model:rtwdemo_autosar_counter
### Successful completion of Real-Time Workshop code generation for model:rtwdemo_autosar_counter
</pre><p><tt>INC</tt>、<tt>K</tt>、<tt>LIMIT</tt>、<tt>RESET</tt> は、AUTOSAR キャリブレーション パラメーターとして設定されています。これらのパラメーターには、生成されたコード内で AUTOSAR Rte_Calprm 関数シグネチャを使用してアクセスします。</p><p>生成された XML ファイルと C コードを AUTOSAR オーサリング ツールにインポートできます。キャリブレーション パラメーターによって参照されるキャリブレーション インターフェイス (<a href="matlab:web(fullfile(matlabroot,'toolbox','rtw','rtwdemos','CalibrationComponent.arxml'))">CalibrationComponent.arxml</a>) をインポートする必要もあります。</p><h2>ソフトウェアインザループ テストを使用した AUTOSAR コードの検証<a name="7"></a></h2><p>生成されたコードを検証する一般的な方法としては、S-function 内で生成されたコードをラップします。これにより、生成されたコードをシミュレーションで検証できます。AUTOSAR ターゲットでは、AUTOSAR ランタイム環境 (RTE) API 呼び出しを使用してシミュレーション データを送るように、生成された S-function が自動的に設定されます。</p><pre class="codeinput"><span class="comment">% Configure the model for SIL</span>
set_param( modelName, <span class="string">'GenerateErtSFunction'</span>, <span class="string">'on'</span> );
set_param( modelName, <span class="string">'GenCodeOnly'</span>, <span class="string">'off'</span> );
</pre><p>次のコマンドを使用して、SIL ブロックをビルドします。ブロックをビルドしたら、SIL ブロックがオリジナルのモデルと同じデータを生成することを確認するためのテスト ハーネスを作成できます。SIL 検証の詳細は、Real-Time Workshop&reg; Embedded Coder™ ガイド付き紹介デモの「<b></b>リアルタイム コード テスト」を参照してください。</p><pre class="codeinput">rtwbuild( modelName );
</pre><pre class="codeoutput">### Starting Real-Time Workshop build procedure for model:rtwdemo_autosar_counter
### Generating XML files description for model:rtwdemo_autosar_counter
### Successful completion of Real-Time Workshop build procedure for model:rtwdemo_autosar_counter
</pre><img vspace="5" hspace="5" src="../rtwdemo_autosar_legacy_script_02.png" alt=""> <h2>詳細情報<a name="9"></a></h2><p><a href="matlab:helpview(fullfile(docroot,'toolbox','ecoder','helptargets.map'),'ecoder_autosar')">AUTOSAR ターゲットのドキュメンテーション</a></p><p class="footer">Copyright 1990-2008 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% AUTOSAR Code Generation % This demonstration shows you how to generate AUTOSAR-compliant code and export % AUTOSAR software component description XML files from a Simulink(R) model.  %   Copyright 1990-2008 The MathWorks, Inc. %   $Revision: 1.1.4.2.2.1 $  $Date: 2010/07/29 21:28:58 $  %% Prepare the Model % You can use the rtwdemo_autosar_counter demo model to see the steps needed % to generate AUTOSAR-compliant code.  % % # Open the model rtwdemo_autosar_counter. % # Click the *Tools* menu and select: *Real-Time Workshop* > *Options* % # Change the system target file to the AUTOSAR target (|autosar.tlc|). % % An alternative method to change the system target file is to execute the % following commands: %  % Model defines modelName = 'rtwdemo_autosar_counter';  % open the model open_system( modelName );  % Programmatically set the system target file to autosar.tlc set_param( modelName, 'SystemTargetFile', 'autosar.tlc' );  %% Change the Default AUTOSAR Port Settings % By default the AUTOSAR port name, data element name, and interface name % are the same as the Simulink(R) port name. You can change these default % settings by using the AUTOSAR Interface dialog or command-line objects. %  %% Change the Default AUTOSAR Port Settings: Using the AUTOSAR Interface Dialog % <matlab:helpview([docroot,'/toolbox/ecoder/helptargets.map'],'autosar_interface_dialog_box') Overview of the AUTOSAR Interface dialog> % % # Click the *Tools* menu and select: *Real-Time Workshop* > *Configure Model % as AUTOSAR Component*  % # In the AUTOSAR Interface dialog box, click the *Get % Default Configuration* to configure the model interface dialog to the default % values.   % # After making any changes, click the *Validate* button to confirm % that any changes conform to AUTOSAR identifier naming conventions. % % An alternative method to change AUTOSAR port settings is to modify an % existing configuration programmatically using an |RTW.AutosarInterface| % object.  % Retrieve the RTW.AutosarInterface object autosarInterface = RTW.getFunctionSpecification( modelName );  autosarInterface.getDefaultConf;     autosarInterface.setIOAutosarPortName( 'Output', 'Counter' ); autosarInterface.setIODataAccessMode(  'Output', 'ImplicitSend' ); autosarInterface.setIODataElement(     'Output', 'data' ); autosarInterface.setIOInterfaceName(   'Output', 'genericInterface' );  [success, errmsg] = autosarInterface.runValidation(); if ~success     error('rtwdemo:AUTOSAR', errmsg); end   %% Generate AUTOSAR-Compliant Code % Generate AUTOSAR-compliant code from the model by pressing Ctrl-B, or by using % the following command.  rtwbuild( modelName );  %% % |INC|, |K|, |LIMIT|, |RESET| have been configured as AUTOSAR calibration % parameters, which are accessed using the AUTOSAR Rte_Calprm function signature % in the generated code.  %% % You can import the resulting generated XML files and C code into an AUTOSAR % authoring tool. You will also need to import the calibration interface % referenced by the calibration parameters % (<matlab:web(fullfile(matlabroot,'toolbox','rtw','rtwdemos','CalibrationComponent.arxml')) % CalibrationComponent.arxml>). %  %% Verify the AUTOSAR Code Using Software-in-the-Loop Testing % A common technique to verify the generated code is to wrap the generated % code in an S-function. This allows you to verify the generated code in % simulation. The AUTOSAR target automatically configures the generated % S-function to route simulation data using AUTOSAR run-time % environment (RTE) API calls.  % Configure the model for SIL set_param( modelName, 'GenerateErtSFunction', 'on' ); set_param( modelName, 'GenCodeOnly', 'off' );  %% % Use the following command to build the SIL block. Once the block has been % built, you can create a test harness to verify that the SIL block produces the % same data as the original model.  You can view more information about SIL % verification in the *Testing Real-Time Code* section of the Real-Time % Workshop(R) Embedded Coder(TM) guided introductions demonstration. %  rtwbuild( modelName );  %% Further Information % % <matlab:helpview(fullfile(docroot,'toolbox','ecoder','helptargets.map'),'ecoder_autosar') AUTOSAR Target documentation>  displayEndOfDemoMessage(mfilename)  ##### SOURCE END ##### --></body></html>