
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>信号のマージ</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-06-02"><meta name="DC.source" content="mergedemo.m"><link rel="stylesheet" type="text/css" href="../../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left">mergedemo.mdl</div><div class="right"><a href="matlab:mergedemo">このモデルを開く</a></div></div><div class="content"><h1>信号のマージ</h1><!--introduction--><p>この対話型のデモでは、次の Simulink&reg; の概念を紹介します。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">モデルの説明</a></li><li><a href="#24">条件付きで実行される Subsystem</a></li><li><a href="#31">Logical Operator ブロック</a></li><li><a href="#37">Simulink&reg; での論理信号</a></li><li><a href="#41">Merge ブロックおよび交互に有効になる Subsystem</a></li><li><a href="#48">興味深い機能:ブロックの背景色のプログラム的な変更</a></li></ul></div><h2>モデルの説明<a name="1"></a></h2><img vspace="5" hspace="5" src="../mergedemo_01.png" alt=""> <p>このモデルの左側には、Simulink Sources ライブラリからのブロック (たとえば Repeating Sequence ブロックなど) が 2 つ含まれています。各ブロックは、そのブロックのアイコンに表示されている形式のスカラー出力信号を生成します。</p><img vspace="5" hspace="5" src="../mergedemo_02.png" alt=""> <p>この 2 つの信号は、異なる Enabled Subsystem に入力されます。これらの Subsystem は太線で縁取られています。</p><img vspace="5" hspace="5" src="../mergedemo_03.png" alt=""> <p>これらの Enabled Subsystem (つまり、条件付きで実行される Subsystem) は、Discrete Pulse Generator ブロックが生成する信号によって制御されます。</p><img vspace="5" hspace="5" src="../mergedemo_04.png" alt=""> <p>このブロックの出力は、5 秒ごとに交互に値 0 と値 1 に切り替わります。Discrete Pulse Generator ブロックの出力が正のときは、上の Enabled Subsystem がシミュレーションを実行しています。Discrete Pulse Generator ブロックの出力が 0 のときは、下の Enabled Subsystem がシミュレーションを実行しています。</p><p>Discrete Pulse Generator ブロックの出力が 0 のときに下の Enabled Subsystem にシミュレーションを実行させるために、出力は NOT 演算子に設定された Logical Operator ブロックを通されます。NOT ブロックは、入力が 0 のときに値 1 を出力します。</p><img vspace="5" hspace="5" src="../mergedemo_05.png" alt=""> <p>この 2 つの Enabled Subsystem の出力は、Merge ブロックに入力されます。</p><img vspace="5" hspace="5" src="../mergedemo_06.png" alt=""> <p>最終的に、Merge ブロックの出力が Simulink Scope に表示されます。</p><img vspace="5" hspace="5" src="../mergedemo_07.png" alt=""> <p>シミュレーションを実行して、Scope で Merge ブロックの出力を確認できます。Scope に表示される波形のタイプが 5 秒ごとに変化することを確認してください。これは、Merge ブロックの動作によるものです。</p><img vspace="5" hspace="5" src="../mergedemo_08.png" alt=""> <h2>条件付きで実行される Subsystem<a name="24"></a></h2><p>Merge ブロックのデモには、条件付きで実行される Subsystem が 2 つ含まれています。</p><img vspace="5" hspace="5" src="../mergedemo_09.png" alt=""> <p>条件付きで実行される Subsystem とは、シミュレーション中の特定の時期にのみ、つまり、特定の条件が満たされた場合にのみ実行される Subsystem のことです。この場合、条件付きで実行される Subsystem は Enabled Subsystem です。これらの Subsystem は、以下に示すように、それぞれのアイコンと、ブロックの上部または下部に表示される追加の入力端子によって識別できます。</p><img vspace="5" hspace="5" src="../mergedemo_10.png" alt=""> <p>追加の端子に入る信号は、制御信号と呼ばれます。この信号の値によって、その Subsystem が任意のタイム ステップで実行されるかどうかを決定する条件が与えられます。Enabled Subsystem は、制御信号が厳密に正であるときに実行されます。</p><p>このデモでは、制御信号が正のときに 1 方の Enabled Subsystem を実行し、制御信号が 0 のときにもう一方の Enabled Subsystem を実行する必要があります。これは、Simulink の Logical Operator ブロックを使用して実行することができます。</p><h2>Logical Operator ブロック<a name="31"></a></h2><p>Simulink の Logical Operator ブロックを使用すると、Simulink ブロック線図に論理演算子と論理信号を組み込むことができます。</p><img vspace="5" hspace="5" src="../mergedemo_11.png" alt=""> <p>Logical Operator ブロックを開いて、ドロップダウン メニューに示されるさまざまな演算子を確認できます。NOT の現在の設定では、入力信号が非ゼロのときは 1 (TRUE) が返され、入力信号が厳密にゼロのときは 0 (FALSE) が返されます。</p><p>この例では、この機能を使用して、制御信号がゼロになったときに正の値を生成できます。そのためには、NOT の現在の演算子設定をそのまま維持して、ダイアログ ボックスを閉じます。</p><p><b>メモ:</b>各信号のデータ型は、Simulink ブロック線図の <b>[書式] &gt; [端子/信号の表示]</b> メニューの <b>[端子のデータ型]</b> をオンにすると表示できます。</p><img vspace="5" hspace="5" src="../mergedemo_12.png" alt=""> <h2>Simulink&reg; での論理信号<a name="37"></a></h2><p>次の手順に従って、Simulink が Logical Operator ブロックの入出力に論理値または倍精度値を使用するようにすることもできます。</p><p>1. <b>[シミュレーション]</b> メニューから <b>[コンフィギュレーション パラメーター]</b> を選択して、[コンフィギュレーション パラメーター] ダイアログ ボックスを開きます。</p><p>2. [コンフィギュレーション パラメーター] ダイアログの [最適化] ページに移動します。</p><p>3. <b>[論理信号を論理データ (対倍精度) として実装]</b> パラメーターが有効になっていることを確認します。この最適化によって、論理データ型をサポートするブロックにデータ型が倍精度の信号を入出力できるようにするかどうかを Simulink に示します。</p><p>4. <b>[コンフィギュレーション パラメーター] ダイアログ</b> で <b>[OK]</b> をクリックします。</p><p>Data Type Conversion ブロックを Discrete Pulse Generator ブロックの後ろに配置することにより、Logical Operator ブロックに論理入力信号が必要であることを示すエラーを回避します。</p><img vspace="5" hspace="5" src="../mergedemo_13.png" alt=""> <h2>Merge ブロックおよび交互に有効になる Subsystem<a name="41"></a></h2><p>Merge ブロックを使用して、現在実行されている方の Enabled Subsystem の出力と等しい値を持つ単一の信号を作成できます。以下の手順を実行します。</p><img vspace="5" hspace="5" src="../mergedemo_14.png" alt=""> <p>1. Merge ブロックをダブルクリックして、このブロックの [ブロック パラメーター] ダイアログを開きます。</p><p>2. マージ対象の出力を持つ Enabled Subsystem の数として <b>[入力数]</b> を指定します。この場合、*[入力数] * は 2 に設定する必要があります。</p><p>3. Merge ブロックが初期出力を入力信号のいずれかの初期値に設定することを指定するため、<b>[初期出力] フィールド</b>は空のままにします。この場合、出力は、シミュレーションの開始時に有効になっている Subsystem の初期値になります。</p><p>4. Merge ブロックの [ブロック パラメーター] ダイアログを閉じます。</p><p>5. 条件付きで実行される 2 つの Subsystem の出力を Merge ブロックの入力に接続します。</p><img vspace="5" hspace="5" src="../mergedemo_15.png" alt=""> <p>シミュレーションを実行すると、これまでどおり、Merge ブロックの出力は、条件付きで実行される 2 つの Subsystem のうち、その時点で実行されている方の Subsystem の値となります。</p><img vspace="5" hspace="5" src="../mergedemo_16.png" alt=""> <h2>興味深い機能:ブロックの背景色のプログラム的な変更<a name="48"></a></h2><p>シミュレーションを実行したときに、条件付きで実行される Subsystem のうち、現在実行されている方の色が変化したことに気付いたはずです。これは、条件付きで実行される Subsystem のすべてに対して自動的に行われることでは<b>ありません</b>。これは、S-function と MATLAB&reg; コードを使用して行われたことです。</p><p>Simulink ブロック線図内のブロックをダブルクリックして Enabled Subsystem のいずれかを開くと、その Enabled Subsystem には、次のブロックが含まれています。 </p><p>1. Enable ブロック。このブロックは、これを条件付きで実行される Subsystem にして、制御信号の入力端子を追加するものです。</p><img vspace="5" hspace="5" src="../mergedemo_17.png" alt=""> <p>2. Level-2 MATLAB-file S-function ブロック。このブロックは、MATLAB ファイル S-function である <a href="matlab:edit('mergefcn.m')">mergefcn.m</a> を実行します。</p><img vspace="5" hspace="5" src="../mergedemo_18.png" alt=""> <p>各タイム ステップで、S-function のサブ関数 mdlUpdate が実行されます。このサブ関数は次のコマンドを使用して、Subsystem が現在実行されているかどうかに基づいて、Subsystem の BackgroundColor プロパティを設定します。</p><p><a href="matlab:open_system('mergedemo');set_param('mergedemo/Subsystem','BackgroundColor','green')">set_param('mergedemo/Subsystem','BackgroundColor','green')</a></p><p>MATLAB ファイル S-function の記述方法の詳細は、ドキュメンテーションを参照してください。</p><p class="footer">Copyright 2005-2010 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Merging Signals %  % This interactive demonstration introduces you to the following Simulink(R) % concepts. %  % Copyright 2005-2010 The MathWorks, Inc.  %% Model Description %  open_system('mergedemo');  %% close_system('mergedemo',0);   %% % The left side of this model contains two blocks, for example the % Repeating Sequence block, from the Simulink Sources library.  Each block  % generates a scalar output signal of the form displayed on the block's % icon.   %% open_system('mergedemo') hilite_system(['mergedemo/Repeating',char(10),'Sequence'],'find')  %% close_system('mergedemo',0);  %% % These two signals are fed into different Enabled Subsystems, % which are outlined with thick lines.   %% open_system('mergedemo') hilite_system('mergedemo/Subsystem','find') hilite_system('mergedemo/Subsystem1','find')  %% close_system('mergedemo',0);  %% % The enabled (or conditionally executed) subsystems are controlled by the % signal generated by a Discrete Pulse Generator block.    %% open_system('mergedemo') hilite_system(['mergedemo/Discrete',char(32),'Pulse',char(10),'Generator'],'find')  %% close_system('mergedemo',0);  %% % This block's output toggles between the values of zero % and one every five seconds. When the output of the Discrete Pulse % Generator block is positive, the top enabled subsystem is simulating. % When the output of the Discrete Pulse Generator block is zero, the bottom % enabled subsystem is simulating.   %% % To force the bottom enabled subsystem to % simulate when the Discrete Pulse Generator block's output is zero, the % output is passed through a Logical Operator block set to the NOT % operator. The NOT block outputs a value of one when its input is zero.  %% open_system('mergedemo') hilite_system(['mergedemo/Logical',char(10),'Operator'],'find')  %% close_system('mergedemo',0);  %% % The outputs of the two enabled subsystems are fed into a Merge block.   %% open_system('mergedemo') hilite_system('mergedemo/Merge','find')  %% close_system('mergedemo',0);  %% % The output of the Merge block is, finally, displayed on a Simulink Scope.  %% open_system('mergedemo') hilite_system('mergedemo/Scope','find')  %% % You can run the simulation to see the output of the Merge block on the % Scope. Notice that the type of waveform shown on the Scope changes every % five seconds. This is due to the behavior of the Merge block.   %% open_system('mergedemo/Scope') sim('mergedemo')  %% close_system('mergedemo',0);  %% Conditionally Executed Subsystems % % The Merge block demonstration contains two conditionally executed subsystems.  %% open_system('mergedemo') hilite_system('mergedemo/Subsystem','find') hilite_system('mergedemo/Subsystem1','find')  %% close_system('mergedemo',0);  %% % A conditionally executed subsystem is a subsystem that is % only executed at particular times during the simulation, i.e., when % certain conditions are met. In this case, the subsystems are enabled % subsystems, distinguished by their icons and the additional input port on % the top or bottom of the block, as shown below.  %% open_system('enabledsubsystem');  %% close_system('enabledsubsystem');  %%  % The signal feeding into the additional port is called the control signal. % The value of this signal provides the condition that determines whether % the subsystem is executed, or not, at any given time step. Enabled % subsystems are executed when the control signal is strictly positive. % % In this demonstration, you want to execute one of the enabled subsystems % when the control signal is positive, and the other when the control % signal is zero. You can do this by using the Logical Operator block in % Simulink.  %% Logical Operator Block % % The Logical Operator block in Simulink gives you a method for % incorporating logical operators and boolean signals into your Simulink % diagram.   %% open_system('mergedemo') hilite_system(['mergedemo/Logical',char(10),'Operator'],'find')  %% close_system('mergedemo',0);  %% % You can open the Logical Operator block to see the different % operators that are listed in the drop down menu. The current setting of % NOT returns 1 (or TRUE) when the input signal is non-zero, or 0 (FALSE) % when the input signal is strictly zero. % % In this example, you can use this feature to generate a positive value % when the control signal goes to zero by maintaining the current operator % setting of NOT and closing the dialog.  % % *Note:* You can display the data type of each signal by checking the % *Port Data Types* command in the Simulink diagram's *Format > Port/Signal % Displays* menu.   %% open_system('mergedemo') set_param('mergedemo','ShowPortDataTypes','on') set_param('mergedemo','SimulationCommand','update');          %% close_system('mergedemo',0);  %% Boolean Signals in Simulink(R) % % You have the option to have Simulink to use boolean or double values for % the inputs and outputs of the Logical Operator block, using the following % steps. % % 1. Open the Configuration Parameters dialog box by choosing the % *Configuration parameters* command from the *Simulation* menu.  % % % 2. Go to the Optimization page in the Configuration Parameters dialog. % % 3. See that the *Implement logic signals as boolean data (vs. % double)* parameter has been enabled. This optimization tells Simulink % whether or not it should allow a signal whose data type is double to be % passed into and out of blocks that support the boolean data type. % % 4. Click the *OK* button on the *Configuration Parameters dialog*. %  %% % By having the Data Type Conversion block after the Discrete Pulse % Generator block, you avoid an error indicating that the Logical Operator % block expects a boolean input signal.   %% open_system('mergedemo') hilite_system('mergedemo/Data Type Conversion','find')  %% close_system('mergedemo',0);   %% The Merge Block and Alternately Enabling Subsystems % % You can use the Merge block to create a single signal whose % value is equal to the output of whichever enabled subsystem is % currently executing. The following steps.  open_system('mergedemo') hilite_system('mergedemo/Merge','find')  %% close_system('mergedemo',0);   %% % 1. Open the Merge block's Block Parameter dialog by double clicking on % the block.  % % 2. Specify the *Number of inputs* as the number of enabled subsystems % whose outputs you want to merge. In this case you want to set the *Number % of inputs *to be 2. % % 3. Leave the *Initial output field* empty to specify that the Merge block % sets its initial output to the initial value of one of its input signals. % In this case, the output will be the initial value of the subsystem that % is enabled when the simulation starts.  % % 4. Close the Merge block's Block Parameter dialog.  % % 5. Connect the output of the two conditionally executed subsystems % to the inputs of the Merge block.  %% open_system('mergedemo') set_param('mergedemo/Merge','Inputs','2'); set_param('mergedemo/Merge','InitialOutput','[]'); PH=get_param({'mergedemo/Subsystem';'mergedemo/Subsystem1'},'PortHandles'); PH=[PH{:}]; Outs=[PH.Outport]; hilite_system(Outs);  %% hilite_system(Outs,'none');  %% % As before, when you run the simulation, the output of the Merge block is % the value of whatever conditionally executed subsystem is executing at any % point in time.  %% open_system('mergedemo/Scope') sim('mergedemo')  %% Interesting Feature: Programmatically Changing a Block's Background Color % %  % When you ran the simulation, you should have noticed that the % color of the currently executing conditionally executing % subsystems changed. This does *not* happen automatically % for all conditionally executing subsystems. It was achieved using % an S-function and MATLAB(R) code! %  % If you open one of the enabled subsystems by double clicking on the block % in the Simulink diagram, you'll see it contains the following.  %% % 1. An Enable block, which is what makes this a conditionally executed % subsystem and adds the input port for the control signal open_system('mergedemo'); hilite_system('mergedemo/Subsystem/Enable','find')  %% close_system('mergedemo/Subsystem',0);  %% % 2. A Level-2 MATLAB-file S-function block, which runs the MATLAB file S-function % <matlab:edit('mergefcn.m') mergefcn.m> open_system('mergedemo/Subsystem'); hilite_system('mergedemo/Subsystem/Enable','none') hilite_system(['mergedemo/Subsystem/Level-2 MATLAB-file' char(10) 'S-Function'],'find')  %% % At each time step, the S-function's mdlUpdate subfunction % executes. It sets the BackgroundColor property of the Subsystems % based on whether it is currently executing, or not, with the % following command.  %% % <matlab:open_system('mergedemo');set_param('mergedemo/Subsystem','BackgroundColor','green') set_param('mergedemo/Subsystem','BackgroundColor','green')>   %% % For more information on how to write MATLAB file S-functions, see % the documentation. %  %% close_system('mergedemo',0);     ##### SOURCE END ##### --></body></html>