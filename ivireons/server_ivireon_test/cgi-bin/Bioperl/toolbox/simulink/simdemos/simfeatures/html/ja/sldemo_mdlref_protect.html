
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>モデル参照の保護モデル</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="sldemo_mdlref_protect.m"><link rel="stylesheet" type="text/css" href="../../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"></div><div class="right">&nbsp;</div></div><div class="content"><h1>モデル参照の保護モデル</h1><!--introduction--><p>このデモでは、モデル参照の保護モデルの作成方法と使用方法を説明します。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">デモの要件</a></li><li><a href="#2">デモ モデルを開く</a></li><li><a href="#4">参照されるモデルの保護</a></li><li><a href="#5">保護モデルに必要な変数の特定</a></li><li><a href="#6">保護モデルの使用</a></li></ul></div><h2>デモの要件<a name="1"></a></h2><p>モデル参照の保護モデルを生成する前に、Real-Time Workshop&reg; をインストールする必要があります。このデモの間、Simulink&reg; と Real-Time Workshop は、現在の作業ディレクトリに作成される Simulink プロジェクト ディレクトリにコードを生成する可能性があります。このディレクトリにファイルを生成したくない場合 (あるいは生成できない場合) は、まず、適切なディレクトリに変更してください。</p><h2>デモ モデルを開く<a name="2"></a></h2><p>デモ モデル <a href="matlab:open_system('sldemo_mdlref_bus')"><tt>sldemo_mdlref_bus</tt></a> を開きます。</p><img vspace="5" hspace="5" src="../sldemo_mdlref_protect_01.png" alt=""> <p><b>図 1:</b> デモ モデル <tt>sldemo_mdlref_bus</tt></p><h2>参照されるモデルの保護<a name="4"></a></h2><p>このモデルには、<tt>CounterA</tt> という 1 つの Model ブロックが含まれています。このブロックに参照されるモデルを保護するには、次のコマンドのいずれかを使用します。</p><p><tt>[harnessHandle, neededVars] = Simulink.ModelReference.protect('sldemo_mdlref_counter_bus', 'Harness', true)</tt></p><p>または</p><p><tt>[harnessHandle, neededVars] = Simulink.ModelReference.protect('sldemo_mdlref_bus/CounterA', 'Harness', true)</tt></p><p>このコマンドによって、保護モデル <tt>sldemo_mdlref_counter_bus.mdlp</tt> が作成されます。このモデルは、ノーマル モードのシミュレーションで、元のモデル ファイルなしで使用できます。<tt>[Harness]</tt> パラメーターを指定すると、Simulink は、保護モデルを参照する Model ブロックが含まれたモデルであるハーネス モデル<i></i>を作成します。ハーネス モデルに対するハンドルは、関数 <tt>protect</tt> によって、最初の出力として返されます。</p><h2>保護モデルに必要な変数の特定<a name="5"></a></h2><p>保護モデルを実行するには、ベース ワークスペースで保護モデルにいくつかの変数を定義する必要があります。たとえば、保護モデル <tt>sldemo_mdlref_counter_bus.mdlp</tt> には、モデルのルート入力端子および出力端子でバスを指定するベース ワークスペース変数が必要です。</p><p>保護モデルを出荷する際は、必要な変数の定義を含める必要があります。そうしなければ、そのモデルは使用不能になります。関数 <tt>protect</tt> の 2 つ目の出力である <tt>neededVars</tt> は、どのベース ワークスペース変数を送信する必要があるのかを特定するのに役立ちます。<tt>neededVars</tt> の値は、保護モデルに必要なベース ワークスペース変数の名前を含むセル配列です。ただし、このセル配列には、そのモデルに必要のないワークスペース変数の名前も含まれている場合があります。</p><p>保護モデルを出荷する前に、<tt>neededVars</tt> を編集して、そのモデルに必要のない変数の名前を削除してください。その後、次のように、必要なワークスペース変数を MAT ファイルに保存できます。</p><p><tt>save('sldemo_mdlref_bus_vars', neededVars{:});</tt></p><h2>保護モデルの使用<a name="6"></a></h2><p>保護モデルを使用するには、Model ブロックの ModelName パラメーターをその保護モデル ファイルの名前に設定します。これは、Model ブロックの [パラメーター] ダイアログを使用するか、次のような <tt>set_param</tt> を使用して実行できます。</p><p><tt>set_param('sldemo_mdlref_bus/CounterA', 'ModelName', 'sldemo_mdlref_counter_bus.mdlp')</tt></p><p>Model ブロックのアイコンは、このブロックが保護モデルを参照すると、ロックを表示するように変化します。</p><img vspace="5" hspace="5" src="../sldemo_mdlref_protect_02.png" alt=""> <p><b>図 2:</b> 保護モデルの参照</p><p class="footer">Copyright 2009 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Model Reference Protected Models % This demo shows you how to create and use Model Reference Protected Models.  % Copyright 2009 The MathWorks, Inc. % $Revision: 1.1.4.9.2.1 $  $Date: 2010/07/29 21:29:17 $  %% Demo Requirements % Real-Time Workshop(R) must be installed before you can generate Model % Reference Protected Models.  During this demo, Simulink(R) and Real-Time % Workshop may generate code in a Simulink project directory created in the % current working directory.  If you do not want to (or cannot) generate files % in this directory, you should first change to a suitable directory.  origval = slfeature('ModelReferenceProtectedModelSupport', 1); origdir = pwd; newdir  = tempname; c1 = onCleanup(@() sldemo_mdlref_util('sldemo_mdlref_protect', 'cleanup', origdir, newdir));  addpath(origdir); mkdir(newdir); cd(newdir);   %% Open the Demo Model % Open the demo model <matlab:open_system('sldemo_mdlref_bus') % |sldemo_mdlref_bus|>: open_system('sldemo_mdlref_bus') %%  % *Figure 1:* The demo model, |sldemo_mdlref_bus|  %% Protect the Referenced Model % This model contains one Model block, |CounterA|.  To protect the model % referenced by this block, use either of the following commands: % % |[harnessHandle, neededVars] = Simulink.ModelReference.protect('sldemo_mdlref_counter_bus', 'Harness', true)| % % or % % |[harnessHandle, neededVars] = Simulink.ModelReference.protect('sldemo_mdlref_bus/CounterA', 'Harness', true)| % % This command creates a Protected Model, |sldemo_mdlref_counter_bus.mdlp|, % which can be used in Normal mode simulation without requiring the original % model file.  Specifying the |'Harness'| parameter causes Simulink to create a % _harness model_, a model that contains a Model block that references the % Protected Model.  A handle to the harness model is returned as the first % output by the |protect| function. cmd = 'Simulink.ModelReference.protect(''sldemo_mdlref_bus/CounterA'', ''Harness'', true)'; [~, harnessHandle, neededVars] = evalc(cmd); set_param('sldemo_mdlref_bus/CounterA', 'ModelName', 'sldemo_mdlref_counter_bus.mdlp'); save_system('sldemo_mdlref_bus', './sldemo_mdlref_bus.mdl');  % Close the harness model, since there is no need to show it. close_system(harnessHandle, 0);  %% Determining the Variables Needed by a Protected Model % In order to run, a Protected Model may need some variables to be defined in % the base workspace.  For example, the Protected Model % |sldemo_mdlref_counter_bus.mdlp| needs the base workspace variables that % specify the buses at the root input and output ports of the model.   % % You must include definitions of the necessary variables when you ship a % Protected Model, or the model will be unusable. The second output of the % |protect| function, |neededVars|, can help you determine which base workspace % variables you must send.  The value of |neededVars| is a cell array that % contains the names of the base workspace variables that the Protected Model % needs.  The cell array, however, may also contain the names of some workspace % variables that the model does not need.   % % Before you ship a Protected Model, edit |neededVars| and delete the names of % any variables that the model does not need.  You can then save the needed % workspace variables into a MAT file as follows: % % |save('sldemo_mdlref_bus_vars', neededVars{:});| save('sldemo_mdlref_bus_bars', neededVars{:});   %% Use the Protected Model % To use the Protected Model, set the ModelName parameter of a Model block to % the name of the Protected Model file.  You can do this either through the % Model block's parameter dialog or by using |set_param|: % % |set_param('sldemo_mdlref_bus/CounterA', 'ModelName', 'sldemo_mdlref_counter_bus.mdlp')|    % Need to close the system so the open_system call below will detect that a % model was just opened.  If this model is not newly opened by the open_system % call, the updated figure will not appear in the HTML for the demo. close_system('sldemo_mdlref_bus');  %% % The Model block's icon changes to display a lock when it references a % Protected Model: open_system('sldemo_mdlref_bus') %%  % *Figure 2:* Referencing a Protected Model   slfeature('ModelReferenceProtectedModelSupport', origval); close_system('sldemo_mdlref_bus', 0); close_system('sldemo_mdlref_counter_bus', 0);  clear('c1', 'origval', 'origdir', 'newdir', 'cmd', 'harnessHandle', 'neededVars', 'LIMITBUS', 'COUNTERBUS');   displayEndOfDemoMessage('sldemo_mdlref_protect.m')   ##### SOURCE END ##### --></body></html>