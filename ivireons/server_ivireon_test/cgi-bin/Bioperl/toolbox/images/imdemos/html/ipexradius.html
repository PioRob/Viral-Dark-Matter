
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Measuring the Radius of a Roll of Tape</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-06-29"><meta name="DC.source" content="ipexradius.m"><link rel="stylesheet" type="text/css" href="../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit ipexradius">Open ipexradius.m in the Editor</a></div><div class="right"><a href="matlab:echodemo ipexradius">Run in the Command Window</a></div></div><div class="content"><h1>Measuring the Radius of a Roll of Tape</h1><!--introduction--><p>Your objective is to measure the radius of a roll of tape, which is partially obscured by the tape dispenser.  You will utilize <tt>bwtraceboundary</tt> to accomplish this task.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Step 1: Read Image</a></li><li><a href="#2">Step 2: Threshold the Image</a></li><li><a href="#3">Step 3: Extract Initial Boundary Point Location</a></li><li><a href="#4">Step 4: Trace the Boundaries</a></li><li><a href="#5">Step 5: Fit a Circle to the Boundary</a></li></ul></div><h2>Step 1: Read Image<a name="1"></a></h2><p>Read in <tt>tape.png</tt>.</p><pre class="codeinput">RGB = imread(<span class="string">'tape.png'</span>);
imshow(RGB);

text(15,15,<span class="string">'Estimate radius of the roll of tape'</span>,<span class="keyword">...</span>
     <span class="string">'FontWeight'</span>,<span class="string">'bold'</span>,<span class="string">'Color'</span>,<span class="string">'y'</span>);
</pre><img vspace="5" hspace="5" src="ipexradius_01.png" alt=""> <h2>Step 2: Threshold the Image<a name="2"></a></h2><p>Convert the image to black and white for subsequent extraction of the edge coordinates using the <tt>bwtraceboundary</tt> routine.</p><pre class="codeinput">I = rgb2gray(RGB);
threshold = graythresh(I);
BW = im2bw(I,threshold);
imshow(BW)
</pre><img vspace="5" hspace="5" src="ipexradius_02.png" alt=""> <h2>Step 3: Extract Initial Boundary Point Location<a name="3"></a></h2><p>The <tt>bwtraceboundary</tt> routine requires that you specify a single point on a boundary. This point is used as the starting location for the boundary tracing process.</p><p>To find the edge of the tape, pick a column in the image and inspect it until a transition from a background pixel to the object pixel occurs.</p><pre class="codeinput">dim = size(BW);

col = round(dim(2)/2)-90;

row = find(BW(:,col), 1);
</pre><h2>Step 4: Trace the Boundaries<a name="4"></a></h2><p>The <tt>bwtraceboundary</tt> routine is used to find (X, Y) locations of the boundary points. In order to maximize the accuracy of the radius calculation, it is important to find as many points belonging to the tape boundary as possible. You should determine the number of points experimentally.</p><pre class="codeinput">connectivity = 8;
num_points   = 180;
contour = bwtraceboundary(BW, [row, col], <span class="string">'N'</span>, connectivity, num_points);

imshow(RGB);
hold <span class="string">on</span>;

plot(contour(:,2),contour(:,1),<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,2);
</pre><img vspace="5" hspace="5" src="ipexradius_03.png" alt=""> <h2>Step 5: Fit a Circle to the Boundary<a name="5"></a></h2><p>Rewrite basic equation for a circle:</p><pre>(x-xc)^2 + (y-yc)^2 = radius^2,  where (xc,yc) is the center</pre><p>in terms of parameters a, b, c as</p><pre>x^2 + y^2 + a*x + b*y + c = 0,  where a = -2*xc, b = -2*yc, and
                                      c = xc^2 + yc^2 - radius^2</pre><p>Solve for parameters a, b, c, and use them to calculate the radius.</p><pre class="codeinput">x = contour(:,2);
y = contour(:,1);

<span class="comment">% solve for parameters a, b, and c in the least-squares sense by</span>
<span class="comment">% using the backslash operator</span>
abc = [x y ones(length(x),1)] \ -(x.^2+y.^2);
a = abc(1); b = abc(2); c = abc(3);

<span class="comment">% calculate the location of the center and the radius</span>
xc = -a/2;
yc = -b/2;
radius  =  sqrt((xc^2+yc^2)-c)

<span class="comment">% display the calculated center</span>
plot(xc,yc,<span class="string">'yx'</span>,<span class="string">'LineWidth'</span>,2);

<span class="comment">% plot the entire circle</span>
theta = 0:0.01:2*pi;

<span class="comment">% use parametric representation of the circle to obtain coordinates</span>
<span class="comment">% of points on the circle</span>
Xfit = radius*cos(theta) + xc;
Yfit = radius*sin(theta) + yc;

plot(Xfit, Yfit);

message = sprintf(<span class="string">'The estimated radius is %2.3f pixels'</span>, radius);
text(15,15,message,<span class="string">'Color'</span>,<span class="string">'y'</span>,<span class="string">'FontWeight'</span>,<span class="string">'bold'</span>);
</pre><pre class="codeoutput">
radius =

   80.7256

</pre><img vspace="5" hspace="5" src="ipexradius_04.png" alt=""> <p class="footer">Copyright 1993-2006 The MathWorks, Inc.<br>
          Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!--
##### SOURCE BEGIN #####
%% Measuring the Radius of a Roll of Tape
% Your objective is to measure the radius of a roll of tape, which is partially
% obscured by the tape dispenser.  You will utilize |bwtraceboundary| to
% accomplish this task.
%
% Copyright 1993-2006 The MathWorks, Inc. 
% $Revision: 1.1.6.4 $ $Date: 2006/06/15 20:09:45 $

%% Step 1: Read Image
% Read in |tape.png|.

RGB = imread('tape.png');
imshow(RGB);

text(15,15,'Estimate radius of the roll of tape',...
     'FontWeight','bold','Color','y');

%% Step 2: Threshold the Image
% Convert the image to black and white for subsequent extraction
% of the edge coordinates using the |bwtraceboundary| routine.

I = rgb2gray(RGB);
threshold = graythresh(I);
BW = im2bw(I,threshold);
imshow(BW)

%% Step 3: Extract Initial Boundary Point Location
% The |bwtraceboundary| routine requires that you specify a single
% point on a boundary. This point is used as the starting location for
% the boundary tracing process.
%
% To find the edge of the tape, pick a column in the image and
% inspect it until a transition from a background pixel to the object
% pixel occurs.

dim = size(BW);

col = round(dim(2)/2)-90;

row = find(BW(:,col), 1);

%% Step 4: Trace the Boundaries
% The |bwtraceboundary| routine is used to find (X, Y) locations of
% the boundary points. In order to maximize the accuracy of the radius
% calculation, it is important to find as many points belonging to 
% the tape boundary as possible. You should determine the
% number of points experimentally.

connectivity = 8;
num_points   = 180;
contour = bwtraceboundary(BW, [row, col], 'N', connectivity, num_points);

imshow(RGB);
hold on;

plot(contour(:,2),contour(:,1),'g','LineWidth',2);

%% Step 5: Fit a Circle to the Boundary
% Rewrite basic equation for a circle: 
%
%  (x-xc)^2 + (y-yc)^2 = radius^2,  where (xc,yc) is the center
%
% in terms of parameters a, b, c as 
%
%  x^2 + y^2 + a*x + b*y + c = 0,  where a = -2*xc, b = -2*yc, and
%                                        c = xc^2 + yc^2 - radius^2
%
% Solve for parameters a, b, c, and use them to calculate the radius.

x = contour(:,2);
y = contour(:,1);

% solve for parameters a, b, and c in the least-squares sense by 
% using the backslash operator
abc = [x y ones(length(x),1)] \ -(x.^2+y.^2);
a = abc(1); b = abc(2); c = abc(3);

% calculate the location of the center and the radius
xc = -a/2;
yc = -b/2;
radius  =  sqrt((xc^2+yc^2)-c)

% display the calculated center
plot(xc,yc,'yx','LineWidth',2);

% plot the entire circle
theta = 0:0.01:2*pi;

% use parametric representation of the circle to obtain coordinates
% of points on the circle
Xfit = radius*cos(theta) + xc;
Yfit = radius*sin(theta) + yc;

plot(Xfit, Yfit);

message = sprintf('The estimated radius is %2.3f pixels', radius);
text(15,15,message,'Color','y','FontWeight','bold');


displayEndOfDemoMessage(mfilename)
##### SOURCE END #####
--></body></html>