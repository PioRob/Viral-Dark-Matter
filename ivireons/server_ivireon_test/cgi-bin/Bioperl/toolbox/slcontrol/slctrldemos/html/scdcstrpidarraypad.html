
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Designing a Family of PID Controllers for Multiple Operating Points</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-06-30"><meta name="DC.source" content="scdcstrpidarraypad.m"><link rel="stylesheet" type="text/css" href="../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit scdcstrpidarraypad">Open scdcstrpidarraypad.m in the Editor</a></div><div class="right"><a href="matlab:echodemo scdcstrpidarraypad">Run in the Command Window</a></div></div><div class="content"><h1>Designing a Family of PID Controllers for Multiple Operating Points</h1><!--introduction--><p>This demo shows how to design an array of PID controllers for a nonlinear plant in Simulink that operates over a wide range of operating points.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Opening the Plant Model</a></li><li><a href="#4">Introduction to Gain Scheduling</a></li><li><a href="#6">Obtaining Linear Plant Models for Multiple Operating Points</a></li><li><a href="#9">Designing PID Controllers for the Plant Models</a></li></ul></div><h2>Opening the Plant Model<a name="1"></a></h2><p>The plant is a continuous stirred tank reactor (CSTR) that operates over a wide range of operating points. A single PID controller can effectively use the coolant temperature to regulate the output concentration around a small operating range that the PID controller is designed for. But since the plant is a strongly nonlinear system, control performance degrades if operating point changes significantly. The closed-loop system can even become unstable.</p><p><a href="matlab:open_system('scdcstrctrlplant')">Open the CSTR plant model</a></p><pre class="codeinput">mdl = <span class="string">'scdcstrctrlplant'</span>;
open_system(mdl)
</pre><img vspace="5" hspace="5" src="scdcstrpidarraypad_01.png" alt=""> <p>For background, see Seborg, D.E. et al., "Process Dynamics and Control", 2nd Ed., 2004, Wiley, pp.34-36.</p><h2>Introduction to Gain Scheduling<a name="4"></a></h2><p>A common approach to solve the nonlinear control problem is using gain scheduling with linear controllers. Generally speaking designing a gain scheduling control system takes four steps:</p><pre> (1) Obtain a plant model for each operating region. The usual practice
 is to linearize the plant at several equilibrium operating points.</pre><pre> (2) Design a family of linear controllers such as PID for the plant
 models obtained in the previous step.</pre><pre> (3) Implement a scheduling mechanism such that the controller
 coefficients such as PID gains are changed based on the values of the
 scheduling variables.  Smooth (bumpless) transfer between controllers
 is required to minimize disturbance to plant operation.</pre><pre> (4) Assess control performance with simulation.</pre><p>For more background reading on gain scheduling, see a survey paper from W. J. Rugh and J. S. Shamma: "Research on gain scheduling", Automatica, Issue 36, 2000, pp.1401-1425.</p><p>In this example, we focus on designing a family of PID controllers for the CSTR plant described in step 1 and 2.</p><h2>Obtaining Linear Plant Models for Multiple Operating Points<a name="6"></a></h2><p>The output concentration C is used to identify different operating regions. The CSTR plant can operate at any conversion rate between low conversion rate (C=9) and high conversion rate (C=2). In this demo, divide the whole operating range into 8 regions represented by C = 2, 3, 4, 5, 6, 7, 8 and 9.</p><p>In the following loop, first compute equilibrium operating points with the <b>findop</b> command. Then linearize the plant at each operating point with the <b>linearize</b> command.</p><pre class="codeinput"><span class="comment">% Obtain default operating point</span>
op = operspec(mdl);
<span class="comment">% Set the value of output concentration C to be known</span>
op.Outputs.Known = true;
<span class="comment">% Specify operating regions</span>
C = [2 3 4 5 6 7 8 9];
<span class="comment">% Initialize an array of state space systems</span>
Plants = rss(1,1,1,8);
<span class="keyword">for</span> ct = 1:length(C)
    <span class="comment">% Compute equilibrium operating point corresponding to the value of C</span>
    op.Outputs.y = C(ct);
    opoint = findop(mdl,op,linoptions(<span class="string">'DisplayReport'</span>,<span class="string">'off'</span>));
    <span class="comment">% Linearize plant at this operating point</span>
    Plants(:,:,ct) = linearize(mdl, opoint);
<span class="keyword">end</span>
</pre><p>Since the CSTR plant is nonlinear, we expect different characteristics among the linear models. For example, plant models with high and low conversion rates are stable, while the others are not.</p><pre class="codeinput">isstable(Plants)'
</pre><pre class="codeoutput">
ans =

     1     1     0     0     0     0     1     1

</pre><h2>Designing PID Controllers for the Plant Models<a name="9"></a></h2><p>To design multiple PID controllers in batch, we can use the <b>pidtune</b> command. The following command will generate an array of PID controllers in parallel form. The desired open loop crossover frequency is at 1 rad/sec and the phase margin is the default value of 60 degrees.</p><pre class="codeinput"><span class="comment">% Design controllers</span>
Controllers = pidtune(Plants,<span class="string">'pidf'</span>,pidtuneOptions(<span class="string">'Crossover'</span>,1));
<span class="comment">% Display controller for C=4</span>
Controllers(:,:,4)
</pre><pre class="codeoutput">Continuous-time PIDF controller in parallel form:
 
           1            s    
Kp + Ki * --- + Kd * --------
           s          Tf*s+1 
 
with Kp = -12.4511, Ki = -0.10785, Kd = -14.3798, Tf = 0.0087502
 
</pre><p>Plot the closed loop responses for step set-point tracking as below:</p><pre class="codeinput"><span class="comment">% Construct closed-loop systems</span>
clsys = feedback(Plants*Controllers,1);
<span class="comment">% Plot closed-loop responses</span>
figure;
hold <span class="string">on</span>
<span class="keyword">for</span> ct =1:length(C)
    <span class="comment">% Select a system from the LTI array</span>
    sys = clsys(:,:,ct);
    set(sys,<span class="string">'Name'</span>,[<span class="string">'C='</span>,num2str(C(ct))],<span class="string">'InputName'</span>,<span class="string">'Reference'</span>);
    <span class="comment">% Plot step response</span>
    stepplot(sys,20);
<span class="keyword">end</span>
legend(<span class="string">'show'</span>,<span class="string">'location'</span>,<span class="string">'southeast'</span>)
</pre><img vspace="5" hspace="5" src="scdcstrpidarraypad_02.png" alt=""> <p>All the closed loops are stable but the settling time of the loops with unstable plants (C=4, 5, 6 and 7) are too long.  It can be improved by increasing the open loop bandwidth to 5 rad/sec and reducing the phase margin to 30 degrees.  The overshoots of these loops remain large because the unstable plants restrict the performance of PID controllers.</p><pre class="codeinput"><span class="comment">% Design controllers for unstable plant models</span>
Controllers(:,:,3:6) = pidtune(Plants(:,:,3:6),<span class="string">'pidf'</span>,pidtuneOptions(<span class="string">'CrossoverFrequency'</span>,5,<span class="string">'PhaseMargin'</span>,30));
<span class="comment">% Display controller for C=4</span>
Controllers(:,:,4)
</pre><pre class="codeoutput">Continuous-time PIDF controller in parallel form:
 
           1            s    
Kp + Ki * --- + Kd * --------
           s          Tf*s+1 
 
with Kp = -146.99, Ki = -6.3132, Kd = -60.986, Tf = 0.2
 
</pre><p>All the closed loop responses are satisfactory now.</p><pre class="codeinput"><span class="comment">% Construct closed-loop systems</span>
clsys = feedback(Plants*Controllers,1);
<span class="comment">% Plot closed-loop responses</span>
figure;
hold <span class="string">on</span>
<span class="keyword">for</span> ct =1:length(C)
    <span class="comment">% Select a system from the LTI array</span>
    sys = clsys(:,:,ct);
    set(sys,<span class="string">'Name'</span>,[<span class="string">'C='</span>,num2str(C(ct))],<span class="string">'InputName'</span>,<span class="string">'Reference'</span>);
    <span class="comment">% Plot step response</span>
    stepplot(sys,20);
<span class="keyword">end</span>
legend(<span class="string">'show'</span>,<span class="string">'location'</span>,<span class="string">'southeast'</span>)
</pre><img vspace="5" hspace="5" src="scdcstrpidarraypad_03.png" alt=""> <p>We designed an array of PID controllers and each of them should give reasonable performance around the local operating point. The next step is to implement the scheduling mechanism, which is beyond the scope of this demo.</p><p>Close the model.</p><pre class="codeinput">bdclose(mdl);
</pre><p class="footer">Copyright 2009-2010 The MathWorks, Inc.<br>
          Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!--
##### SOURCE BEGIN #####
%% Designing a Family of PID Controllers for Multiple Operating Points
% This demo shows how to design an array of PID controllers for a nonlinear
% plant in Simulink that operates over a wide range of operating points. 

%   Copyright 2009-2010 The MathWorks, Inc.
%   $Revision: 1.1.8.1 $  $Date: 2010/05/10 17:56:27 $

%% Opening the Plant Model
% The plant is a continuous stirred tank reactor (CSTR) that operates over
% a wide range of operating points. A single PID controller can effectively
% use the coolant temperature to regulate the output concentration around a
% small operating range that the PID controller is designed for. But since
% the plant is a strongly nonlinear system, control performance degrades if
% operating point changes significantly. The closed-loop system can even
% become unstable.
%%
% <matlab:open_system('scdcstrctrlplant') Open the CSTR plant model>
mdl = 'scdcstrctrlplant';
open_system(mdl)

%%
% For background, see Seborg, D.E. et al., "Process Dynamics and Control",
% 2nd Ed., 2004, Wiley, pp.34-36. 

%% Introduction to Gain Scheduling
% A common approach to solve the nonlinear control problem is using gain
% scheduling with linear controllers. Generally speaking designing a gain
% scheduling control system takes four steps:
%
%   (1) Obtain a plant model for each operating region. The usual practice
%   is to linearize the plant at several equilibrium operating points.
%
%   (2) Design a family of linear controllers such as PID for the plant
%   models obtained in the previous step. 
%
%   (3) Implement a scheduling mechanism such that the controller
%   coefficients such as PID gains are changed based on the values of the
%   scheduling variables.  Smooth (bumpless) transfer between controllers
%   is required to minimize disturbance to plant operation.
%
%   (4) Assess control performance with simulation.
%
% For more background reading on gain scheduling, see a survey paper from
% W. J. Rugh and J. S. Shamma: "Research on gain scheduling", Automatica,
% Issue 36, 2000, pp.1401-1425.

%%
% In this example, we focus on designing a family of PID controllers for
% the CSTR plant described in step 1 and 2.

%% Obtaining Linear Plant Models for Multiple Operating Points
% The output concentration C is used to identify different operating
% regions. The CSTR plant can operate at any conversion rate between low
% conversion rate (C=9) and high conversion rate (C=2). In this demo,
% divide the whole operating range into 8 regions represented by C = 2, 3,
% 4, 5, 6, 7, 8 and 9.

%%
% In the following loop, first compute equilibrium operating points with
% the *findop* command. Then linearize the plant at each operating point
% with the *linearize* command.

% Obtain default operating point
op = operspec(mdl); 
% Set the value of output concentration C to be known
op.Outputs.Known = true;                
% Specify operating regions 
C = [2 3 4 5 6 7 8 9];
% Initialize an array of state space systems
Plants = rss(1,1,1,8);
for ct = 1:length(C)
    % Compute equilibrium operating point corresponding to the value of C
    op.Outputs.y = C(ct);
    opoint = findop(mdl,op,linoptions('DisplayReport','off')); 
    % Linearize plant at this operating point
    Plants(:,:,ct) = linearize(mdl, opoint); 
end

%%
% Since the CSTR plant is nonlinear, we expect different characteristics
% among the linear models. For example, plant models with high and low
% conversion rates are stable, while the others are not.
isstable(Plants)'

%% Designing PID Controllers for the Plant Models
% To design multiple PID controllers in batch, we can use the *pidtune*
% command. The following command will generate an array of PID controllers
% in parallel form. The desired open loop crossover frequency is at 1
% rad/sec and the phase margin is the default value of 60 degrees.

% Design controllers
Controllers = pidtune(Plants,'pidf',pidtuneOptions('Crossover',1));
% Display controller for C=4
Controllers(:,:,4)

%%
% Plot the closed loop responses for step set-point tracking as below:

% Construct closed-loop systems
clsys = feedback(Plants*Controllers,1);
% Plot closed-loop responses
figure;
hold on
for ct =1:length(C)
    % Select a system from the LTI array
    sys = clsys(:,:,ct);
    set(sys,'Name',['C=',num2str(C(ct))],'InputName','Reference');
    % Plot step response
    stepplot(sys,20);
end
legend('show','location','southeast')

%%
% All the closed loops are stable but the settling time of the loops with
% unstable plants (C=4, 5, 6 and 7) are too long.  It can be improved by
% increasing the open loop bandwidth to 5 rad/sec and reducing the phase
% margin to 30 degrees.  The overshoots of these loops remain large because
% the unstable plants restrict the performance of PID controllers.

% Design controllers for unstable plant models
Controllers(:,:,3:6) = pidtune(Plants(:,:,3:6),'pidf',pidtuneOptions('CrossoverFrequency',5,'PhaseMargin',30));
% Display controller for C=4
Controllers(:,:,4)

%%
% All the closed loop responses are satisfactory now.

% Construct closed-loop systems
clsys = feedback(Plants*Controllers,1);
% Plot closed-loop responses
figure;
hold on
for ct =1:length(C)
    % Select a system from the LTI array
    sys = clsys(:,:,ct);
    set(sys,'Name',['C=',num2str(C(ct))],'InputName','Reference');
    % Plot step response
    stepplot(sys,20);
end
legend('show','location','southeast')

%%
% We designed an array of PID controllers and each of them should give
% reasonable performance around the local operating point. The next step is
% to implement the scheduling mechanism, which is beyond the scope of this
% demo.

%%
% Close the model.
bdclose(mdl);
displayEndOfDemoMessage(mfilename)

##### SOURCE END #####
--></body></html>